<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'><style type='text/css'>html {overflow-x: initial !important;}</style>
<style type='text/css'  id="style-base">:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }
.mac-os-11 { --title-bar-height: 28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, "Segoe UI Emoji", "SF Pro", sans-serif; -webkit-font-smoothing: antialiased; }
h1, h2, h3, h4, h5 { white-space: pre-wrap; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p *, #write.first-line-indent svg * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; position: relative; }
#write svg h1, #write svg h2, #write svg h3, #write svg h4, #write svg h5, #write svg h6, #write svg p { position: static; white-space: nowrap; overflow: visible; }
foreignobject { overflow: visible; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
thead, tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
svg { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; border-color: transparent !important; padding-top: 0px !important; padding-bottom: 0px !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  #write > p:nth-child(1) { margin-top: 0px; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
  figure { overflow-x: visible; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.reversefootnote { font-family: ui-monospace, sans-serif; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.mermaid-svg { margin: auto; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex: 2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; overflow-wrap: anywhere; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.42857rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left: 28px solid transparent; border-right: 28px solid transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right: 8px solid transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }
mjx-container { break-inside: avoid; }
.md-alert.md-alert-note { border-left-color: rgb(9, 105, 218); }
.md-alert.md-alert-important { border-left-color: rgb(130, 80, 223); }
.md-alert.md-alert-warning { border-left-color: rgb(154, 103, 0); }
.md-alert.md-alert-tip { border-left-color: rgb(31, 136, 61); }
.md-alert.md-alert-caution { border-left-color: rgb(207, 34, 46); }
.md-alert { padding: 0px 1em; margin-bottom: 16px; color: inherit; border-left: 0.25em solid rgb(0, 0, 0); }
.md-alert-text-note { color: rgb(9, 105, 218); }
.md-alert-text-important { color: rgb(130, 80, 223); }
.md-alert-text-warning { color: rgb(154, 103, 0); }
.md-alert-text-tip { color: rgb(31, 136, 61); }
.md-alert-text-caution { color: rgb(207, 34, 46); }
.md-alert-text { font-size: 0.9rem; font-weight: 700; }
.md-alert-text svg { fill: currentcolor; position: relative; top: 0.125em; margin-right: 1ch; overflow: visible; }
.md-alert-text-container::after { content: attr(data-text); text-transform: capitalize; pointer-events: none; margin-right: 1ch; }

</style>
<style type='text/css'  id="style-theme_css">/* =======================================================================================
   Rhapsody · REGION G — FONT IMPORTS（字体导入 · 全局可用）
   设计理念 / Design Notes
   - 统一在此集中声明 @font-face，供 Files / Outline / Write / Menu 等模块复用；
     其它区域只“引用 family 名称”，不再重复声明，避免重复下载。
   - 严格保持路径大小写与文件夹一致：一律使用 ./Fonts/...（Linux 上区分大小写）。
   - 优先提供 woff2 → woff → otf/ttf 的降级链，减少体积并兼顾兼容性。
   - 所有字体均启用 font-display: swap，降低 FOIT（首次绘制时的“无字形”闪烁）。

   使用建议 / How to Use
   - 仅在本文件声明字体；在各区域（Files/Outline…）通过变量或选择器设置 font-family。
   - 首屏常用字体（如 UI / 标题 / 代码）可在 HTML 中 <link rel="preload" as="font"> 预加载 woff2：
     例：<link rel="preload" href="./Fonts/JetBrainsMono/JetBrainsMono[wght].ttf" as="font" type="font/ttf" crossorigin>
   - 如需进一步减小体积，可按需配置 unicode-range（此处不默认启用，避免字符缺失）。

   依赖 / Dependencies
   - 路径规范：./Fonts/**（与工程目录一致）
   - 统一命名：与后续 CSS 使用保持相同的 font-family 名称（见每段注释）
   - 法律合规：确保使用的字体满足授权（商用/再分发）；必要时改为用户本地安装的 local() 方案。

   调试 / Troubleshooting
   - 404 或不生效：检查大小写 / 路径 / MIME 类型；优先确认 woff2 能被服务器正确返回。
   - “字形被覆盖”：确保区域样式未用更具体的 font-family 覆盖 @font-face 的 family。
   - “图标显示为方块”：确认图标字体（FontAwesome）声明在普通字体**之后**且选择器中强制使用其 family。

   ======================================================================================= */


/* ─────────────────────────────────────────────────────────────────────────────
   🌀 h1 — Alibaba PuHuiTi（阿里巴巴普惠体 3.0 SemiBold）· 现代/科技感大标题
   family  ：'AliPuHuiTi'（在标题/UI 中引用）
   角色建议：h1 / 重要标签
   兼容建议：优先使用 woff2；
   ───────────────────────────────────────────────────────────────────────────── */
/* ─────────────────────────────────────────────────────────────────────────────
   🔱 h2 — GuDuYanHei（落霞孤鹜文楷 · 以常规体映射）· 清新副标题
   family  ：'GuDuYanHei'（在副标题/标签中引用）
   角色建议：h2 / 次级标题；中文环境下增强人文感
   说明    ：此处以 LXGW WenKai Regular 作为映射；如需更精准，请替换为目标黑体资源
   ───────────────────────────────────────────────────────────────────────────── */
/* ─────────────────────────────────────────────────────────────────────────────
   🍎 h3 — SourceHanSansSoft（思源柔黑 代用包：ResourceHanRoundedCN）· 圆润/亲和
   family  ：'SourceHanSansSoft'
   角色建议：h3 / UI 文本 / 段内强调
   提示    ：若需严格对应官方“思源柔黑”，可替换为官方包；当前为兼容性代用
   ───────────────────────────────────────────────────────────────────────────── */
/* ─────────────────────────────────────────────────────────────────────────────
   🐰 h4 — ZhanKuWenYiTi（站酷文艺体）· 叙述型小标题
   family  ：'ZhanKuWenYiTi'
   角色建议：h4 / 说明性标题 / 轻装饰文本
   ───────────────────────────────────────────────────────────────────────────── */
/* ─────────────────────────────────────────────────────────────────────────────
   ⚡ h5 — ZCOOL Addict Italic（斜体）· 动感视觉点缀
   family  ：'ZCOOLAddictItalic'
   角色建议：h5 / 装饰性小标题 / 外文词组/术语斜体
   注意    ：仅提供 italic 款；如需正体请另行引入
   ───────────────────────────────────────────────────────────────────────────── */
/* ─────────────────────────────────────────────────────────────────────────────
   🦊 h6 — GaoDuanHei（ZCOOL 高端黑）· 力量感与识别度
   family  ：'GaoDuanHei'
   角色建议：h6 / 标签 / 强提示字
   ───────────────────────────────────────────────────────────────────────────── */
/* ─────────────────────────────────────────────────────────────────────────────
   💻 Code — Roboto Mono（可变字体）· 西文等宽
   family  ：'RobotoMono'
   角色建议：内联代码 / 短代码片段
   技术    ：Variable Font（wght 轴），保留 normal 与 italic 两段声明
   ───────────────────────────────────────────────────────────────────────────── */
/* ─────────────────────────────────────────────────────────────────────────────
   💻 Code — JetBrains Mono NL（可变字体 · 推荐主力等宽）
   family  ：'JetBrainsMonoNL'
   角色建议：代码块 / 编辑器风格
   说明    ：此处将 normal 与 italic 的 VF 一并声明；若需要分离可再拆出单独 italic 段
   ───────────────────────────────────────────────────────────────────────────── */
/* JetBrains Mono NL — normal */
/* JetBrains Mono NL — italic */
/* ─────────────────────────────────────────────────────────────────────────────
   🔢 Math — Latin Modern Math（带 MATH 表的数学字体）
   family  ：'LatinmodernmathRegular'
   角色建议：行间/行内数学公式（与 KaTeX/MathJax 搭配）
   注意    ：如需严格数学版式，请与公式渲染引擎配置保持一致
   ───────────────────────────────────────────────────────────────────────────── */
/* ─────────────────────────────────────────────────────────────────────────────
   🕹 Pixel — Press Start 2P（英文字体 · 像素风）
   family  ：'Press Start 2P'
   角色建议：像素风徽章/按钮/小标题
   ───────────────────────────────────────────────────────────────────────────── */
/* ─────────────────────────────────────────────────────────────────────────────
   🕹 Pixel CN — SourceHanSans Pixel（思源像素 可变 OTF）
   family  ：'SourceHanSansPixel'
   角色建议：中文像素风局部点缀
   范围    ：wght 200–900（请按真实范围微调）
   ───────────────────────────────────────────────────────────────────────────── */
/* ─────────────────────────────────────────────────────────────────────────────
   ✒️ Display Serif Italic — Playfair Display（可变斜体）
   family  ：'Playfair_Display'
   角色建议：英文标语/副标题（在 About/MegaMenu 等场景使用）
   ───────────────────────────────────────────────────────────────────────────── */
/* ─────────────────────────────────────────────────────────────────────────────
   📖 Body — Source Han Serif SC（思源宋体）· 正文阅读友好
   family  ：'SourceHanSerifSC'
   角色建议：正文 / 长文阅读
   ───────────────────────────────────────────────────────────────────────────── */
/* ─────────────────────────────────────────────────────────────────────────────
    Font Awesome（FA4.x）图标字体 · 本地兜底
   family  ：'FontAwesome'
   用途    ：图标伪元素（::before）与菜单图标；需在选择器中显式设定 font-family
   提示    ：若与普通字体冲突，请在伪元素处加 `font-family: 'FontAwesome' !important;`
   ───────────────────────────────────────────────────────────────────────────── */
/* =============================== END OF PACKAGE ============================ */

/* =======================================================================================
   Rhapsody · Global Background & Corner Badges（写作页全局底色 + 角标系统）
   设计理念 / Design Concept
   - 仅当「#write 存在且未打开 MegaMenu」时为 html/body 赋予全局底色与文字色。
   - 角标采用“变量切换 + 单一渲染口”方案：html::after=BL，html::before=BR；不改 DOM。
   - 角标默认关闭；通过 :has(...) 改写变量启用，content: none/"" 精准控生/不生伪元素。
   - 尺寸与位置一次配置：--cb-size=clamp(72px,max(88px,7vmin),112px)；考虑 safe-area。
   - BR 垂直位移随视口自适应（10px–min(420px, 100vh−size−safe-area−8px)）以避免遮挡。
   - 保持你既定的颜色/尺寸/数值与区域内变量作用域，不跨区污染。
   ======================================================================================= */

/* ========================================================================== */
/* REGION A — GLOBAL ROOT · Background & Text                                 */
/* Scope: 仅在 #write 存在、且 MegaMenu 关闭时为 html/body 设定底色与正文色     */
/* Function: 提供编辑态全局底色、文字色、SVG 随文字着色、基础行高               */
/* Adjustable Params: 背景/文字/行高（这里保留你的既定数值）                   */
/* 兼容性 / Compatibility: 可包裹 @supports(selector(:has(*)))；Typora 可用    */
/* ========================================================================== */

/* 默认：写作态启用 */
body:not(.megamenu-opened) {
  --bg-color:   #d5eafd;     /* 背景色 / Background */
  --text-color: #232931;     /* 正文字色 / Body text */
  --svg-fill:   currentColor;/* SVG/图标颜色随文字色 */
  --line-height:1.625rem;    /* 基础行高 */

  /* 📱 移动端自动文字缩放（桌面端基本无效，作为兼容位保留） */
  -webkit-text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;

  background: var(--bg-color);
  color: var(--text-color);
  fill: var(--svg-fill);
  line-height: var(--line-height);
}

/* ========================================================================== */
/* REGION B — CORNER BADGES (BL & BR) · 变量切换版（单监听、单渲染口）        */
/* 约定：BL=左下（::after），BR=右下（::before）                              */
/* 默认关闭角标；仅在 html 上用 :has 改变量；未命中时 content:none 不生成伪元素 */
/* ========================================================================== */
/* ── 全局几何：集中定义尺寸/安全区/偏移（不做状态切换） ── */
html{
  /* 尺寸（首选 88px；随视口轻微伸缩，72–112px） */
  --cb-size: clamp(72px, max(88px, 7vmin), 112px);

  /* 安全区（底部刘海 / 系统栏） */
  --cb-safe-bottom: env(safe-area-inset-bottom, 0px);

  /* 左下角偏移（首选 20/10；适度随视口伸缩） */
  --cb-bl-x: clamp(12px, max(20px, 1.8vmin), 28px);
  --cb-bl-y: clamp(8px,  max(10px, 1.6vmin), 20px);

  /* 右下角偏移 X（首选 20；适度随视口伸缩） */
  --cb-br-x: clamp(12px, max(20px, 1.8vmin), 28px);

  /* 右下角偏移 Y：与原版一致 */
  --cb-br-y-max: min(420px, calc(100vh - var(--cb-size) - var(--cb-safe-bottom) - 8px));
  --cb-br-y: clamp(10px, 350px, var(--cb-br-y-max));
}

/* ────────────────────────────────────────────────────────────────────────── */
/* BL（左下）：Outline / MegaMenu（就地挂载，fixed 定位到视口）                */
/* ────────────────────────────────────────────────────────────────────────── */

/* Outline 激活 → 作业培根（挂载点：侧栏本体） */
#typora-sidebar.active-tab-outline::after{
  content: "";
  position: fixed;
  left:  var(--cb-bl-x);
  bottom: calc(var(--cb-bl-y) + var(--cb-safe-bottom));
  width:  var(--cb-size);
  height: var(--cb-size);
  background: url("file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Logo/Background_Icon/Typora%E4%BD%9C%E4%B8%9A%E5%9F%B9%E6%A0%B9.ico") no-repeat center / contain;
  pointer-events: none;
  z-index: 900;
}

/* MegaMenu 打开 → 冒险培根（挂载点：html；覆盖 Outline） */
body.megamenu-opened::after{
  content: "";
  position: fixed;
  left:  var(--cb-bl-x);
  bottom: calc(var(--cb-bl-y) + var(--cb-safe-bottom));
  width:  var(--cb-size);
  height: var(--cb-size);
  background: url("file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Logo/Background_Icon/%E5%86%92%E9%99%A9%E5%9F%B9%E6%A0%B9.ico") no-repeat center / contain;
  pointer-events: none;
  z-index: 901; /* 覆盖侧栏挂载的 900 */
}

/* ────────────────────────────────────────────────────────────────────────── */
/* BR（右下）：Files 列表 / 树形（就地挂载，fixed 定位到视口）                  */
/* ────────────────────────────────────────────────────────────────────────── */

/* Files + 列表模式 → 厨师培根 */
html:has(#typora-sidebar.active-tab-files.use-file-list-style):not(:has(.megamenu-opened)){
  --cb-br-content: "";
  --cb-br-icon: url("file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Logo/Background_Icon/%E5%8E%A8%E5%B8%88%E5%9F%B9%E6%A0%B9.ico");
}

/* Files + 树形模式 → 睡觉培根 */
html:has(#typora-sidebar.active-tab-files.use-file-tree-style):not(:has(.megamenu-opened)){
  --cb-br-content: "";
  --cb-br-icon: url("file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Logo/Background_Icon/%E7%9D%A1%E8%A7%89%E5%9F%B9%E6%A0%B9.ico");
}

/* 单一渲染口：BR 挂在 html::before */
html::before{
  content: var(--cb-br-content);
  position: fixed;
  right: var(--cb-br-x);
  bottom: calc(var(--cb-br-y) + var(--cb-safe-bottom));
  width:  var(--cb-size);
  height: var(--cb-size);
  background: var(--cb-br-icon) no-repeat center / contain;
  pointer-events: none;
  z-index: 900;
}

/* ==========================================================================
   REGION C — VIEWPORT SCROLLBAR · Ultra-Minimal Pink
   Scope: 仅命中主界面滚动条（content, html, body）
   - 不影响侧栏、菜单、表格/代码等内嵌滚动容器
   - 无动画、无滤镜、无发光；仅粉色拇指+浅灰轨道
   ========================================================================== */
/* REGION C — VIEWPORT SCROLLBAR · Root (content-only) */
content{
  --vp-size:   12px;
  --vp-radius: 12px;
  --track:     rgba(0,0,0,.06);
  --thumb:     #F3B8CC;
  --thumb-brd: #E6A1BB;
}

/* 尺寸（仅主视口 content） */
content::-webkit-scrollbar{
  width:  var(--vp-size);
  height: var(--vp-size);
}

/* 轨道（仅主视口 content） */
content::-webkit-scrollbar-track{
  background:    var(--track);
  border-radius: var(--vp-radius);
}

/* 拇指（仅主视口 content） */
content::-webkit-scrollbar-thumb{
  background:    var(--thumb);
  border:        1px solid var(--thumb-brd);
  border-radius: var(--vp-radius);
}

/* 角落（仅主视口 content） */
content::-webkit-scrollbar-corner{ background: transparent; }
  

/* ========================================================================== */
/* REGION D — TITLEBAR CONTROLS (Left + Right) · Ceramic White × Cyan Edge    */
/* Scope: 写作态默认（未打开 MegaMenu）；统一管理 #top-titlebar 内所有按钮        */
/* Targets: #w-menu-btn, #w-min, #w-max, #w-full, #w-pin, #w-unpin,            */
/*          #w-restore, #w-close                                              */
/* Notes: 1) 去掉 :has(#write) 降低匹配成本；                                    */
/*        2) 变量仅在 body:not(.megamenu-opened) 下挂到 #top-titlebar；         */
/*        3) 用 :where() 聚合 ID，降低特指度，便于热修；                         */
/* ========================================================================== */

/* —— 变量：仅当未打开 MegaMenu 时生效 —— */
body:not(.megamenu-opened) #top-titlebar{
  --wc-size: 24px;
  --wc-radius: 8px;
  --wc-fg: #333333;

  --wc-ceramic-1: #F6F8FC;
  --wc-ceramic-2: #E7EDF7;
  --wc-hairline: rgba(211,220,235,.85);
  --wc-glint: rgba(255,255,255,.80);
  --wc-shadow: rgba(0,0,0,.22);

  --wc-cyan-glow: rgba(153,229,255,.45);

  --wc-danger-1: #FFF2F2;
  --wc-danger-2: #FFE2E2;
  --wc-danger-ring: rgba(255,77,79,.45);
  --wc-danger-glow: rgba(255,77,79,.28);
}

/* —— 基础形态：统一左/右按钮的卡片容器 —— */
body:not(.megamenu-opened) #top-titlebar
  :where(#w-menu-btn,#w-min,#w-max,#w-full,#w-pin,#w-unpin,#w-restore,#w-close).toolbar-icon{
  display: inline-flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  height: var(--wc-size);
  padding: 2px 8px;
  border: 1px solid var(--wc-hairline);
  border-radius: var(--wc-radius);
  background: linear-gradient(180deg,var(--wc-ceramic-1),var(--wc-ceramic-2));
  box-shadow:
    inset 0 1px 0 var(--wc-glint),
    inset 0 -1px 0 var(--wc-shadow),
    0 0 0 1px rgba(255,255,255,.10);
  color: var(--wc-fg);
  fill: currentColor;
  transition: background .18s ease, box-shadow .18s ease, filter .16s ease;
}

/* —— 微调距离：左/右各自外边距（避免写两遍规则） —— */
body:not(.megamenu-opened) #top-titlebar #w-menu-btn.toolbar-icon{ margin-right: 6px; }
body:not(.megamenu-opened) #top-titlebar
  :where(#w-min,#w-max,#w-full,#w-pin,#w-unpin,#w-restore,#w-close).toolbar-icon{ margin-left: 6px; }

/* —— Hover：青蓝指示灯（Close 例外见下） —— */
@media (hover:hover){
  body:not(.megamenu-opened) #top-titlebar
    :where(#w-menu-btn,#w-min,#w-max,#w-full,#w-pin,#w-unpin,#w-restore).toolbar-icon:hover{
    filter: brightness(1.02) saturate(1.04);
    box-shadow:
      inset 0 1px 0 var(--wc-glint),
      inset 0 -1px 0 rgba(0,0,0,.26),
      0 0 0 1px rgba(255,255,255,.12),
      0 0 12px var(--wc-cyan-glow);
  }
}

/* —— Active：轻压反馈 —— */
body:not(.megamenu-opened) #top-titlebar
  :where(#w-menu-btn,#w-min,#w-max,#w-full,#w-pin,#w-unpin,#w-restore,#w-close).toolbar-icon:active{
  filter: brightness(.97) saturate(1.02);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.65),
    inset 0 -1px 0 rgba(0,0,0,.35),
    0 0 0 1px rgba(255,255,255,.12);
}

/* —— Close：hover 用淡红安全态 —— */
@media (hover:hover){
  body:not(.megamenu-opened) #top-titlebar #w-close.toolbar-icon:hover{
    background: linear-gradient(180deg,var(--wc-danger-1),var(--wc-danger-2));
    box-shadow:
      inset 0 1px 0 var(--wc-glint),
      inset 0 -1px 0 rgba(0,0,0,.22),
      0 0 0 1px var(--wc-danger-ring),
      0 0 12px var(--wc-danger-glow);
    color: #a11217;
  }
}

/* —— 左侧汉堡按钮的三线图形 —— */
#top-titlebar #w-titlebar-left #w-menu-btn .ty-menu-btn-area{
  display: inline-grid;
  grid-auto-flow: row;
  grid-template-rows: repeat(3, 2px);
  gap: 3px;
  width: 14px;
}
#top-titlebar #w-titlebar-left #w-menu-btn .ty-menu-btn-area-sub{
  display: block;
  height: 2px;
  border-radius: 2px;
  background: linear-gradient(180deg,#556b82,#344a5f);
}

/* —— 汉堡扫描：仅 hover 时启用、减少无谓动画 —— */
@media (hover:hover){
  body:not(.megamenu-opened) #top-titlebar #w-titlebar-left #w-menu-btn.toolbar-icon:hover
  .ty-menu-btn-area-sub{
    background-image:
      linear-gradient(180deg,#556b82,#344a5f),
      linear-gradient(90deg, rgba(122,215,255,0) 35%, rgba(122,215,255,.7) 50%, rgba(122,215,255,0) 65%);
    background-size: 100% 100%, 300% 100%;
    background-position: 50% 50%, -120% 0%;
    animation: aiMenuScanX 2.6s linear infinite;
  }
}

/* —— 减少动态：系统层面停掉动画 —— */
@media (prefers-reduced-motion: reduce){
  #top-titlebar #w-titlebar-left #w-menu-btn .ty-menu-btn-area-sub{
    animation: none !important;
    background-position: 50% 50%;
  }
}

/* —— 关键帧 —— */
@keyframes aiMenuScanX{
  0%   { background-position: 50% 50%, -120% 0%; }
  100% { background-position: 50% 50%, 160% 0%;  }
}

/* =============================== END OF PACKAGE ============================ */

/* =======================================================================================
   Rhapsody · Write Card Package  (#write 卡片化写作区 · 外扩光带 + 太阳角标)
   设计理念 / Design Concept
   - 以“卡片化写作场”为核心：A 提供结构与绘制收敛；B 为外扩光带；C 为太阳高光与角标。
   - 严格遵循 Typora 限制：不改动任何 HTML 结构，仅使用选择器与伪元素(::before/::after)。
   - 动效按需启动：默认暂停，交互 (:hover / :focus-within) 时才运行；尊重系统减动设定。
   ======================================================================================= */

/* ========================================================================== */
/* REGION A — CARD ROOT                                                       */
/* Scope: #write 主体容器                                                     */
/* Function: 提供写作卡片的背景、圆角、投影与内边距；作为能量层的承载面          */
/* Adjustable Params: 背景色、圆角尺寸、阴影层叠、最大宽度、内外边距            */
/* Compatibility: 现代浏览器 / Typora(Electron)；旧内核忽略 contain 回退为静态 */
/* ========================================================================== */
#write {
  /* —— Adjustable Params（可维护变量） —— */
  --card-bg: #fff8fa;
  --card-radius: 2.2rem;
  --card-shadow:
    0 16px 32px -8px #23b3fccc,
    0 6px 16px -2px #14181c99,
    0 0px 4px -2px #fff7bbcc,
    8px 0 24px -10px #ff2a2acc,
    0 0 0 1.5px rgba(0,0,0,0.99);
  --card-width: 820px;
  --card-margin: 3.5rem auto;
  --card-padding: 2.5rem 3.5rem;
  --card-min-h: 80vh;

  /* —— Static Styles —— */
  background: var(--card-bg);
  border-radius: var(--card-radius);
  box-shadow: var(--card-shadow);
  max-width: var(--card-width);
  margin: var(--card-margin);
  padding: var(--card-padding);
  min-height: var(--card-min-h);
  position: relative;
  overflow: visible;
  z-index: 1;

  /* 绘制收敛 · Rendering isolation */
  contain: paint;
  backface-visibility: hidden;
  transform: translateZ(0);
}

/* ========================================================================== */
/* REGION B — ENERGY LAYER ROOT                                               */
/* Scope: #write::before 伪元素                                               */
/* Function: 外扩光带层（静态渐变+动态亮度插值），仅交互时运行动画             */
/* Adjustable Params: 光带不透明度、亮度插值范围、动画周期                     */
/* Compatibility: Chrome/Safari/Typora(Electron)；降级时回退为静态层           */
/* ========================================================================== */
/* —— 注册亮度变量（可插值数值） —— */
@property --br {
  syntax: '<number>';
  inherits: false;
  initial-value: 1.6;
}

#write::before {
  /* —— Adjustable Params —— */
  --br-min: 1.6;       /* 最小亮度 */
  --br-max: 2.2;       /* 最大亮度 */
  --br-init: 1.6;      /* 初始亮度 */
  --br-dur: 42s;       /* 呼吸周期时长 */
  --glow-radius: 2.43rem;
  --glow-opacity: .25;

  /* —— Static Styles —— */
  content: '';
  position: absolute;
  left: -13px; right: -13px; top: -13px; bottom: -13px; /* 外扩光带，受 contain:paint 裁剪 */
  border-radius: var(--glow-radius);

  background:
    radial-gradient(circle, rgba(255,255,255,0.00) 97.5%, rgba(220,220,220,0.6) 99%, rgba(245,245,245,0.25) 100%),
    linear-gradient(115deg, #23b3fc 0%, #ffd93b 48%, #ff2a2a 95%),
    linear-gradient(120deg,
      #fffbe8cc 0%, #fffbe8bb 2%, #fffbe8bb 4%, #fffbe899 6%, #fffbe899 8%, #fffbe888 10%, #fffbe888 12%,
      #fffbe866 14%, #fffbe866 16%, #fffbe844 18%, #fffbe844 20%, #fff8fa22 22%, #fff8fa22 24%, #fff8fa22 26%,
      #fff8fa22 28%, #fff8fa11 30%, #fff8fa11 32%, #fff8fa11 34%, #fff8fa0c 36%, #fff8fa0c 38%, #fff8fa0a 40%,
      #fff8fa0a 42%, #fff8fa08 44%, #fff8fa08 46%, #fff8fa06 48%, #fff8fa06 50%, #fff8fa05 52%, #fff8fa05 54%,
      #fff8fa04 56%, #fff8fa04 58%, #fff8fa03 60%, #fff8fa03 62%, #fff8fa02 64%, #fff8fa02 66%, #fff8fa02 68%,
      #fff8fa02 70%, #fff8fa01 72%, #fff8fa01 74%, #fff8fa01 76%, #fff8fa01 78%, #fff8fa01 80%, #fff8fa01 82%,
      #fff8fa01 84%, #fff8fa01 86%, #fff8fa01 88%, #fff8fa01 90%, transparent 92%, transparent 94%, transparent 96%, transparent 98%, transparent 100%
    );

  opacity: var(--glow-opacity);
  filter: brightness(var(--br-init));

  pointer-events: none;
  z-index: 5;
  animation: glassBreatheBr var(--br-dur) linear infinite alternate;
  animation-play-state: paused; /* 默认暂停，由交互态激活 */
}

/* 动画：亮度插值 */
@keyframes glassBreatheBr {
  0%   { --br: var(--br-min); }
  100% { --br: var(--br-max); }
}

/* 交互态：启动动画 */
#write:is(:hover, :focus-within)::before {
  animation-play-state: running;
}

/* 系统要求减少动态时：停用动画 */
@media (prefers-reduced-motion: reduce) {
  #write::before { animation: none; }
}

/* ========================================================================== */
/* REGION C — SUN / BADGE CORE                                                */
/* Scope: #write::after 伪元素                                                */
/* Function: 太阳高光 + 角标；小面固定模糊，动画仅改不透明度与旋转              */
/* Adjustable Params: 角标尺寸/偏移、角标图片、呼吸与旋转周期                   */
/* Compatibility: 现代浏览器 / Typora(Electron)；降级回退为静态层               */
/* ========================================================================== */

/* 角标变量（本层内聚）；--corner-img 由触发区(D)覆盖 */
#write::after{
  --corner-size:96px;
  --corner-offset-x:1.3rem;
  --corner-offset-y:1.1rem;
  --corner-img-transparent:url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Logo/Write_Icon/%E5%B8%85%E6%B0%94%E5%A4%A7%E7%8E%8B%E5%AD%90%E9%80%8F%E6%98%8E%E7%89%88.png');
  --corner-img-colored:url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Logo/Write_Icon/%E5%B8%85%E6%B0%94%E5%A4%A7%E7%8E%8B%E5%AD%90.png');

  /* 移除常驻 will-change，避免长期预留显存 */
  /* will-change:opacity,transform,filter; */

  content:'';
  position:absolute;
  top:var(--corner-offset-y);
  right:var(--corner-offset-x);
  width:var(--corner-size);
  height:var(--corner-size);
  pointer-events:none;
  z-index:10;

  background:
    /* 默认使用透明版；若 D 设置了 --corner-img，则以其为准 */
    var(--corner-img, var(--corner-img-transparent)) center/contain no-repeat,
    radial-gradient(circle at 62% 38%, #fffbe8ee 0%, #fff7dcbb 40%, #ffe29f66 74%, #fff3a444 85%, transparent 100%),
    conic-gradient(from 10deg,
      #fffbe8cc 8deg, transparent 35deg, #ffe59488 55deg, transparent 90deg,
      #fffbe8bb 140deg, transparent 190deg, #ffe59466 235deg, transparent 270deg,
      #fffbe8aa 320deg, transparent 360deg);
  border-radius:50%;
  opacity:.74;
  filter:blur(.12rem);                    /* 固定小模糊：小面成本极低 */
  transform-origin:50% 50%;
  animation:
    sunBreathe 365s ease-in-out infinite alternate,
    sunRotate 42s linear infinite;
  animation-play-state:paused;            /* 默认暂停，由交互激活 */
}

/* 交互：仅在需要时启用动画与 will-change（且不包含 filter） */
#write:is(:hover, :focus-within)::after{
  animation-play-state:running;
  will-change: opacity, transform;
}

/* 减动效：与 A/B 保持一致 */
@media (prefers-reduced-motion: reduce){
  #write::after{ animation: none; }
}

/* Keyframes — 参数不变 */
@keyframes sunBreathe{ 0%{opacity:.50;} 100%{opacity:.1;} }
@keyframes sunRotate{ 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }


/* ========================================================================== */
/* REGION D — TRIGGERS                                                        */
/* Scope: 文档根 html（作为 :has 判断载体） + #write::after（接收变量覆盖）     */
/* Function: 彩蛋触发逻辑；仅通过设置变量 --corner-img 切换角标图片；提供 UX 提示 */
/* Adjustable Params: 触发器选择器（:has / 属性选择器）、--corner-img、UX 高亮样式 */
/* Compatibility: 现代浏览器；:has 受支持时启用宽松触发；不支持时回退为透明版角标 */
/* ========================================================================== */

/* （可选）宽松版 */
@supports(selector(:has(*))){
  html:has(.task-list-item input[type="checkbox"]:checked):has(a[href*="#egg-prince"]) #write::after{
    --corner-img: var(--corner-img-colored);
  }
}

/* UX 提示（仅 #write 内） */
#write .task-list-item:has(a[href="#egg-prince"]),
#write .task-list-item:has(span[data-egg="trigger"][data-text="帅气大王子"]),
#write .task-list-item:has(img[alt="帅气大王子"]){
  background:rgba(255,226,50,.10);
  border-radius:8px;
  padding:2px 6px;
}


/* ========================================================================== */
/* REGION E — RESPONSIVE                                                      */
/* Scope: 媒体查询作用于 #write / #write::before / #write::after               */
/* Function: 自适应尺寸与圆角/角标参数；不修改配色与动效逻辑                     */
/* Adjustable Params: 断点（min-width/max-width）、卡片最大宽度、圆角、角标尺寸与偏移 */
/* Compatibility: 现代浏览器 / Typora(Electron)；旧内核忽略高级特性无功能性影响 */
/* ========================================================================== */
@media only screen and (min-width:1400px){
  #write{ max-width:960px; border-radius:2.6rem; }
  #write::before{ border-radius:2.7rem; }
  #write::after{ top:1.5rem; right:2rem; width:7.2rem; height:7.2rem; }
}
@media only screen and (min-width:1800px){
  #write{ max-width:1180px; border-radius:3.3rem; }
  #write::before{ border-radius:3.3rem; }
  #write::after{ top:1.8rem; right:2.7rem; width:8.6rem; height:8.6rem; }
}
/* 小屏微调：收窄玻璃层外扩，避免触边 */
@media (max-width:1100px){
  #write::before{ left:-8px; right:-8px; top:-8px; bottom:-8px; }
}

/* =============================== END OF PACKAGE ======================================== */

/* =======================================================================================
   Rhapsody · Outline Sidebar Package  （大纲侧栏样式包 · 精修合并版）
   设计理念 / Design Concept
   - 作用域收敛：仅在 #typora-sidebar.active-tab-outline 激活时生效，避免影响 Files/其他页签。
   - 轻量表达：以文字层级色 + 细导引线 + 轻度发光表现交互，不使用重滤镜/大面积块背景。
   - 分区自治：每区仅使用本区变量（--ol*），A 区合并原 SPECIAL/CONTAINERS 并保留旧名映射。
   - 结构不改：不调整 Typora DOM，使用 ID/类名精确命中（如 #file-library-search-panel / #file-library-search-input）。
   - 性能优先：导引线提供 rgba 兜底 + color-mix 首选；主滚动区 contain: paint；只对必要属性做过渡。
   - 可达性：提供明确的键盘焦点环；层级配色在深底下保持 ≥ AA 对比。
   - 兼容策略：字体规则使用 :where 降特异性以便继承；J 区 :has() 仅用于“分隔条/全局协调”，并受守卫限制。
   - 可控调试：提供 .debug-outline-scope 开关类，用于快速验证作用域收敛（发布时不添加该类）。

   使用说明 / Usage Notes
   - A 区：统一黑底白字与描边，仅给大纲根容器着色；.outline-content 设置内边距与 contain: paint。
   - B 区：为各级 ul 绘制左侧导引线；优先 color-mix，老内核回退 rgba。
   - C 区：条目层级色/hover/active 文本高亮与圆点强调；圆点 pointer-events:none 避免遮挡点击。
   - D/E 区：折叠箭头仅做 opacity/scale 的轻动效；Reduced Motion 下关闭相关过渡。
   - F 区（Filter）：在 Outline 激活时以 ID 精确命中搜索面板与输入框；变量集中挂在根上统一调参。
   - G 区（Resizer）：通过 body:has(#typora-sidebar.active-tab-outline) 接管分隔条；当 .megamenu-opened 时让位。
   - H 区（Fonts）：在根与常见容器设 UI 字体，tabs 标题/代码片段分别映射标题/等宽字体，避免跨区污染。
   - I 区（Menu）：y阴阳鱼主题菜单样式设置，围绕主题图片惊醒配色设计。

   兼容性 / Compatibility
   - Chromium/Electron（Typora）/现代 Safari：完整支持；旧内核忽略 color-mix / :has 时自动使用兜底或跳过。
   - @media (prefers-reduced-motion: reduce)：动效降级不影响布局与配色。

   维护建议 / Maintenance
   - 保持变量名与选择器稳定；新增样式优先追加在对应 REGION，避免跨区读取变量。
   - 若需扩大命中范围，优先调整根守卫或容器选择器，而非提升选择器特异性或使用 !important。
   ======================================================================================= */

/* =============================================================================
   REGION A — 主要样式与全局上色（合并版：原 SPECIAL + CONTAINERS）
   Scope:
     #typora-sidebar.active-tab-outline 及其内部常见容器
   Function:
     - 统一 Outline 区的黑底白字与描边（发布版默认只作用于本区容器）
     - 设置主滚动区内边距与绘制收敛（contain: paint）
   Notes:
     - 提供“调试开关”类 .debug-outline-scope，便于一键验证作用域收敛；
       发布时不加该类即可避免潜在外溢。
     - 变量采用 A 区命名；保留旧名映射，避免下游样式回归。
   ========================================================================== */
/* =============================================================================
   REGION A — ROOT + TAB STRIP（合并：容器上色 + 顶部页签条）
   Scope:
     #typora-sidebar.active-tab-outline 及其内部 .outline-content / tabs 子容器
   Function:
     - 统一侧栏容器黑底白字与描边
     - 同时接管顶部页签条（Outline / Files tab strip）的底色与文字状态
   Vars:
     - S 组（容器）：--olS-bg / --olS-fg / --olS-border
     - B 组（内容内边距）：--olB-pad
     - K 组（页签条）：--olK-tab-bg / --olK-tab-fg / --olK-tab-fg-active / --olK-underline / --olK-dur
   Notes:
     - 仅命中本侧栏实例，不跨区；不使用 :has() 与 !important。
   ========================================================================== */

#typora-sidebar.active-tab-outline {
  /* 容器（S 组） */
  --olS-bg: #0f0f0f;
  --olS-fg: #ffffff;
  --olS-border: rgba(255,255,255,.12);

  /* 内容区（B 组） */
  --olB-pad: 12px 12px 10px;

  /* 页签条（K 组） */
  --olK-tab-bg: #0f0f0f;
  --olK-tab-fg: rgba(255,255,255,.62);
  --olK-tab-fg-active: #ffffff;
  --olK-underline: #eaeaea;
  --olK-dur: .18s;

  /* 应用于侧栏容器本体 */
  background: var(--olS-bg);
  color: var(--olS-fg);
  border-color: var(--olS-border);
}

/* 主内容内边距 */
#typora-sidebar.active-tab-outline .outline-content {
  padding: var(--olB-pad);
}

/* 顶部页签条容器与伪元素：统一底色与去阴影 */
#typora-sidebar.active-tab-outline .info-panel-tab-title-group,
#typora-sidebar.active-tab-outline .info-panel-tab-title-group::before {
  background: var(--olK-tab-bg);
  box-shadow: none;
}

/* 下划线（若存在） */
#typora-sidebar.active-tab-outline .info-panel-tab-border {
  background: var(--olK-underline);
}

/* 单个页签标题：常态/交互 */
#typora-sidebar.active-tab-outline .info-panel-tab-title {
  background: var(--olK-tab-bg);
  color: var(--olK-tab-fg);
  border: 0;
  outline: none;
  box-shadow: none;     /* 移除左侧高亮 rail 等阴影差异 */
  font-weight: 600;
  transition: color var(--olK-dur) ease;
}
#typora-sidebar.active-tab-outline .info-panel-tab-title:hover,
#typora-sidebar.active-tab-outline .info-panel-tab-title.active {
  background: var(--olK-tab-bg);
  color: var(--olK-tab-fg-active);
  box-shadow: none;
}


/* =============================================================================
   REGION B — TREE RAILS（纵向导引线）
   Scope:
     #typora-sidebar.active-tab-outline .outline-content ul
   Vars（仅本区）:
     --olC-rail / --olC-rail-alpha / --olC-rail-w / --olC-indent
   Function:
     为每级 ul 绘制左侧纵向导引线；提供 rgba 兜底与 color-mix 首选（现代）。
   设计要点 / Design Notes:
     - 粗细（--olC-rail-w）与缩进（--olC-indent）需要配合，避免“线压文字”或过宽空栏。
     - alpha 建议 85%–100%，过低会导致深色底下不可见；过高会喧宾夺主。
   ========================================================================== */
#typora-sidebar.active-tab-outline .outline-content ul {
  --olC-rail: #e5e5e5;      /* 轨道基色 | rail base color */
  --olC-rail-alpha: 100%;   /* 建议 85%–100% | recommended 85%–100% */
  --olC-rail-w: 2px;        /* 轨道粗细 | rail thickness */
  --olC-indent: 18px;       /* 子层缩进 | nested indent */

  margin: 0;
  padding-left: var(--olC-indent);

  /* 兜底：rgba | fallback first */
  border-left: var(--olC-rail-w) solid rgba(229,229,229,0.85);

  /* 首选：color-mix（若支持）覆盖兜底 | preferred if supported */
  border-left-color: color-mix(in srgb, var(--olC-rail) var(--olC-rail-alpha), transparent);
}


/* =============================================================================
   REGION C — ITEMS & STATES（条目与状态）
   Scope:
     .outline-item 及其状态/层级；兼容 .outline-label 文本容器
   Vars（仅本区）:
     层级配色 --olD-h1~h6；
     交互配色 --olD-hover / --olD-hover-glow / --olD-active / --olD-active-glow；
     几何/节奏 --olD-pad-y / --olD-pad-x / --olD-radius / --olD-line / --olD-dur；
     强调圆点 --olD-accent / --olD-accent-w。
   Function:
     控制条目层级色、hover/active 文本高亮与圆点强调；不使用块背景，尽量轻。
   可达性 / A11y:
     - 层级色差清晰，黑底下保持 ≥ AA 对比（建议 h1~h6 分级由亮到暗）。
     - 发光半径克制，避免影响字形边界识别。
   ========================================================================== */
#typora-sidebar.active-tab-outline .outline-item {
  --olD-dim: rgba(255,255,255,.78);  /* 非高亮默认字色 | dimmed text */
  --olD-pad-y: 2px;
  --olD-pad-x: 4px;
  --olD-radius: 6px;
  --olD-line: 1.28;
  --olD-dur: .18s;

  /* 层级配色（同色不同名，不与他区共享） */
  --olD-h1: #ffffff;
  --olD-h2: #e6f7ff;
  --olD-h3: #bae7ff;
  --olD-h4: #91d5ff;
  --olD-h5: #69c0ff;
  --olD-h6: #40a9ff;

  /* 交互配色（仅本区） */
  --olD-hover: #23b3fc;
  --olD-hover-glow: rgba(35,179,252,.55);
  --olD-active: #ffe232;
  --olD-active-glow: rgba(255,226,50,.65);

  /* 活动强调（圆点） */
  --olD-accent: #ffe232;
  --olD-accent-w: 3px; /* 用于计算圆点偏移 | offset reference */

  margin: 2px 0 4px 6px;
  padding: var(--olD-pad-y) var(--olD-pad-x);
  background: transparent;
  border: none;
  color: var(--olD-dim);
  line-height: var(--olD-line);
  border-radius: var(--olD-radius);
  position: relative;
  overflow: visible; /* 防止 ::before 被裁切 | keep pseudo visible */
  transition: color var(--olD-dur) ease, text-shadow var(--olD-dur) ease;
}

/* 文本承载节点兜底（有的版本文字在 .outline-label 内）
   Fallback: some builds use .outline-label for text. */
#typora-sidebar.active-tab-outline .outline-item .outline-label { color: inherit; }

/* 层级色（同时兜底到 .outline-label）
   Map level colors; also affect .outline-label if present. */
#typora-sidebar.active-tab-outline .outline-h1 > .outline-item,
#typora-sidebar.active-tab-outline .outline-h1 > .outline-item .outline-label { color: var(--olD-h1); }
#typora-sidebar.active-tab-outline .outline-h2 > .outline-item,
#typora-sidebar.active-tab-outline .outline-h2 > .outline-item .outline-label { color: var(--olD-h2); }
#typora-sidebar.active-tab-outline .outline-h3 > .outline-item,
#typora-sidebar.active-tab-outline .outline-h3 > .outline-item .outline-label { color: var(--olD-h3); }
#typora-sidebar.active-tab-outline .outline-h4 > .outline-item,
#typora-sidebar.active-tab-outline .outline-h4 > .outline-item .outline-label { color: var(--olD-h4); }
#typora-sidebar.active-tab-outline .outline-h5 > .outline-item,
#typora-sidebar.active-tab-outline .outline-h5 > .outline-item .outline-label { color: var(--olD-h5); }
#typora-sidebar.active-tab-outline .outline-h6 > .outline-item,
#typora-sidebar.active-tab-outline .outline-h6 > .outline-item .outline-label { color: var(--olD-h6); }

/* Hover：文字提亮 + 轻微发光（不使用块背景）
   Hover state: brighten text with a subtle glow. */
#typora-sidebar.active-tab-outline .outline-item:hover {
  color: var(--olD-hover);
  text-shadow: 0 0 6px var(--olD-hover-glow);
}

/* Active：字色置黄 + 圆点强调（兼容 .active）
   Active state with yellow text + circular marker (also match .active). */
#typora-sidebar.active-tab-outline :is(.outline-item-active, .outline-item.active) {
  color: var(--olD-active);
  text-shadow: 0 0 8px var(--olD-active-glow);
}
#typora-sidebar.active-tab-outline :is(.outline-item-active, .outline-item.active)::before {
  content: "";
  position: absolute;
  left: calc(-1 * (var(--olD-accent-w) + 6px));
  top: 50%;
  transform: translateY(-50%);
  width: 8px; height: 8px;
  background: var(--olD-accent);
  border-radius: 50%;
  box-shadow: 0 0 6px var(--olD-active-glow);
}


/* =============================================================================
   REGION D — EXPANDER（折叠箭头）
   Scope:
     .outline-expander
   Vars（仅本区）:
     --olE-dur / --olE-op
   Function:
     轻量交互反馈：悬停微提亮与轻缩放；不改图标形态与布局。
   性能 / Perf:
     - scale 轻量友好；不使用滤镜与阴影，避免滚动抖动。
   ========================================================================== */
#typora-sidebar.active-tab-outline .outline-expander {
  --olE-dur: .18s;
  --olE-op: .92;

  background: transparent;
  margin-right: 6px;
  opacity: var(--olE-op);
  transition: opacity var(--olE-dur) ease, transform var(--olE-dur) ease;
}
#typora-sidebar.active-tab-outline .outline-expander:hover {
  opacity: 1;
  transform: scale(1.06);
}


/* =============================================================================
   REGION E — FOCUS & A11Y（键盘焦点）
   Scope:
     .outline-item:focus / :focus-visible
   Vars（仅本区）:
     --olF-outline / --olF-offset / --olF-glow
   Function:
     可见的焦点环与轻度发光，兼顾键盘导航人群的可达性。
   建议 / Tips:
     - 若与 Active 发光过叠，可略降 --olF-glow 或缩小外发光半径。
   ========================================================================== */
#typora-sidebar.active-tab-outline :is(.outline-item:focus, .outline-item:focus-visible) {
  --olF-outline: 2px solid rgba(255,255,255,.18);
  --olF-offset: 2px;
  --olF-glow: rgba(35,179,252,.55);

  outline: var(--olF-outline);
  outline-offset: var(--olF-offset);
  text-shadow: 0 0 6px var(--olF-glow);
}


/* 系统“减少动态”偏好（E、D 区相关动效一并关闭）
   Honor reduced motion by disabling transitions. */
@media (prefers-reduced-motion: reduce) {
  #typora-sidebar.active-tab-outline :is(.outline-item, .outline-expander) {
    transition: none;
  }
}

/* =============================================================================
   REGION F — FILTER INPUT（过滤输入框）
   Scope:
     .outline-content input[type="search"], .outline-filter input
   Vars（仅本区）:
     --olH-bg / --olH-fg / --olH-border / --olH-radius / --olH-ph / --olH-focus-*
   Function:
     输入框可见性与聚焦反馈；深色底下提升 caret 可见度。
   约束 / Constraints:
     - 仅针对 Outline 内部的搜索输入；不影响全局搜索或其它页签的表单控件。
   ========================================================================== */

/* 变量挂在根守卫下，便于统一调整 */
#typora-sidebar.active-tab-outline {
  --olH-shell-border: 1px solid rgba(255,255,255,.12);
  --olH-shell-radius: 8px;

  --olH-bg: #ffffff;                 /* 输入底色 */
  --olH-fg: #000000;                 /* 输入文字/插入符 */
  --olH-border: 1px solid rgba(255,255,255,.16);
  --olH-radius: 8px;
  --olH-ph: rgba(255,255,255,.45);   /* 占位提示色 */
  --olH-focus-border: rgba(255,255,255,.22);
  --olH-focus-ring: rgba(255,255,255,.12);
}

/* 壳容器：与 Files 版等价的 panel，但仅在 Outline 激活时接管 */
#typora-sidebar.active-tab-outline #file-library-search-panel{
  border: var(--olH-shell-border);
  border-radius: var(--olH-shell-radius);
  background: transparent;
  box-shadow: none;
  padding: 2px;          /* 让内部 input 不贴边，可按需调整/去掉 */
  contain: paint;        /* 限定重绘范围 */
}

/* 输入框本体：直接用 ID 命中，兼容任何 type */
#typora-sidebar.active-tab-outline #file-library-search-input{
  background: var(--olH-bg);
  color: var(--olH-fg);
  caret-color: var(--olH-fg);
  border: var(--olH-border);
  border-radius: var(--olH-radius);
  padding: 6px 10px;
  width: 100%;
  box-sizing: border-box;
  outline: none;
}

/* 占位符 */
#typora-sidebar.active-tab-outline #file-library-search-input::placeholder{
  color: var(--olH-ph);
}

/* 聚焦反馈 */
#typora-sidebar.active-tab-outline #file-library-search-input:focus{
  border-color: var(--olH-focus-border);
  box-shadow: 0 0 0 2px var(--olH-focus-ring);
}

/* =============================================================================
   REGION G — RESIZER BAR（分隔拖拽条 · 仅 Outline 激活时）
   Scope:
     body:has(#typora-sidebar.active-tab-outline) .typora-sidebar-resizer-bar
   Vars（仅本区）:
     --olJ-w / --olJ-bg / --olJ-hover / --olJ-shadow / --olJ-dur / --olJ-accent
   Function:
     统一黑系分隔条、悬停/拖拽反馈与过渡；与其它区完全解耦。
   备注 / Notes:
     - 通过 body:has(...) 精准限定“仅当 Outline 激活时”的样式接管。
     Extra Guard: 当 body.megamenu-opened 存在时，本区样式全部失效
   ========================================================================== */
body:not(.megamenu-opened):has(#typora-sidebar.active-tab-outline) .typora-sidebar-resizer-bar {
  --olJ-w: 8px;
  --olJ-bg: #0f0f0f;
  --olJ-hover: #1a1a1a;
  --olJ-shadow: 0 0 0 1px rgba(255,255,255,.10);
  --olJ-dur: .18s;

  width: var(--olJ-w);
  background: var(--olJ-bg);
  box-shadow: var(--olJ-shadow);
  cursor: col-resize;
  transition: background var(--olJ-dur) ease, box-shadow var(--olJ-dur) ease;
}
body:not(.megamenu-opened):has(#typora-sidebar.active-tab-outline) .typora-sidebar-resizer-bar:hover {
  background: var(--olJ-hover);
  box-shadow: 0 0 0 1px rgba(255,255,255,.10);
}
body:not(.megamenu-opened):has(#typora-sidebar.active-tab-outline) .typora-sidebar-resizer-bar:active,
body:not(.megamenu-opened):has(#typora-sidebar.active-tab-outline) .typora-sidebar-resizer-bar.dragging {
  --olJ-accent: #ffe232; /* 本区独立强调色 | local accent */

  background: var(--olJ-hover);
  box-shadow:
    inset 0 0 0 2px var(--olJ-accent),
    0 0 10px rgba(255,226,50,.35);
}

/* Reduced Motion：同理加守卫 */
@media (prefers-reduced-motion: reduce) {
  body:not(.megamenu-opened):has(#typora-sidebar.active-tab-outline) .typora-sidebar-resizer-bar {
    transition: none;
  }
}

/* =============================================================================
   REGION H — FONT ROOT（字体设置 | 仅 Outline 侧边栏激活时）
   Scope:
     #typora-sidebar.active-tab-outline 内部文字
   Vars（仅本区）:
     --ol-font-ui / --ol-font-body / --ol-font-code / --ol-font-head
     （依赖 prerequisite.css 中的 @font-face 名称）
   Function:
     - 统一 Outline 区的 UI/标题/代码字体映射
     - 仅限 Outline 侧边栏生效，不影响正文与其他区域
   ========================================================================== */
/* 根上挂变量：OK */
#typora-sidebar.active-tab-outline {
  --ol-font-ui: 'AliPuHuiTi', 'Microsoft YaHei', sans-serif;
  --ol-font-body: 'SourceHanSerifSC', serif;
  --ol-font-code: 'JetBrainsMonoNL', 'RobotoMono', monospace;
  --ol-font-head: 'GuDuYanHei', 'AliPuHuiTi', sans-serif;
}

/* A) 让“UI 字体”主要靠继承：只需设在根和常见容器根，后代用 where 不抬特异性 */
#typora-sidebar.active-tab-outline,
#typora-sidebar.active-tab-outline :where(
  .sidebar, #sidebar, #sidebar-content, .sidebar-content,
  .outline-content
){
  font-family: var(--ol-font-ui);
}

/* B) 需要覆写为“标题字体”的少量节点（使用 where 降特异性） */
#typora-sidebar.active-tab-outline :where(.info-panel-tab-title-group, .info-panel-tab-title){
  font-family: var(--ol-font-head);
}

/* C) 代码片段仅在 Outline 内部指定等宽（不影响正文区域） */
#typora-sidebar.active-tab-outline :where(code, kbd, pre, samp){
  font-family: var(--ol-font-code);
}

/* =============================================================================
   REGION I — OUTLINE MENU · Yin-Yang Skin（大纲菜单皮肤 · 阴阳鱼）
   Scope:
     #outline-menu（Typora 的大纲菜单 ID，避免影响 Files/正文菜单）
   Design:
     - 深色半透明卡片 + 低不透明度“阴阳鱼”水印（不滚动、不闪烁）
     - 轻交互：仅背景/文字色过渡；不使用重滤镜与大阴影
     - 无需 :has()；以 ID 唯一命中，满足“作用域收敛”与性能要求
   Vars（仅本区，olY*）:
     结构：--olY-radius / --olY-shadow / --olY-pad / --olY-item-h / --olY-gap
     背景：--olY-bg / --olY-border / --olY-img / --olY-img-opacity / --olY-img-size
     文字：--olY-fg / --olY-dim / --olY-accent / --olY-hover-fg / --olY-active-fg
     交互：--olY-hover / --olY-active / --olY-dur
   ========================================================================== */

#outline-menu.dropdown-menu.context-menu.ext-context-menu {
  /* —— I 组变量 —— */
  --olY-radius: 12px;
  --olY-shadow: 0 12px 28px rgba(0,0,0,.35);
  --olY-pad: 8px;
  --olY-item-h: 36px;
  --olY-gap: 6px;

  /* 背景与边界 */
  --olY-bg: #101114;                           /* 深底 */
  --olY-border: 1px solid rgba(255,255,255,.10);

  /* 阴阳鱼水印（请按你的打包路径替换 url） */
  /* 示例：url("file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Main_Visual/Assets/Backgrounds/yinyang-fish.png") */
  --olY-img: url("file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Assets/Siderbar/%E9%98%B4%E9%98%B3%E9%B1%BC.png");
  --olY-img-opacity: .10;                      /* 透明度（0.08–0.16 建议） */
  --olY-img-size: 240px;                       /* 尺寸（相对菜单宽度） */

  /* 文本与强调 */
  --olY-fg: #e9eef5;                           /* 文字常态 */
  --olY-dim: color-mix(in srgb, var(--olY-fg) 70%, transparent);
  --olY-accent: #23b3fc;                       /* 强调色（勾选/状态/快捷键） */
  --olY-hover-fg: #f5fbff;
  --olY-active-fg: #ffe232;

  /* 行为色与动效 */
  --olY-hover: #181b22;                        /* hover 背景 */
  --olY-active: #222633;                       /* active/按下 */
  --olY-dur: .14s;

  /* —— 容器本体 —— */
  background: var(--olY-bg);
  color: var(--olY-fg);
  border: var(--olY-border);
  border-radius: var(--olY-radius);
  box-shadow: var(--olY-shadow);
  padding: var(--olY-pad);
  min-width: 220px;
  overflow: hidden;                             /* 裁剪水印圆角 */
  backdrop-filter: none;                        /* 禁重滤镜 */
  contain: paint;                               /* 限定重绘范围 */
}

/* 阴阳鱼水印（不改 DOM，放在容器下层） */
#outline-menu.dropdown-menu.context-menu.ext-context-menu::before{
  content:"";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background:
    radial-gradient(ellipse at 50% 50%, rgba(255,255,255,.04), transparent 60%),
    var(--olY-img) center/var(--olY-img-size) no-repeat;
  opacity: var(--olY-img-opacity);
  filter: none;                                 /* 避免滤镜开销 */
}

/* —— 菜单项容器 —— */
#outline-menu.dropdown-menu.context-menu.ext-context-menu > li{
  margin: 0 0 var(--olY-gap) 0;
  border-radius: 8px;
  overflow: hidden;
}

/* 分隔线 */
#outline-menu.dropdown-menu.context-menu.ext-context-menu > li.divider{
  height: 1px;
  margin: 6px 2px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.14), transparent);
  border: 0;
}

/* —— 菜单项（a/menuitem）—— */
#outline-menu.dropdown-menu.context-menu.ext-context-menu > li > a,
#outline-menu.dropdown-menu.context-menu.ext-context-menu > li > .menuitem{
  display: flex;
  align-items: center;
  gap: 10px;
  height: var(--olY-item-h);
  padding: 0 12px;
  background: transparent;
  color: var(--olY-fg);
  text-decoration: none;
  border-radius: 8px;
  white-space: nowrap;
  transition: background var(--olY-dur) ease, color var(--olY-dur) ease;
}

/* 悬停/按下 */
#outline-menu.dropdown-menu.context-menu.ext-context-menu > li:hover > a,
#outline-menu.dropdown-menu.context-menu.ext-context-menu > li:hover > .menuitem{
  background: var(--olY-hover);
  color: var(--olY-hover-fg);
}
#outline-menu.dropdown-menu.context-menu.ext-context-menu > li:active > a,
#outline-menu.dropdown-menu.context-menu.ext-context-menu > li:active > .menuitem{
  background: var(--olY-active);
  color: var(--olY-active-fg);
}

/* “已开启”状态（Typora 的 .state-on） */
#outline-menu.dropdown-menu.context-menu.ext-context-menu .state-on{
  color: var(--olY-accent) !important;
  text-shadow: 0 0 6px color-mix(in srgb, var(--olY-accent) 55%, transparent);
}

/* 右侧快捷键/次级说明 */
#outline-menu.dropdown-menu.context-menu.ext-context-menu .menuitem-shortcut,
#outline-menu.dropdown-menu.context-menu.ext-context-menu .kbr{
  margin-left: auto;
  color: var(--olY-dim);
}

/* 键盘可达性（focus ring） */
#outline-menu.dropdown-menu.context-menu.ext-context-menu :is(a:focus, .menuitem:focus){
  outline: 2px solid rgba(255,255,255,.20);
  outline-offset: 2px;
}

/* Reduced Motion：关闭过渡，避免焦点移动时轻微抖动 */
@media (prefers-reduced-motion: reduce){
  #outline-menu.dropdown-menu.context-menu.ext-context-menu > li > a,
  #outline-menu.dropdown-menu.context-menu.ext-context-menu > li > .menuitem{
    transition: none;
  }
}
/* =============================== END OF PACKAGE ============================ */

/* =======================================================================================
   Rhapsody · Files Sidebar · List Mode（文件侧栏 · 列表模式 · 样式包）
   设计理念 / Design Concept
   - 严格“分区自持变量”：A=容器底色/前景/描边；B=交互变量与关键帧；C=搜索；D=滚动条；
     E=字体；F=分隔拖拽条；G=文件右键菜单。各分区仅在自身作用域内取用变量，不跨区。
   - 不改动 DOM 结构（Typora 限制）；只锚定已知 ID/类；大量使用 :is/:where 降低特异性，
     防止样式渗漏并便于后续覆盖与维护。
   - 动画“按需启用”：B 区流动渐变默认暂停，仅在容器 hover 时运行；同时尊重
     prefers-reduced-motion，提供无动画降级。
   - 性能优先：A 区只做“容器级”纯色与描边，交互渐变仅在 B 区出现；避免跨区变量与
     深层级选择器重算；:has() 仅用于 F 区开关（并有 MegaMenu 打开时的显式回退）。
   - 视觉统一：保持 Mirror’s Edge 三色（#ff2a2a / #23b3fc / #ffe232）作为交互层主题色；
     容器层维持纯色基底，确保层次清晰。

   使用说明 / Usage Notes
   - 仅当 #typora-sidebar.active-tab-files.use-file-list-style 存在时激活，不影响树形/大纲/写作区。
   - 可与其它区域样式并行加载；MegaMenu 打开时，F 区分隔条显式还原；G 区用 ul#file-menu
     直锚以适配 Portal（不依赖 :has()）。

   兼容性 / Compatibility
   - 优化于 Chromium/Electron（Typora）；旧内核自动降级为静态底色与无动画。
   - D 区滚动条为 WebKit 私有实现，非 WebKit 内核自动忽略。

   可调参数 / Adjustable Params
   - A：--files-core-bg / --files-core-fg / --files-core-border
   - B：渐变三色/时长、圆角、发光强度、左侧强调线、动画开关
   - C：搜索壳/输入框的底色、前景、描边、圆角、插入符色
   - D：滚动条宽高、圆角、光泽与悬停亮度
   - E：--files-font-ui / --files-font-head / --files-font-code
   - F：分隔条宽度、idle/hover/active 背景与描边阴影
   - G：右键菜单配色、半径、阴影、动效时长与可访问性描边

   QA / Scope Fence
   - 仅命中 Files×List；关键帧命名以 catalystTabFlow--files / --filemenu 前缀避免冲突；
     不向其它区域（B–H 以外）泄露变量或样式。
   ======================================================================================= */

/* ========================================================================== */
/* REGION A — SIDEBAR CORE ROOT（侧边栏核心 · 仅 Files 激活 & 列表模式）       */
/* Scope: #typora-sidebar.active-tab-files.use-file-list-style                 */
/* Function: 定义 Files 列表模式下的“容器级”底色/前景/描边，并应用到常见容器；  */
/*           不再向其它区域（B–H）提供跨区变量。                               */
/* Adjustable Params: --files-core-bg / --files-core-fg / --files-core-border  */
/* Compatibility: Chromium/Electron (Typora)。旧内核退化为静态底色。           */
/* ========================================================================== */
#typora-sidebar.active-tab-files.use-file-list-style{
  /* —— container-only palette —— */
  --files-core-bg: #ff4d4f;                 /* 容器底色 */
  --files-core-fg: #ffffff;                 /* 容器前景（文字） */
  --files-core-border: rgba(255,77,79,.22); /* 细描边 */

  /* 仅 A 区使用：把容器与常见子容器统一为 core 底色/前景/描边 */
  background: var(--files-core-bg);
  color: var(--files-core-fg);
  border-color: var(--files-core-border);
}

/* ========================================================================== */
/* REGION B — SIDEBAR INTERACTABLES（交互项 · Files×列表）                     */
/* Scope: #typora-sidebar.active-tab-files.use-file-list-style                 */
/* Function: 仅定义交互用变量与状态（静态/hover/active 的渐变、发光、圆角等）。  */
/* Adjustable Params: 渐变三色/时长、圆角、发光强度、左侧强调线、动画开关。      */
/* Compatibility: 全现代内核。prefers-reduced-motion 将自动降级。               */
/* ========================================================================== */
#typora-sidebar.active-tab-files.use-file-list-style{
  /* —— B 区专属变量（不跨区） —— */
  --files-int-active-anim: paused;           /* 默认暂停；容器 hover 时再 running */
  --files-int-radius: 8px;                   /* 交互项圆角 */
  --files-int-border: 1px solid transparent; /* 边框 */
  --files-int-stroke: inset 0 0 0 1px rgba(255,77,79,.22);

  --files-grad-1: #ff2a2a;   /* 渐变三色（交互项用） */
  --files-grad-2: #23b3fc;
  --files-grad-3: #ffe232;
  --files-flow-duration: 6s; /* 渐变时长 */

  --files-glow-a: rgba(35,179,252,0.35);     /* 发光（hover） */
  --files-glow-b: rgba(255,42,42,0.25);
  --files-glow-active: rgba(35,179,252,0.45);/* 发光（active） */

  --files-accent: #ff2a2a;                   /* 左侧强调线 */
}
/* 容器 hover 才播放 active 的流动动画 */
#typora-sidebar.active-tab-files.use-file-list-style       { --files-int-active-anim: paused;  }
#typora-sidebar.active-tab-files.use-file-list-style:hover { --files-int-active-anim: running; }

/* 静态态（非 active 且未 hover） */
#typora-sidebar.active-tab-files.use-file-list-style :is(
  .file-list-item,
  .file-library-node > .file-node-background,
  .sidebar-footer-item
):not(.active):not(:hover){
  background: inherit;
  color: inherit;
  border: var(--files-int-border);
  box-shadow: var(--files-int-stroke);
  filter: none;
  border-radius: var(--files-int-radius);
  transition:
    background .25s ease, color .25s ease,
    box-shadow .25s ease, border-color .25s ease, filter .25s ease;
}

/* Hover（仅 hover 才开流动渐变） */
#typora-sidebar.active-tab-files.use-file-list-style :is(
  .info-panel-tab-title:not(.active):hover,
  .file-list-item:not(.active):hover,
  .file-library-node:hover > .file-node-background:not(.active),
  .sidebar-footer-item:hover,
  .footer-item:hover
){
  background: linear-gradient(135deg, var(--files-grad-1), var(--files-grad-2), var(--files-grad-3));
  background-size: 300% 300%;
  animation: catalystTabFlow--files var(--files-flow-duration) ease infinite;
  color: #fff;
  border-color: transparent;
  box-shadow:
    inset 0 0 0 1px rgba(255,77,79,.18),
    0 0 8px var(--files-glow-a),
    0 0 16px var(--files-glow-b);
  border-radius: var(--files-int-radius);
}

/* Active（静态渐变 + 左侧强调线） */
#typora-sidebar.active-tab-files.use-file-list-style :is(
  #info-panel-tab-file,
  .file-list-item.active,
  .file-library-node.active > .file-node-background
){
  background: linear-gradient(135deg, var(--files-grad-2), var(--files-grad-3), var(--files-grad-1));
  background-size: 300% 300%;
  color:#fff; border-color:transparent;
  box-shadow:
    inset 3px 0 0 0 var(--files-accent),
    inset 0 0 0 1px rgba(255,77,79,.18),
    0 0 10px var(--files-glow-active);
  border-radius: var(--files-int-radius);
  animation: catalystTabFlow--files var(--files-flow-duration) ease infinite;
  animation-play-state: var(--files-int-active-anim); /* paused | running */
}

/* Active + Hover（轻提亮） */
#typora-sidebar.active-tab-files.use-file-list-style :is(
  #info-panel-tab-file:hover,
  .file-list-item.active:hover,
  .file-library-node.active > .file-node-background:hover
){
  filter: brightness(1.08);
  border-color: transparent;
  box-shadow:
    inset 3px 0 0 0 var(--files-accent),
    inset 0 0 0 1px rgba(255,77,79,.16),
    0 0 14px rgba(35,179,252,0.55),
    0 0 20px rgba(255,42,42,0.35);
}

/* 关键帧（B 区专属） */
@keyframes catalystTabFlow--files{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

/* 降动态偏好 */
@media (prefers-reduced-motion: reduce){
  #typora-sidebar.active-tab-files.use-file-list-style :is(
    #info-panel-tab-file,
    .file-list-item.active,
    .file-library-node.active > .file-node-background,
    .info-panel-tab-title:not(.active):hover,
    .file-list-item:not(.active):hover,
    .file-library-node:hover > .file-node-background:not(.active),
    .sidebar-footer-item:hover,
    .footer-item:hover
  ){
    animation:none !important;
    background-position:50% 50%;
  }
}

/* ========================================================================== */
/* REGION C — SEARCH PANEL ROOT（搜索区 root · Files×列表）                    */
/* Scope: #typora-sidebar.active-tab-files.use-file-list-style #file-library-search-panel */
/* Function: 搜索壳与输入框的底色/前景/描边/圆角，仅本区变量。                   */
/* Adjustable Params: shell 边框、输入框底色/文字/描边/圆角/插入符色。           */
/* Compatibility: 现代内核。                                                   */
/* ========================================================================== */
#typora-sidebar.active-tab-files.use-file-list-style{
  /* —— C 区专属变量 —— */
  --files-search-shell-border: 1px solid rgba(255,77,79,.22);
  --files-search-input-bg: #ecafaf;
  --files-search-input-fg: #ab0bf4;
  --files-search-input-border: 1px solid rgba(0,0,0,.12);
  --files-search-input-radius: 6px;
}
#typora-sidebar.active-tab-files.use-file-list-style #file-library-search-panel{
  border: var(--files-search-shell-border);
  box-shadow:none;
  background: inherit;
  border-radius: 8px;
}
#typora-sidebar.active-tab-files.use-file-list-style #file-library-search-panel input[type="search"]{
  background: var(--files-search-input-bg);
  color: var(--files-search-input-fg);
  border: var(--files-search-input-border);
  outline: none;
  border-radius: var(--files-search-input-radius);
  padding: 6px 10px;
  caret-color: var(--files-search-input-fg);
}

/* ========================================================================== */
/* REGION D — SCROLLBAR ROOT（琉璃蓝 · 仅 Files 侧栏内部）                      */
/* Scope: #typora-sidebar.active-tab-files.use-file-list-style 内部滚动容器      */
/* Function: 侧栏内部滚动条的拇指/轨道外观（不影响主视口/其他滚动容器）。          */
/* Adjustable Params: 三色、光泽、阴影、宽高、圆角、悬停亮度。                     */
/* Compatibility: WebKit 滚动条。非 WebKit 内核自动忽略。                        */
/* ========================================================================== */

#typora-sidebar.active-tab-files.use-file-list-style *::-webkit-scrollbar{
  width:12px; height:12px; background:transparent;
}
#typora-sidebar.active-tab-files.use-file-list-style *::-webkit-scrollbar-track{
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
  border-radius:10px;
}
#typora-sidebar.active-tab-files.use-file-list-style *::-webkit-scrollbar-thumb{
  border-radius:10px; border:1px solid rgba(255,255,255,.18);
  background-image: linear-gradient(180deg, #9cecff, #40b8ff 40%, #0a6ed1);
  background-size:200% 200%;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.72),
    inset 0 -1px 0 rgba(0,0,0,.35),
    0 0 0 1px rgba(255,255,255,.10),
    0 0 12px rgba(64,184,255,.42);
  transition: filter .18s ease, box-shadow .18s ease, background-position .6s ease;
}
#typora-sidebar.active-tab-files.use-file-list-style *::-webkit-scrollbar-thumb:horizontal{
  background-image: linear-gradient(90deg, #9cecff, #40b8ff 40%, #0a6ed1);
}
#typora-sidebar.active-tab-files.use-file-list-style *::-webkit-scrollbar-thumb:hover{
  filter: brightness(1.08) saturate(1.15);
  background-position: 100% 50%;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.72),
    inset 0 -1px 0 rgba(0,0,0,.40),
    0 0 0 1px rgba(255,255,255,.14),
    0 0 16px rgba(64,184,255,.42);
}
#typora-sidebar.active-tab-files.use-file-list-style *::-webkit-scrollbar-corner{
  background:transparent;
}
@media (prefers-reduced-motion: reduce){
  #typora-sidebar.active-tab-files.use-file-list-style *::-webkit-scrollbar-thumb{
    transition:none; background-position:50% 50%;
  }
}

/* ========================================================================== */
/* REGION E — FONT ROOT（字体设置 · 仅 Files 侧栏）                             */
/* Scope: #typora-sidebar.active-tab-files.use-file-list-style 内部文字         */
/* Function: 侧栏 UI/标题/代码的字体家族（本区独立变量，不跨区）。               */
/* Adjustable Params: --files-font-ui / --files-font-head / --files-font-code。  */
/* Compatibility: 现代内核。                                                   */
/* ========================================================================== */
/* 变量保持不变 */
#typora-sidebar.active-tab-files.use-file-list-style{
  --files-font-ui: 'AliPuHuiTi','Microsoft YaHei',sans-serif;
  --files-font-code:'JetBrainsMonoNL','RobotoMono',monospace;
  --files-font-head:'GuDuYanHei','AliPuHuiTi',sans-serif;
}

/* ① UI 基础字体（降特异性版本） */
#typora-sidebar.active-tab-files.use-file-list-style,
#typora-sidebar.active-tab-files.use-file-list-style :where(
  .sidebar, #sidebar, #sidebar-content, .sidebar-content,
  #file-library, #file-library-list, .file-list, .file-tree,
  .info-panel-tab-title-group, .info-panel-tab-title,
  .file-list-item, .file-library-node, .sidebar-footer, .sidebar-menu
){
  font-family: var(--files-font-ui);
}

/* ② 标题用 Head 字体（会自然覆盖 ①） */
#typora-sidebar.active-tab-files.use-file-list-style :is(.info-panel-tab-title-group, .info-panel-tab-title){
  font-family: var(--files-font-head);
}

/* ③ 代码用等宽字体（会自然覆盖 ①） */
#typora-sidebar.active-tab-files.use-file-list-style code{
  font-family: var(--files-font-code);
}

/* ========================================================================== */
/* REGION F — RESIZER BAR（分隔拖拽条 · Files×列表×非 MegaMenu）                */
/* Scope: （推荐）#typora-sidebar ~ .typora-sidebar-resizer-bar                 */
/* Function: 分隔条的宽度/颜色/悬停与拖动态（本区独立变量）。                     */
/* Adjustable Params: 宽度、idle/hover/active 背景、描边阴影。                    */
/* Compatibility: 现代内核。MegaMenu 打开时回退为主题默认。                      */
/* ========================================================================== */

body:not(.megamenu-opened):has(#typora-sidebar.active-tab-files.use-file-list-style){
  --files-resizer-w: 8px;
  --files-resizer-bg: #ff4d4f;
  --files-resizer-hover: #ff5f61;
  --files-resizer-active: #ff2a2a;
  --files-resizer-shadow: 0 0 0 1px rgba(255,77,79,.22);
}

body:not(.megamenu-opened):has(#typora-sidebar.active-tab-files.use-file-list-style)
  .typora-sidebar-resizer-bar{
  width: var(--files-resizer-w);
  background: var(--files-resizer-bg);
  box-shadow: var(--files-resizer-shadow);
  cursor: col-resize;
  transition: background .18s ease, box-shadow .18s ease;
}

body:not(.megamenu-opened):has(#typora-sidebar.active-tab-files.use-file-list-style)
  .typora-sidebar-resizer-bar:hover{
  background: var(--files-resizer-hover);
  box-shadow: 0 0 0 1px rgba(255,77,79,.30);
}

body:not(.megamenu-opened):has(#typora-sidebar.active-tab-files.use-file-list-style)
  .typora-sidebar-resizer-bar:active,
body:not(.megamenu-opened):has(#typora-sidebar.active-tab-files.use-file-list-style)
  .typora-sidebar-resizer-bar.dragging{
  background: var(--files-resizer-hover);
  box-shadow: inset 0 0 0 2px var(--files-resizer-active),
              0 0 10px rgba(255,42,42,.35);
}

@media (prefers-reduced-motion: reduce){
  body:not(.megamenu-opened):has(#typora-sidebar.active-tab-files.use-file-list-style)
    .typora-sidebar-resizer-bar{ transition:none; }
}

/* MegaMenu 打开时显式还原 */
body.megamenu-opened .typora-sidebar-resizer-bar{
  background: initial;
  box-shadow: none;
}

/* ========================================================================== */
/* REGION G — FILE CONTEXT MENU（电紫 · 仅右键菜单）                             */
/* Scope: ul#file-menu.dropdown-menu.context-menu.ext-context-menu（右键弹出）   */
/* Function: 右键文件菜单外观与交互（本区自带变量；不影响底部菜单等其它入口）。     */
/* Notes: 不使用 :has；菜单可能通过 Portal 挂在 body，下列选择器已直接锚定 ID。     */
/* ========================================================================== */
/* ===== Files×List 专用右键菜单（Portal 安全，使用 :has 守门） =============== */
@supports selector(:has(*)) {

  /* 主容器（只有 List 激活时命中） */
  body:has(#typora-sidebar.active-tab-files.use-file-list-style)
  ul#file-menu.dropdown-menu.context-menu.ext-context-menu{
    /* —— G 区专属变量：Starry Purple —— */
    --fm-bg:#3a0a5c; --fm-fg:#fff; --fm-border:rgba(212,0,255,.28);
    --fm-radius:10px; --fm-shadow:0 10px 24px rgba(0,0,0,.35);
    --fm-grad-1:#d400ff; --fm-grad-2:#7c4dff; --fm-grad-3:#ff6ec7;
    --fm-flow-duration:6s;
    --fm-glow-a:rgba(124,77,255,.38); --fm-glow-b:rgba(212,0,255,.30);
    --fm-item-radius:8px; --fm-item-stroke:inset 0 0 0 1px rgba(255,255,255,.14);
    --fm-item-pad-y:.48rem; --fm-item-pad-x:1rem;
    --fm-font-ui:'AliPuHuiTi','Microsoft YaHei',sans-serif;
    --fm-shortcut-fg:rgba(255,255,255,.85);
    --fm-divider:rgba(255,255,255,.22); --fm-disabled-fg:rgba(255,255,255,.55);
    --fm-focus-ring:#b388ff;

    font-family: var(--fm-font-ui);
    background: var(--fm-bg); color: var(--fm-fg);
    border:1px solid var(--fm-border); border-radius:var(--fm-radius);
    box-shadow:var(--fm-shadow); padding:.38rem 0; min-width:188px; z-index:9999;
    overflow:visible; isolation:isolate;
  }

  /* 分组标题 */
  body:has(#typora-sidebar.active-tab-files.use-file-list-style)
  ul#file-menu li.menuitem-group-label{
    padding:.42rem var(--fm-item-pad-x);
    margin:.15rem 0 .25rem;
    font-weight:700; opacity:.95;
  }

  /* 菜单项（默认态） */
  body:has(#typora-sidebar.active-tab-files.use-file-list-style)
  ul#file-menu li > a[role="menuitem"]{
    display:block; padding:var(--fm-item-pad-y) var(--fm-item-pad-x);
    color:var(--fm-fg); text-decoration:none; border-radius:var(--fm-item-radius);
    background:var(--fm-bg); box-shadow:var(--fm-item-stroke);
    transition: background .25s ease, color .25s ease, box-shadow .25s ease, filter .25s ease;
  }

  /* Hover（仅可悬停设备 & 非禁用项） */
  @media (hover:hover){
    body:has(#typora-sidebar.active-tab-files.use-file-list-style)
    ul#file-menu li > a[role="menuitem"]:not([aria-disabled="true"]):hover{
      background: linear-gradient(135deg, var(--fm-grad-1), var(--fm-grad-2), var(--fm-grad-3));
      background-size:300% 300%;
      animation: catalystTabFlow--filemenu var(--fm-flow-duration) ease infinite;
      color:#fff;
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,.12),
        0 0 10px var(--fm-glow-a),
        0 0 18px var(--fm-glow-b);
    }
  }

  /* Active（如有 .active） */
  body:has(#typora-sidebar.active-tab-files.use-file-list-style)
  ul#file-menu li.active > a[role="menuitem"]{
    background: linear-gradient(135deg, var(--fm-grad-2), var(--fm-grad-3), var(--fm-grad-1));
    background-size:300% 300%; color:#fff;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.12),
                0 0 12px rgba(124,77,255,.50);
  }

  /* Disabled（语义化禁用，并停动画） */
  body:has(#typora-sidebar.active-tab-files.use-file-list-style)
  ul#file-menu li > a[role="menuitem"][aria-disabled="true"]{
    color: var(--fm-disabled-fg); cursor:not-allowed; filter: grayscale(.15) opacity(.85);
    animation:none !important; background-position:50% 50%;
  }

  /* Focus 可访问性 */
  body:has(#typora-sidebar.active-tab-files.use-file-list-style)
  ul#file-menu li > a[role="menuitem"]:focus-visible{
    outline:2px solid var(--fm-focus-ring); outline-offset:2px;
  }

  /* 右侧快捷键 & 图标/分隔线 */
  body:has(#typora-sidebar.active-tab-files.use-file-list-style)
  ul#file-menu .ty-menu-shortcut{
    float:right; color:var(--fm-shortcut-fg);
    margin-left:1.25rem; font-size:.92em; letter-spacing:.02em;
  }

  /* 图标范围仅限“菜单项内部后代”，避免渗透 */
  body:has(#typora-sidebar.active-tab-files.use-file-list-style)
  ul#file-menu li > a[role="menuitem"] :is(.ty-icon, .fa, .ion){ color: currentColor; }

  /* 分隔线不拦截点击 */
  body:has(#typora-sidebar.active-tab-files.use-file-list-style)
  ul#file-menu li.divider{
    height:1px; margin:4px 0; background:var(--fm-divider); pointer-events:none;
  }

  /* 关键帧（名称与 Tree 版一致，便于复用工具链） */
  @keyframes catalystTabFlow--filemenu{
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
  }

  /* 降动态偏好 */
  @media (prefers-reduced-motion: reduce){
    body:has(#typora-sidebar.active-tab-files.use-file-list-style)
    ul#file-menu li > a[role="menuitem"]:hover{
      animation:none !important; background-position:50% 50%;
    }
  }
}
/* =============================== END OF PACKAGE ============================ */

/* =======================================================================================
   Rhapsody · Files Sidebar · Tree Mode（文件侧栏 · 树形模式 · 样式包）
   设计理念 / Design Concept
   - 严格“分区自持变量”：A=容器底色/前景/描边；B=交互与关键帧；C=搜索；D=滚动条；
     E=字体；F=分隔拖拽条；G=文件右键菜单。各分区仅在自身作用域内取用变量，不跨区。
   - 不改动 DOM（Typora 限制）；仅锚定已知 ID/类；大量使用 :is/:where 降低特异性，
     防止样式渗漏并便于后续覆盖与维护。
   - 动画“按需启用”：B 区流动渐变默认暂停，仅在容器 hover 时运行；同时尊重
     prefers-reduced-motion，提供无动画降级。
   - 性能优先：A 区只做“容器级”纯色与描边，交互渐变仅在 B 区出现；避免跨区变量与
     亮层级选择器重算；:has() 仅用于 F 区开关（并有 MegaMenu 打开时的显式回退）。
   - 主题：树形模式使用“孔雀绿”体系（亮绿基底 + 绿青流动 + 青柠提亮）；
     右键菜单使用“天空蓝”体系（亮空底 + 群青/靛蓝/幽蓝渐变 + 星芒高光）。

   使用说明 / Usage Notes
   - 仅当 #typora-sidebar.active-tab-files.use-file-tree-style 存在时激活，
     不影响列表/大纲/写作区。
   - 可与其它区域样式并行加载；MegaMenu 打开时，F 区分隔条显式还原；
     G 区用 ul#file-menu 直锚以适配 Portal（不依赖 :has()）。

   兼容性 / Compatibility
   - 优化于 Chromium/Electron（Typora）；旧内核自动降级为静态底色与无动画。
   - D 区滚动条为 WebKit 私有实现，非 WebKit 内核自动忽略。

   可调参数 / Adjustable Params
   - A：--files-core-bg / --files-core-fg / --files-core-border
   - B：渐变三色/时长、圆角、发光强度、左侧强调线、动画开关
   - C：搜索壳/输入框的底色、前景、描边、圆角、插入符色
   - D：滚动条宽高、圆角、光泽与悬停亮度
   - E：--files-font-ui / --files-font-head / --files-font-code
   - F：分隔条宽度、idle/hover/active 背景与描边阴影
   - G：右键菜单配色、半径、阴影、动效时长与可访问性描边

   QA / Scope Fence
   - 仅命中 Files×Tree；关键帧命名以 catalystTabFlow--filesTree / --filemenu 前缀避免冲突；
     不向其它区域（A–G 以外）泄露变量或样式。
   ======================================================================================= */


/* ========================================================================== */
/* REGION A — SIDEBAR CORE ROOT（侧边栏核心 · 仅 Files 激活 & 树形模式）       */
/* Scope: #typora-sidebar.active-tab-files.use-file-tree-style                 */
/* Function: 定义“容器级”底色/前景/描边，并应用到常见容器；不对交互着色。          */
/* Adjustable Params: --files-core-bg / --files-core-fg / --files-core-border  */
/* Compatibility: Chromium/Electron (Typora)。旧内核退化为静态底色。           */
/* ========================================================================== */
#typora-sidebar.active-tab-files.use-file-tree-style{
  /* —— container-only palette：Peacock Green —— */
  --files-core-bg: #07ceb1;                 /* 鲜青绿亮基底（建议：#0a6f60 ≈ peacock deep） */
  --files-core-fg: #ffffff;                 /* 前景（文字） */
  --files-core-border: rgba(16,233,128,.18);/* 细描边（翡翠绿系） */

  /* 仅 A 区使用：统一容器与常见子容器为“core”底色/前景/描边 */
  background: var(--files-core-bg);
  color: var(--files-core-fg);
  border-color: var(--files-core-border);
}

/* ========================================================================== */
/* REGION B — SIDEBAR INTERACTABLES（交互项 · Files×树形）                      */
/* Scope: #typora-sidebar.active-tab-files.use-file-tree-style                 */
/* Function: 仅定义交互变量与状态（静态/hover/active 的渐变、发光、圆角等）。      */
/* Adjustable Params: 渐变三色/时长、圆角、发光强度、左侧强调线、动画开关。        */
/* Compatibility: 全现代内核。prefers-reduced-motion 将自动降级。               */
/* ========================================================================== */
#typora-sidebar.active-tab-files.use-file-tree-style{
  /* —— B 区专属变量（不跨区） —— */
  --files-int-active-anim: paused;           /* 默认暂停；容器 hover 时再 running */
  --files-int-radius: 8px;                   /* 交互项圆角 */
  --files-int-border: 1px solid transparent; /* 边框 */
  --files-int-stroke: inset 0 0 0 1px rgba(16,233,128,.18);

  /* Peacock tri-gradient（交互用）：emerald → teal → lime */
  --files-grad-1: #10e980;   /* emerald */
  --files-grad-2: #00c7a1;   /* teal-green */
  --files-grad-3: #b6ff3b;   /* lime accent */
  --files-flow-duration: 6s; /* 渐变时长 */

  --files-glow-a: rgba(0,199,161,.40);       /* 发光（hover） */
  --files-glow-b: rgba(182,255,59,.28);
  --files-glow-active: rgba(0,199,161,.52);  /* 发光（active） */

  --files-accent: #10e980;                   /* 左侧强调线（Active） */
}
/* 容器 hover 才播放 active 的流动动画 */
#typora-sidebar.active-tab-files.use-file-tree-style       { --files-int-active-anim: paused;  }
#typora-sidebar.active-tab-files.use-file-tree-style:hover { --files-int-active-anim: running; }

/* 静态态（非 active 且未 hover）—— 树节点背景 */
#typora-sidebar.active-tab-files.use-file-tree-style :is(
  .file-tree-node > .file-node-background,
  .file-tree-node .file-node-collapsed,
  .file-tree-node .file-node-expanded,
  .sidebar-footer-item
):not(.active):not(:hover){
  background: inherit;
  color: inherit;
  border: var(--files-int-border);
  box-shadow: var(--files-int-stroke);
  filter: none;
  border-radius: var(--files-int-radius);
  transition:
    background .25s ease, color .25s ease,
    box-shadow .25s ease, border-color .25s ease, filter .25s ease;
}

/* Hover（仅 hover 才开流动渐变） */
#typora-sidebar.active-tab-files.use-file-tree-style :is(
  .file-tree-node > .file-node-background:hover,
  .file-tree-node .file-node-collapsed:hover,
  .file-tree-node .file-node-expanded:hover,
  .sidebar-footer-item:hover
){
  background: linear-gradient(135deg, var(--files-grad-1), var(--files-grad-2), var(--files-grad-3));
  background-size: 300% 300%;
  animation: catalystTabFlow--filesTree var(--files-flow-duration) ease infinite;
  color:#0a2430; /* 绿系高亮下的可读亮青文字，也可用 #fff 按需调整 */
  border-color: transparent;
  box-shadow:
    inset 0 0 0 1px rgba(16,233,128,.16),
    0 0 10px var(--files-glow-a),
    0 0 18px var(--files-glow-b);
  border-radius: var(--files-int-radius);
}

/* Active（静态渐变 + 左侧强调线） */
#typora-sidebar.active-tab-files.use-file-tree-style :is(
  .file-tree-node.active > .file-node-background,
  .file-tree-node.active .file-node-expanded
){
  background: linear-gradient(135deg, var(--files-grad-2), var(--files-grad-3), var(--files-grad-1));
  background-size: 300% 300%;
  color:#0a2430; border-color:transparent;
  box-shadow:
    inset 3px 0 0 0 var(--files-accent),
    inset 0 0 0 1px rgba(16,233,128,.16),
    0 0 12px var(--files-glow-active);
  border-radius: var(--files-int-radius);
  animation: catalystTabFlow--filesTree var(--files-flow-duration) ease infinite;
  animation-play-state: var(--files-int-active-anim); /* paused | running */
}

/* Active + Hover（轻提亮） */
#typora-sidebar.active-tab-files.use-file-tree-style :is(
  .file-tree-node.active > .file-node-background:hover,
  .file-tree-node.active .file-node-expanded:hover
){
  filter: brightness(1.08);
  border-color: transparent;
  box-shadow:
    inset 3px 0 0 0 var(--files-accent),
    inset 0 0 0 1px rgba(16,233,128,.14),
    0 0 16px rgba(0,199,161,.55),
    0 0 20px rgba(182,255,59,.35);
}

/* 关键帧（B 区专属） */
@keyframes catalystTabFlow--filesTree{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

/* 降动态偏好 */
@media (prefers-reduced-motion: reduce){
  #typora-sidebar.active-tab-files.use-file-tree-style :is(
    .file-tree-node > .file-node-background,
    .file-tree-node .file-node-collapsed,
    .file-tree-node .file-node-expanded,
    .sidebar-footer-item
  ){
    animation:none !important;
    background-position:50% 50%;
  }
}


/* ========================================================================== */
/* REGION C — SEARCH PANEL ROOT（搜索区 root · Files×树形）                     */
/* Scope: #typora-sidebar.active-tab-files.use-file-tree-style #file-library-search-panel */
/* Function: 搜索壳与输入框的底色/前景/描边/圆角，仅本区变量。                   */
/* Adjustable Params: shell 边框、输入框底色/文字/描边/圆角/插入符色。           */
/* Compatibility: 现代内核。                                                   */
/* ========================================================================== */
#typora-sidebar.active-tab-files.use-file-tree-style{
  /* —— C 区专属变量（孔雀绿协调） —— */
  --files-search-shell-border: 1px solid rgba(16,233,128,.22);
  --files-search-input-bg: #04ddc1;    /* 亮一阶孔雀绿，内凹可读 */
  --files-search-input-fg: #0400f8;    /* 淡薄荷白 */
  --files-search-input-border: 1px solid rgba(0,0,0,.12);
  --files-search-input-radius: 6px;
}
#typora-sidebar.active-tab-files.use-file-tree-style #file-library-search-panel{
  border: var(--files-search-shell-border);
  box-shadow:none;
  background: inherit;
  border-radius: 8px;
}
#typora-sidebar.active-tab-files.use-file-tree-style #file-library-search-panel input[type="search"]{
  background: var(--files-search-input-bg);
  color: var(--files-search-input-fg);
  border: var(--files-search-input-border);
  outline: none;
  border-radius: var(--files-search-input-radius);
  padding: 6px 10px;
  caret-color: var(--files-search-input-fg);
}


/* ========================================================================== */
/* REGION D — SCROLLBAR ROOT（翡翠青 · 仅 Files 侧栏内部）                       */
/* Scope: #typora-sidebar.active-tab-files.use-file-tree-style 内部滚动容器      */
/* Function: 侧栏内部滚动条拇指/轨道外观（不影响主视口/其他滚动容器）。            */
/* Adjustable Params: 三色、光泽、阴影、宽高、圆角、悬停亮度。                     */
/* Compatibility: WebKit 滚动条。非 WebKit 内核自动忽略。                        */
/* ========================================================================== */
#typora-sidebar.active-tab-files.use-file-tree-style *::-webkit-scrollbar{
  width:12px; height:12px; background:transparent;
}
#typora-sidebar.active-tab-files.use-file-tree-style *::-webkit-scrollbar-track{
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
  border-radius:10px;
}
#typora-sidebar.active-tab-files.use-file-tree-style *::-webkit-scrollbar-thumb{
  border-radius:10px; border:1px solid rgba(255,255,255,.16);
  background-image: linear-gradient(180deg, #66f3d1, #12cbb0 45%, #0a8a7a);
  background-size:200% 200%;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.72),
    inset 0 -1px 0 rgba(0,0,0,.35),
    0 0 0 1px rgba(255,255,255,.10),
    0 0 12px rgba(18,203,176,.40);
  transition: filter .18s ease, box-shadow .18s ease, background-position .6s ease;
}
#typora-sidebar.active-tab-files.use-file-tree-style *::-webkit-scrollbar-thumb:horizontal{
  background-image: linear-gradient(90deg, #66f3d1, #12cbb0 45%, #0a8a7a);
}
#typora-sidebar.active-tab-files.use-file-tree-style *::-webkit-scrollbar-thumb:hover{
  filter: brightness(1.08) saturate(1.12);
  background-position: 100% 50%;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.72),
    inset 0 -1px 0 rgba(0,0,0,.40),
    0 0 0 1px rgba(255,255,255,.14),
    0 0 16px rgba(18,203,176,.45);
}
#typora-sidebar.active-tab-files.use-file-tree-style *::-webkit-scrollbar-corner{
  background:transparent;
}
@media (prefers-reduced-motion: reduce){
  #typora-sidebar.active-tab-files.use-file-tree-style *::-webkit-scrollbar-thumb{
    transition:none; background-position:50% 50%;
  }
}


/* ========================================================================== */
/* REGION E — FONT ROOT（字体设置 · 仅 Files 侧栏）                             */
/* Scope: #typora-sidebar.active-tab-files.use-file-tree-style 内部文字         */
/* Function: 侧栏 UI/标题/代码的字体家族（本区独立变量，不跨区）。               */
/* Adjustable Params: --files-font-ui / --files-font-head / --files-font-code  */
/* Compatibility: 现代内核。                                                   */
/* ========================================================================== */
#typora-sidebar.active-tab-files.use-file-tree-style{
  --files-font-ui: 'AliPuHuiTi','Microsoft YaHei',sans-serif;
  --files-font-code:'JetBrainsMonoNL','RobotoMono',monospace;
  --files-font-head:'GuDuYanHei','AliPuHuiTi',sans-serif;
}
/* ① UI 基础字体（降特异性版本） */
#typora-sidebar.active-tab-files.use-file-tree-style,
#typora-sidebar.active-tab-files.use-file-tree-style :where(
  .sidebar, #sidebar, #sidebar-content, .sidebar-content,
  #file-library, .file-tree, .file-tree-node,
  .info-panel-tab-title-group, .info-panel-tab-title,
  .sidebar-footer, .sidebar-menu
){
  font-family: var(--files-font-ui);
}
/* ② 标题用 Head 字体（自然覆盖 ①） */
#typora-sidebar.active-tab-files.use-file-tree-style :is(.info-panel-tab-title-group, .info-panel-tab-title){
  font-family: var(--files-font-head);
}
/* ③ 代码用等宽字体（自然覆盖 ①） */
#typora-sidebar.active-tab-files.use-file-tree-style code{
  font-family: var(--files-font-code);
}


/* ========================================================================== */
/* REGION F — RESIZER BAR（分隔拖拽条 · Files×树形×非 MegaMenu）                */
/* Scope: （推荐）#typora-sidebar ~ .typora-sidebar-resizer-bar                 */
/* Function: 分隔条的宽度/颜色/悬停与拖动态（本区独立变量）。                     */
/* Adjustable Params: 宽度、idle/hover/active 背景、描边阴影。                    */
/* Compatibility: 现代内核。MegaMenu 打开时回退为主题默认。                      */
/* ========================================================================== */
body:not(.megamenu-opened):has(#typora-sidebar.active-tab-files.use-file-tree-style){
  --files-resizer-w: 8px;
  --files-resizer-bg: #0a8a7a;    /* 孔雀绿系 */
  --files-resizer-hover: #0e9f8c;
  --files-resizer-active: #12cbb0;
  --files-resizer-shadow: 0 0 0 1px rgba(16,233,128,.22);
}
body:not(.megamenu-opened):has(#typora-sidebar.active-tab-files.use-file-tree-style)
  .typora-sidebar-resizer-bar{
  width: var(--files-resizer-w);
  background: var(--files-resizer-bg);
  box-shadow: var(--files-resizer-shadow);
  cursor: col-resize;
  transition: background .18s ease, box-shadow .18s ease;
}
body:not(.megamenu-opened):has(#typora-sidebar.active-tab-files.use-file-tree-style)
  .typora-sidebar-resizer-bar:hover{
  background: var(--files-resizer-hover);
  box-shadow: 0 0 0 1px rgba(16,233,128,.30);
}
body:not(.megamenu-opened):has(#typora-sidebar.active-tab-files.use-file-tree-style)
  .typora-sidebar-resizer-bar:active,
body:not(.megamenu-opened):has(#typora-sidebar.active-tab-files.use-file-tree-style)
  .typora-sidebar-resizer-bar.dragging{
  background: var(--files-resizer-hover);
  box-shadow: inset 0 0 0 2px var(--files-resizer-active),
              0 0 10px rgba(16,233,128,.32);
}
/* MegaMenu 打开时显式还原 */
body.megamenu-opened .typora-sidebar-resizer-bar{
  background: initial;
  box-shadow: none;
}
@media (prefers-reduced-motion: reduce){
  body:not(.megamenu-opened):has(#typora-sidebar.active-tab-files.use-file-tree-style)
    .typora-sidebar-resizer-bar{ transition:none; }
}


/* ========================================================================== */
/* REGION G — FILE CONTEXT MENU（天空蓝 · 仅右键菜单）                           */
/* Scope: ul#file-menu.dropdown-menu.context-menu.ext-context-menu（右键弹出）   */
/* Function: 右键文件菜单外观与交互（本区自带变量；不影响底部菜单等其它入口）。     */
/* Notes: 不使用 :has；菜单可能通过 Portal 挂在 body，下列选择器已直接锚定 ID。     */
/* ========================================================================== */
/* ===== Files×Tree 专用右键菜单（Portal 安全，使用 :has 守门） =============== */
@supports selector(:has(*)) {

  /* 主容器（只有 Tree 激活时命中） */
  body:has(#typora-sidebar.active-tab-files.use-file-tree-style)
  ul#file-menu.dropdown-menu.context-menu.ext-context-menu{
    /* —— G 区专属变量：Starry Blue —— */
    --fm-bg:#1591da; --fm-fg:#eaf2ff; --fm-border:rgba(64,123,255,.28);
    --fm-radius:10px; --fm-shadow:0 10px 24px rgba(0,0,0,.35);
    --fm-grad-1:#1b2a6b; --fm-grad-2:#2740a6; --fm-grad-3:#0b6ad1;
    --fm-flow-duration:6s;
    --fm-glow-a:rgba(64,140,255,.36); --fm-glow-b:rgba(20,60,160,.36);
    --fm-item-radius:8px; --fm-item-stroke:inset 0 0 0 1px rgba(255,255,255,.12);
    --fm-item-pad-y:.48rem; --fm-item-pad-x:1rem;
    --fm-font-ui:'AliPuHuiTi','Microsoft YaHei',sans-serif;
    --fm-shortcut-fg:rgba(234,242,255,.88);
    --fm-divider:rgba(234,242,255,.18); --fm-disabled-fg:rgba(234,242,255,.55);
    --fm-focus-ring:#7fb3ff;

    font-family: var(--fm-font-ui);
    background: var(--fm-bg); color: var(--fm-fg);
    border:1px solid var(--fm-border); border-radius:var(--fm-radius);
    box-shadow:var(--fm-shadow); padding:.38rem 0; min-width:188px; z-index:9999;
    overflow:visible; isolation:isolate;
  }

  /* 分组标题 */
  body:has(#typora-sidebar.active-tab-files.use-file-tree-style)
  ul#file-menu li.menuitem-group-label{
    padding:.42rem var(--fm-item-pad-x); margin:.15rem 0 .25rem; font-weight:700; opacity:.95;
  }

  /* 菜单项（默认态） */
  body:has(#typora-sidebar.active-tab-files.use-file-tree-style)
  ul#file-menu li > a[role="menuitem"]{
    display:block; padding:var(--fm-item-pad-y) var(--fm-item-pad-x);
    color:var(--fm-fg); text-decoration:none; border-radius:var(--fm-item-radius);
    background:var(--fm-bg); box-shadow:var(--fm-item-stroke);
    transition: background .25s ease, color .25s ease, box-shadow .25s ease, filter .25s ease;
  }

  /* Hover（仅可悬停设备 & 非禁用项） */
  @media (hover:hover){
    body:has(#typora-sidebar.active-tab-files.use-file-tree-style)
    ul#file-menu li > a[role="menuitem"]:not([aria-disabled="true"]):hover{
      background: linear-gradient(135deg, var(--fm-grad-1), var(--fm-grad-2), var(--fm-grad-3));
      background-size:300% 300%;
      animation: catalystTabFlow--filemenu var(--fm-flow-duration) ease infinite;
      color:#fff;
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,.10),
        0 0 10px var(--fm-glow-a),
        0 0 18px var(--fm-glow-b);
    }
  }

  /* Active（如有 .active） */
  body:has(#typora-sidebar.active-tab-files.use-file-tree-style)
  ul#file-menu li.active > a[role="menuitem"]{
    background: linear-gradient(135deg, var(--fm-grad-2), var(--fm-grad-3), var(--fm-grad-1));
    background-size:300% 300%; color:#fff;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.10), 0 0 12px rgba(64,140,255,.48);
  }

  /* Disabled（语义化禁用，并停动画） */
  body:has(#typora-sidebar.active-tab-files.use-file-tree-style)
  ul#file-menu li > a[role="menuitem"][aria-disabled="true"]{
    color: var(--fm-disabled-fg); cursor:not-allowed; filter: grayscale(.15) opacity(.85);
    animation:none !important; background-position:50% 50%;
  }

  /* Focus 可访问性 */
  body:has(#typora-sidebar.active-tab-files.use-file-tree-style)
  ul#file-menu li > a[role="menuitem"]:focus-visible{
    outline:2px solid var(--fm-focus-ring); outline-offset:2px;
  }

  /* 右侧快捷键 & 图标/分隔线 */
  body:has(#typora-sidebar.active-tab-files.use-file-tree-style)
  ul#file-menu .ty-menu-shortcut{ float:right; color:var(--fm-shortcut-fg); margin-left:1.25rem; font-size:.92em; letter-spacing:.02em; }

  body:has(#typora-sidebar.active-tab-files.use-file-tree-style)
  ul#file-menu li > a[role="menuitem"] :is(.ty-icon, .fa, .ion){ color: currentColor; }

  body:has(#typora-sidebar.active-tab-files.use-file-tree-style)
  ul#file-menu li.divider{ height:1px; margin:4px 0; background:var(--fm-divider); pointer-events:none; }

  /* 关键帧（名称不变） */
  @keyframes catalystTabFlow--filemenu{
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
  }

  /* 降动态偏好 */
  @media (prefers-reduced-motion: reduce){
    body:has(#typora-sidebar.active-tab-files.use-file-tree-style)
    ul#file-menu li > a[role="menuitem"]:hover{
      animation:none !important; background-position:50% 50%;
    }
  }
}
/* =============================== END OF PACKAGE ============================ */

/* =======================================================================================
   Rhapsody — BODY PARAGRAPHS（正文段落样式）
   设计理念 / Design Concept
   - 严格作用域：仅限 #write 下的 <p>，避免影响代码块、引用块、列表等其它元素。
   - 排版优先：中文段落默认两端对齐并首行缩进 2em，兼顾中英文混排的整齐度。
   - 统一控制：字号、行距、缩进、字距、字重等集中变量化，便于全局调参。
   - 可读性增强：轻微 text-shadow 减弱屏幕锯齿感，保持长文阅读舒适度。
   - 兼容性好：保留 word-wrap 与现代 overflow-wrap，防止英文长单词溢出。
   - 性能友好：无复杂滤镜与动画，常态静止，适配 Typora/Electron 导出与 PDF 打印。
   ======================================================================================= */

/* ======================================================================================= */
/* REGION A — BODY PARAGRAPHS（正文段落样式 | Paragraph Style in Writing Area）            */
/* Scope: 仅限 #write 下的 <p> 元素                                                        */
/* 功能 / Function: 控制正文段落的字号、行距、缩进、对齐与排版宽度                           */
/* 可调参数 / Adjustable Params: font-size, line-height, text-indent, margin, font-family  */
/* Notes:                                                                                  */
/* - 两端对齐 text-align: justify，提升中文阅读体验                                        */
/* - 首行缩进 2em；中英文混排时保持排版规整                                                */
/* - 使用 prerequisite.css 中已定义的字体（AliPuHuiTi 等）:contentReference[oaicite:2]{index=2}                      */
/* - 保留 word-wrap 防止英文长单词溢出                                                     */
/* - 使用 text-shadow 提升可读性，弱化屏幕锯齿感                                           */
/* ======================================================================================= */
#write {
  --p-font-size: 16px;                            /* 正文字号 | Base font size */
  --p-line-height: 1.88;                          /* 行距 | Line height */
  --p-indent: 2em;                                /* 首行缩进 | First-line indent */
  --p-margin-y: 0.2em;                            /* 段落上下间距 | Vertical spacing */
  --p-color: #232931;                             /* 主体文字颜色 | Body text color */
  --p-font-family: 'AliPuHuiTi','Microsoft YaHei',sans-serif; /* 字体族 | Font family */
  --p-font-weight: 420;                           /* 字重 | Font weight */
  --p-letter-spacing: 0.02em;                     /* 字间距 | Letter spacing */
  --p-text-shadow-light: 0 0.3px 0.3px rgba(255,255,255,0.2);
  --p-text-shadow-dark: 0 0 0.4px rgba(0,0,0,0.05);
}

#write p {
  position: relative;       
  z-index: 6;                /* 避免被背景遮挡 | Stay above background layers */

  /* Typography / 字体排版 */
  font-size: var(--p-font-size);
  line-height: var(--p-line-height);
  text-align: justify;
  text-indent: var(--p-indent);
  margin: var(--p-margin-y) 0;

  color: var(--p-color);
  font-family: var(--p-font-family);
  font-weight: var(--p-font-weight);

  /* Subtle shadow for legibility */
  text-shadow:
    var(--p-text-shadow-light),
    var(--p-text-shadow-dark);

  /* Wrapping & spacing */
  -ms-word-wrap: break-word;
  word-wrap: break-word;
  white-space: normal;
  letter-spacing: var(--p-letter-spacing);
}
/* =============================== END OF PACKAGE ============================ */

/* =======================================================================================
   Rhapsody · Typora Headings Theme — 设计理念 / Design Concept
   ---------------------------------------------------------------------------------------
   核心基调 / Visual Tone
   - 童话 × 神话 × 赛博光感：层叠渐变、微发光阴影、局部能量描边，营造“叙事+科技”的混合气质。
   - 六级标题各有隐喻人物与色彩语言，既可独立成景，又能在全文形成统一的叙事氛围。

   语义映射 / Metaphor per Level
   - H1「帅气大王子」：中心徽标呼吸 + 顶部流光带，作为全文视觉锚点与开篇宣叙。
   - H2「齐天大圣」：金箍棒与赤金辐射，代表“章节转折”的磅礴气势。
   - H3「白雪公主」：粉紫斜向渐变与苹果彩蛋，承接段落组的柔和过渡。
   - H4「爱丽丝」：白卡 + 轻投影 + 兔表摇摆，适配中层结构与列表分节。
   - H5「雷声之锤」：蓝青能量描边 + 扫光，强调小节标题的技术/要点。
   - H6「狐面具」：祭典红与面具摇曳，用于注释、插曲与细粒度小节。

   交互哲学 / Interaction Principles
   - 常态静态、交互增强（Hover/Focus 才点亮）：减少打扰、维持编辑时的沉稳感。
   - A11y 优先：统一焦点可见、reduced-motion 降级、提示信息不喧宾夺主。
   - 视觉连续性：Hover 仅替换顶部层或增强层，避免“清栈”导致闪烁。

   性能与工程约束 / Performance & Engineering
   - Typora DOM 不可变更：全部效果以伪元素与局部变量实现（::before/::after + var()）。
   - 尽量使用 transform/opacity 过渡；避免全局性的 filter/大面积 blur/频繁 repaint。
   - 背景/阴影静态为主；循环动画仅限需要的层（如 H1 徽标、H5 扫光可按需降频或改交互触发）。
   - 资源控制：图标建议 1–1.5× 展示尺寸、优先 SVG/WebP，小图启用 drop-shadow 即可。
   - 可维护性：变量局部化（Local Only），每个 REGION 标注 Scope/Function/Adjustable Params。

   可访问性 / Accessibility
   - :focus-visible / :focus-within 统一焦点环与提示条；Reduced Motion 关闭动画与流动。
   - 色彩对比遵循深浅背景下可读性要求（标题文本 + 发光阴影组合）。

   命名与结构 / Naming & Structure
   - 均以「#write hN」为作用域，避免外溢；关键帧命名前缀 hN-* 保持唯一性。
   - REGION 分段：ROOT / ICON / INTERACTIONS / KEYFRAMES / A11Y / RESPONSIVE / NOTES。

   维护提示 / Maintenance Notes
   - 大文档或低配环境：优先降低/关闭循环动画（如 H5 thunderFlash），或切换轻量预设。
   - 如需主题变体（冷/暖/高对比），建议仅改变量，不动结构与关键帧名。
   ---------------------------------------------------------------------------------------

/* ========================================================================== */
/* REGION A — H1 ROOT（帅气大王子）                                             */
/* Scope: #write h1                                                           */
/* Function: 定义主标题的布局、底色、渐变层、排版与交互动效；                   */
/*           提供 LOGO 呼吸与上沿流光带作为视觉亮点。                         */
/* Adjustable Params: margin/padding、圆角尺寸、渐变配色、hover 态光影效果、   */
/*                   LOGO 尺寸/动画时长、流光条宽高/渐变/动画周期。           */
/* Compatibility: 现代浏览器 / Typora(Electron)；旧内核不支持动画时回退静态。 */
/* ========================================================================== */

#write h1{
  /* Layout */
  --h1-margin: 9rem auto 3rem;
  --h1-padding: 0.8em 2em;
  --h1-radius: 2rem;

  /* Base glass & border */
  --h1-bg: rgba(255,255,255,0.12);
  --h1-border: 2px solid rgba(255,255,255,0.35);

  /* Layered look */
  --h1-boxshadow: 0 0 1px #00f5d4, 0 0 2px #00f5d4, 1px 1px 2px rgba(0,48,96,0.25);
  --h1-bg-radial: radial-gradient(circle at 30% 40%, rgba(255,255,255,0.12) 0%, rgba(255,255,255,0.03) 60%, rgba(255,255,255,0) 100%);
  --h1-bg-linear: linear-gradient(145deg, rgba(255,255,255,0.13) 0%, rgba(200,240,255,0.06) 40%, rgba(255,255,255,0.1) 100%);

  /* Typography */
  --h1-color: #00d6ff;
  --h1-font: 'AliPuHuiTi','Microsoft YaHei',sans-serif;
  --h1-size: 2.6rem;
  --h1-lh: 1.4;
  --h1-weight: 900;
  --h1-letterspace: 0.04em;
  --h1-textshadow: 0 0 1px #00f5d4, 0 0 2px #00f5d4, 1px 1px 2px rgba(0,48,96,0.25);

  /* Hover accent */
  --h1-hover-bg-linear: linear-gradient(145deg, #fff4c1, #ffd88a, #ff9966);
  --h1-hover-boxshadow: 0 0 0 1.5px rgba(255,200,100,0.3), 0 0 18px rgba(255,180,80,0.4), 0 0 48px rgba(255,140,60,0.25);
  --h1-hover-color: #ffb300;
  --h1-hover-textshadow: 0 0 4px rgba(255,220,180,0.8), 0 0 12px rgba(255,180,80,0.6), 1px 1px 2px rgba(120,50,0,0.3);

  /* Top logo */
  --h1-logo-url: url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Logo/Headings_Icon/%E5%B8%85%E6%B0%94%E5%A4%A7%E7%8E%8B%E5%AD%90.webp');
  --h1-logo-size: 84px;
  --h1-logo-anim: 3.5s;

  /* Shimmer band */
  --h1-band-gradient: linear-gradient(90deg,#00bfff,#ff4d4f,#ffd700,#00bfff);
  --h1-band-width: 60%;
  --h1-band-height: 6px;
  --h1-band-anim: 5s;

  /* Transitions */
  --h1-transition: background 3s ease, box-shadow 3s ease, text-shadow 3s ease, color 3s ease;
  /* ============================================================================ */

  position: relative;
  display: block;
  text-align: center;
  margin: var(--h1-margin);
  padding: var(--h1-padding);

  /* 背景/边框/玻璃化 */
  background: var(--h1-bg);
  border: var(--h1-border);
  border-radius: var(--h1-radius);

  /* 冰晶光影 + 渐变层（多层并存，避免覆盖） */
  box-shadow: var(--h1-boxshadow);
  background-image: var(--h1-bg-radial), var(--h1-bg-linear);

  /* 文案样式（强科技感） */
  color: var(--h1-color);
  font-size: var(--h1-size);
  line-height: var(--h1-lh);
  font-weight: var(--h1-weight);
  font-family: var(--h1-font);
  letter-spacing: var(--h1-letterspace);
  z-index: 6;
  text-shadow: var(--h1-textshadow);

  transition: var(--h1-transition);
}

/* Hover：仅替换最上层渐变，保留底层光影栈（避免 background 简写清栈） */
#write h1:hover{
  background-image: var(--h1-hover-bg-linear), var(--h1-bg-radial);
  box-shadow: var(--h1-hover-boxshadow);
  color: var(--h1-hover-color);
  text-shadow: var(--h1-hover-textshadow);
}

/* 顶部 LOGO 呼吸（中心徽标 · 呼吸放缩） */
#write h1::before{
  content: "";
  position: absolute;
  top: -9rem;
  left: 50%;
  transform: translateX(-50%);
  width: var(--h1-logo-size); height: var(--h1-logo-size); max-width: 20vw;
  background-image: var(--h1-logo-url);
  background-size: contain; background-repeat: no-repeat; background-position: center;
  z-index: 4;
  opacity: .96;
  pointer-events: none;
  animation: h1-logoPulse var(--h1-logo-anim) ease-in-out infinite;
}

/* 上沿流光带（彩带往复） */
#write h1::after{
  content: "";
  position: absolute;
  top: -0.5em;
  left: 50%;
  transform: translateX(-50%) skewX(-5deg);
  width: var(--h1-band-width); height: var(--h1-band-height);
  background: var(--h1-band-gradient);
  background-size: 400%;
  animation: h1-shimmerPulse var(--h1-band-anim) ease-in-out infinite;
  border-radius: 4px;
  z-index: 2;
  opacity: .85;
  pointer-events: none;
  box-shadow:
    0 0 8px rgba(255,255,255,0.3),
    0 0 20px rgba(255,255,255,0.12),
    0 0 28px rgba(0,229,255,0.1);
}

/* H1 动画（本地唯一命名） */
@keyframes h1-logoPulse{
  0%,100%{ transform: translateX(-50%) scale(1); }
  50%{     transform: translateX(-50%) scale(1.06); }
}
@keyframes h1-shimmerPulse{
  0%{   background-position: 0%;   opacity: .25; }
  50%{  background-position: 200%; opacity: 1;   }
  100%{ background-position: 400%; opacity: .25; }
}

/* Reduced Motion：停掉补帧与流动 */
@media (prefers-reduced-motion: reduce){
  #write h1::before,
  #write h1::after{ animation: none !important; }
}

#write h1.md-focus::before{
  /* H1 Focus Tip Vars (local to this pseudo-element render) */
  --h1-tip-text: "🌞 All things arise from a single thought.\A\万象之源，皆出一念。";
  --h1-tip-color: #168fcf;
  --h1-tip-bg: #fff8fa;
  --h1-tip-border: 2px solid #168fcf;

  content: var(--h1-tip-text);
  color: var(--h1-tip-color);
  border: var(--h1-tip-border);
  border-radius: 5px;
  position: absolute;
  top: -8.2rem;
  font-size: 0.75rem;
  padding: 12px 16px;
  font-weight: normal;
  line-height: 1.4;
  white-space: pre-wrap;
  font-family: 'AliPuHuiTi',sans-serif;
  background: var(--h1-tip-bg);
  box-shadow: 0 1px 3px rgba(0,0,0,0.08);
  z-index: 6; pointer-events: none; opacity: .95;
  max-width: 220px; word-wrap: break-word; overflow-wrap: break-word;
  display: inline-block; box-sizing: border-box; width: auto;
}

/* ========================================================================== */
/* REGION B — H2 ROOT （齐天大圣）                                             */
/* Scope: #write h2                                                           */
/* Function: 定义副标题的布局、字体、背景、描边与交互光影；附带金箍棒图标动效。   */
/* Adjustable Params: 字体家族/大小、渐变配色、圆角、描边、hover 阴影层级、      */
/*                   图标路径/尺寸/动画周期、提示条文本与颜色。                */
/* Compatibility: 现代浏览器 / Typora(Electron)；旧内核不支持动画时退化为静态。*/
/* ========================================================================== */

#write h2{
  --h2-font: 'GuDuYanHei','AliPuHuiTi',sans-serif;
  --h2-size: 1.63rem;
  --h2-line: 1.875rem;
  --h2-margin: 2rem 0 1.5rem;
  --h2-padding: 0.8rem 1.6rem 0.8rem 2.8rem;
  --h2-letter: 0.5px;
  --h2-color: #ffd700;

  --h2-bg: radial-gradient(circle at center, #d32f2f 0%, #000000 90%);
  --h2-radius: 1rem;
  --h2-border: 1.5px solid rgba(255,215,0,0.5);

  --h2-shadow: inset 0 2px 4px rgba(255,255,255,0.05),
               inset 0 -2px 4px rgba(0,0,0,0.25),
               0 2px 4px rgba(0,0,0,0.35),
               0 4px 10px rgba(255,215,0,0.1),
               0 0 16px rgba(255,60,0,0.2);
  --h2-textshadow: 0 0 2px rgba(255,215,0,0.75), 1px 1px 2px rgba(0,0,0,0.65);

  --h2-icon-url: url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Logo/Headings_Icon/%E9%87%91%E7%AE%8D%E6%A3%92.svg');
  --h2-icon-size: 1.6em;
  --h2-icon-glow: drop-shadow(0 0 3px #ffd700);
  --h2-icon-anim: 4s;

  --h2-hover-color: #ffec8b;
  --h2-hover-border: rgba(255, 215, 0, 0.9);
  --h2-hover-shadow:
      inset 0 2px 6px rgba(255,255,255,0.15),
      inset 0 -3px 6px rgba(0,0,0,0.4),
      0 3px 6px rgba(0,0,0,0.45),
      0 6px 14px rgba(255,215,0,0.35),
      0 0 22px rgba(255,180,0,0.4),
      0 0 36px rgba(255,80,0,0.25);
  --h2-hover-textshadow:
      0 0 4px rgba(255, 230, 150, 0.9),
      1px 1px 2px rgba(0,0,0,0.8),
      0 0 12px rgba(255, 140, 0, 0.6);
  /* ============================================================================ */

  position: relative;
  display: block;
  font-size: var(--h2-size);
  line-height: var(--h2-line);
  margin: var(--h2-margin);
  padding: var(--h2-padding);
  font-weight: bold;
  letter-spacing: var(--h2-letter);
  color: var(--h2-color);
  font-family: var(--h2-font);

  background: var(--h2-bg);
  border-radius: var(--h2-radius);
  border: var(--h2-border);

  box-shadow: var(--h2-shadow);
  text-shadow: var(--h2-textshadow);

  overflow: visible; 
  z-index: 7;

  /* 精准过渡：只过渡必要属性 */
  transition:
    color .25s ease,
    border-color .25s ease,
    box-shadow .35s ease;
}
/* 金箍棒（轻浮 · 云气护体） */
#write h2::before{
  content: "";
  position: absolute;
  top: 50%; left: 0.1rem;
  width: var(--h2-icon-size); height: var(--h2-icon-size);
  background: var(--h2-icon-url) center/contain no-repeat;
  animation: h2-stickFloat var(--h2-icon-anim) ease-in-out infinite;
  filter: var(--h2-icon-glow);
  opacity: .95;
  z-index: 6;
  pointer-events: none;
}
/* 微漂动画：势起而不躁 */
@keyframes h2-stickFloat{
  0%,100%{ transform: translateY(-50%) translateX(0); }
  50%{     transform: translateY(-52%) translateX(1px); }
}
#write h2:hover {
  color: var(--h2-hover-color);
  border-color: var(--h2-hover-border);
  box-shadow: var(--h2-hover-shadow);
  text-shadow: var(--h2-hover-textshadow);
}

#write h2.md-focus::before{
  --h2-tip-text: "🐵俺老孙来也！";
  --h2-tip-color: #ff0000;
  content: var(--h2-tip-text);
  color: var(--h2-tip-color);
  position: absolute;
  top: 30%;
  left: 100%;
  font-size: 1rem;
  font-weight: normal;
  line-height: 1.5;
  white-space: pre-wrap;
  word-break: break-all;
  font-family: 'AliPuHuiTi',sans-serif;
  z-index: 6; pointer-events: none; opacity: .95;
  display: inline-block;
}

/* ========================================================================== */
/* REGION C — H3 ROOT（白雪公主）                                              */
/* Scope: #write h3                                                           */
/* Function: 定义 H3 的排版、底色（渐变）、切角与光影层；附加苹果叠加层。        */
/* Adjustable Params: 字体/尺寸/行高、渐变色、圆角、切角形状、阴影层级、         */
/*                   hover 位移与放大倍率、提示文本与颜色。                   */
/* Compatibility: 现代浏览器 / Typora(Electron)。无滤镜依赖，性能稳定。        */
/* ========================================================================== */

#write h3{
  --h3-font: 'SourceHanSansSoft','AliPuHuiTi',sans-serif;
  --h3-size: 1.25rem;
  --h3-weight: 600;
  --h3-padding: 0.75rem 1.5rem 0.75rem 3.2rem;
  --h3-margin: 1.5rem 0 1rem;
  --h3-color: #ffb3ec;
  --h3-radius: 0.8rem;
  --h3-clip: polygon(0% 0%,100% 0%,100% 100%,6% 100%,0% 90%);
  --h3-shadow: 0 2px 4px rgba(0,0,0,0.35), 0 0 8px rgba(160,0,255,0.15);

  --h3-bg-grad: linear-gradient(135deg,#4a148c,#6a1b9a,#e91e63);

  --h3-before-shadow:
    inset 1px 1px 3px rgba(255,255,255,0.1),
    inset -2px -2px 4px rgba(0,0,0,0.3),
    0 4px 8px rgba(90,0,160,0.3),
    0 0 12px rgba(160,0,255,0.3);

  --h3-apple-url: url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Logo/Headings_Icon/%E9%AD%94%E6%B3%95%E8%8B%B9%E6%9E%9C.svg');
  --h3-apple-size: 2.5em 2.5em;
  --h3-apple-glow: drop-shadow(0 0 4px rgba(255,100,200,0.6)); /* 当前未使用，仅保留占位 */

  --h3-hover-color: #32ff7e;
  --h3-hover-translate: -2px;
  --h3-hover-shadow:
    0 4px 8px rgba(0,0,0,0.4),
    0 0 12px rgba(255,100,200,0.35),
    0 0 24px rgba(160,0,255,0.25);

  --h3-hover-after-scale: 2.05;

  /* ============================================================================ */

  position: relative;
  display: block;
  font-size: var(--h3-size);
  font-weight: var(--h3-weight);
  padding: var(--h3-padding);
  margin: var(--h3-margin);
  color: var(--h3-color);
  z-index: 6;
  overflow: visible!important;
  border-radius: var(--h3-radius);
  font-family: var(--h3-font);
  box-shadow: var(--h3-shadow);
  clip-path: var(--h3-clip);

  /* 精准过渡：只过渡必要属性（取代 transition: all） */
  transition:
    color .25s ease,
    transform .35s ease,
    box-shadow .35s ease;
}

/* 光影背景（无模糊） */
#write h3::before{
  content: "";
  position: absolute; inset: 0; z-index: -2;
  border-radius: var(--h3-radius); pointer-events: none;
  background: var(--h3-bg-grad);
  box-shadow: var(--h3-before-shadow);
}

/* 苹果图标 + 渐变叠加（无滤镜） */
#write h3::after{
  content: "";
  position: absolute; inset: 0; z-index: -1;
  border-radius: var(--h3-radius); pointer-events: none;
  background-image: var(--h3-apple-url), var(--h3-bg-grad);
  background-repeat: no-repeat,no-repeat;
  background-position: 0.1rem center, center;
  background-size: var(--h3-apple-size), 100% 100%;
}

/* Hover 交互（仅色彩/位移/阴影过渡） */
#write h3:hover {
  color: var(--h3-hover-color);
  transform: translateY(var(--h3-hover-translate));
  box-shadow: var(--h3-hover-shadow);
}

/* 仅对缩放做过渡，避免昂贵属性进入补间 */
#write h3:hover::after {
  transform: scale(var(--h3-hover-after-scale));
  transition: transform 0.35s ease-in-out;
}

/* H3 聚焦彩蛋（童话警示语 · 不喧宾夺主） */
#write h3.md-focus::after {
  --h3-tip-text: "✨ Beware the bite of the magic apple";
  --h3-tip-color: #00ffe7;
  content: var(--h3-tip-text);
  position: absolute;
  top: 20%;
  left: 40%;
  font-size: 0.60rem;
  font-weight: normal;
  color: var(--h3-tip-color);
  white-space: nowrap;
  z-index: 7;
  pointer-events: none;
  opacity: .95;
}

/* ========================================================================== */
/* REGION D — H4 ROOT（爱丽丝）                                                         */
/* Scope: #write h4                                                           */
/* Function: 定义 H4 标题的排版、卡片化背景、圆角与阴影；添加兔子怀表图标与动画。 */
/* Adjustable Params: 字体、字号、内外边距、卡片阴影、hover 提升量、图标路径/尺寸、 */
/*                   中线渐变色与动画时长、焦点态发光色。                       */
/* Compatibility: 现代浏览器 / Typora(Electron)。prefers-reduced-motion 下停动画。*/
/* ========================================================================== */
#write h4{
  /* ===================== H4 · Root Variables (Local Only) ===================== */
  --h4-font: 'ZhanKuWenYiTi','AliPuHuiTi',serif;
  --h4-size: 1.15rem;
  --h4-padding: 0.6rem 1.8rem;
  --h4-margin: 2rem 0 1.2rem;
  --h4-color: #111;

  --h4-bg: #ffffff;
  --h4-radius: 1.2rem;
  --h4-border: 1px solid #e8e8e8;

  --h4-shadow: 0 4px 8px rgba(0,0,0,0.12),
               0 2px 4px rgba(0,0,0,0.08),
               0 0 0 1px rgba(0,0,0,0.02);

  --h4-hover-translate: -2px;
  --h4-hover-border: #dcdcdc;
  --h4-hover-shadow: 0 8px 16px rgba(0,0,0,.14), 0 4px 8px rgba(0,0,0,.10), 0 0 0 1px rgba(0,0,0,.04);

  --h4-icon-url: url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Logo/Headings_Icon/%E5%85%94%E5%AD%90%E6%80%80%E8%A1%A8.svg');
  --h4-icon-size: 3.8em 2.2em;
  --h4-icon-filter: drop-shadow(0 1px 2px rgba(0,0,0,0.15));
  --h4-icon-hover-filter: drop-shadow(0 2px 6px rgba(255,200,80,.85));
  --h4-icon-anim: 0.1s;

  --h4-line-gradient: linear-gradient(to right, transparent 0%, rgba(0,0,0,0.06) 50%, transparent 100%);
  --h4-line-size: 200% 100%;
  --h4-line-anim: 6s;
  /* ============================================================================ */

  position: relative;
  display: block;
  padding: var(--h4-padding);
  margin: var(--h4-margin);
  font-size: var(--h4-size);
  font-family: var(--h4-font);
  color: var(--h4-color);
  z-index: 7;

  background: var(--h4-bg);
  border-radius: var(--h4-radius);
  border: var(--h4-border);

  box-shadow: var(--h4-shadow);

  text-shadow: none;
  letter-spacing: 0.015em;
  overflow: visible;
}
/* Hover：卡片轻微上浮 + 边框提亮 */
#write h4:hover{
  transform: translateY(var(--h4-hover-translate));
  border-color: var(--h4-hover-border);
  box-shadow: var(--h4-hover-shadow);
}
/* 兔子怀表图标（左侧） */
#write h4::before{
  content: "";
  position: absolute;
  top: 10%; left: -1.3em;
  transform: translateY(-50%);
  width: 3.8em; height: 2.2em;
  background: var(--h4-icon-url) center/contain no-repeat;
  filter: var(--h4-icon-filter);
  pointer-events: none; z-index: 9;
}
#write h4:hover::before{
  animation: h4-watch-swing var(--h4-icon-anim) ease-in-out infinite;
  filter: var(--h4-icon-hover-filter);
}
@keyframes h4-watch-swing{
  0%   { transform: translateY(-50%) rotate(-8deg); }
  50%  { transform: translateY(-50%) rotate( 6deg); }
  100% { transform: translateY(-50%) rotate(-8deg); }
}
/* 中线阴影流动 */
#write h4::after{
  content: "";
  position: absolute; inset: 0; z-index: -1; pointer-events: none;
  background: var(--h4-line-gradient);
  background-size: var(--h4-line-size);
  background-position: left;
  background-repeat: no-repeat;
  animation: h4-shadowFlow var(--h4-line-anim) ease-in-out infinite alternate;
}
@keyframes h4-shadowFlow{
  0%{   background-position: left; }
  100%{ background-position: right; }
}
/* 降级 */
@media (prefers-reduced-motion: reduce){
  #write h4:hover{ transform:none; }
  #write h4::before, #write h4::after{ animation:none !important; }
}

/* H4 A11y 焦点环 + 右侧提示（停掉原动画/阴影，文字提示为主） */
#write h4:focus-visible,
#write h4:focus-within,
#write h4:target,
#write h4.md-focus{
  /* 去掉 outline，避免伪元素兔子怀表也被套框 */
  outline: none;

  /* 用外发光替代 outline，只围绕容器本体 */
  box-shadow:
    0 0 0 2px rgba(42,160,255,.85), /* 焦点环 */
    var(--h4-shadow);               /* 叠加原阴影 */
  border-color: #b9dcff;            /* 边框提亮 */
}

#write h4:focus-visible::after,
#write h4:focus-within::after,
#write h4:target::after,
#write h4.md-focus::after{
  --h4-tip-text: "⏱ Oh dear! Oh dear! I shall be late!";
  --h4-tip-color: #164b7a;
  content: var(--h4-tip-text);
  position: absolute;
  top: 1.5rem;
  left: calc(70% + 0rem);
  z-index: 12;
  pointer-events: none;
  color: var(--h4-tip-color);
  display: inline-block;
  white-space: nowrap;
  max-width: 260px;
  opacity: .98;
}

/* ========================================================================== */
/* REGION E — H5 ROOT（雷声之锤）                                              */
/* Scope: 仅 #write 内的 <h5>                                                 */
/* Function: 定义本级标题的排版、色彩、底/外光与默认动画；不向其它区域泄露变量  */
/* Adjustable Params: 字体/字号/粗细/间距、底色渐变、左侧描边、圆角与阴影层数   */
/* Compatibility: Chromium/Electron (Typora)；旧内核忽略部分混合模式与动画     */
/* Performance Notes: 背景/阴影静态；唯一常驻动画为 text-shadow 闪烁（可按需关）*/
/* ========================================================================== */

#write h5{
  /* ===================== H5 · Root Variables (Local Only) ===================== */
  --h5-font: 'ZCOOLAddictItalic','AliPuHuiTi',sans-serif;
  --h5-size: 1.05rem;
  --h5-weight: 700;
  --h5-color: #00ccff;
  --h5-padding: 0.6rem 1.4rem 0.6rem 1.2rem;
  --h5-margin: 1.5rem 0 1rem;

  --h5-bg: radial-gradient(circle at 30% 50%, #001c33 0%, #000000 90%);
  --h5-border-left: 1px solid #00ccff;
  --h5-radius: 0.8rem;

  --h5-textshadow: 0 0 3px #00ccff, 0 0 10px #00eaff, 1px 1px 2px rgba(0,0,0,0.5);
  --h5-boxshadow: 0 0 8px rgba(0,204,255,0.3), inset 0 0 8px rgba(0,204,255,0.08);

  --h5-anim-thunder: 4s;

  --h5-icon-url: url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Logo/Headings_Icon/%E9%9B%B7%E7%A5%9E%E4%B9%8B%E9%94%A4.png');
  --h5-icon-size: 2.6em;
  --h5-icon-glow: drop-shadow(0 0 4px #00ccff) drop-shadow(0 0 8px #00eaff);

  --h5-hover-color: #bff5ff;
  --h5-hover-border-left: #00eaff;
  --h5-hover-textshadow: 0 0 4px #00eaff, 0 0 16px #00f3ff, 1px 1px 2px rgba(0,0,0,0.6);
  --h5-hover-boxshadow: 0 0 12px rgba(0,204,255,0.45), 0 0 24px rgba(0,234,255,0.25), inset 0 0 10px rgba(0,204,255,0.12);

  --h5-sweep-anim: 1.15s;
  --h5-breathe-anim: 2.4s;

  --h5-icon-swing: 800ms;
  --h5-outline: 2px solid #00eaff;
  /* ============================================================================ */

  position: relative; 
  display: block;
  font-size: var(--h5-size);
  font-weight: var(--h5-weight);
  color: var(--h5-color);
  padding: var(--h5-padding);
  margin: var(--h5-margin);
  font-family: var(--h5-font);

  background: var(--h5-bg);
  border-left: var(--h5-border-left);
  border-radius: var(--h5-radius);

  text-shadow: var(--h5-textshadow);

  box-shadow: var(--h5-boxshadow);

  animation: h5-thunderFlash var(--h5-anim-thunder) ease-in-out infinite;
  overflow: visible; z-index: 6;
}
#write h5::before{
  content: "";
  position: absolute;
  top: 50%; left: -2.8rem;
  transform: translateY(-50%);
  width: var(--h5-icon-size); height: var(--h5-icon-size);
  background: var(--h5-icon-url) center/contain no-repeat;
  filter: var(--h5-icon-glow);
  pointer-events: none; z-index: 7;
}
@keyframes h5-thunderFlash{
  0%,100%{ text-shadow: 0 0 2px #00ccff, 0 0 5px #0099ff; }
  50%{     text-shadow: 0 0 10px #00eaff, 0 0 20px #00eaff; }
}

/* 悬停/聚焦：整体提亮（字色/外光/描边） */
#write h5:hover,
#write h5:is(:focus-visible, :focus-within, .md-focus){
  color: var(--h5-hover-color);
  border-left-color: var(--h5-hover-border-left);
  text-shadow: var(--h5-hover-textshadow);
  box-shadow: var(--h5-hover-boxshadow);
}

/* 扫光叠层（交互时启用） */
#write h5::after{
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 6;
  opacity: 0; /* 基态隐藏，交互时显现 */
}
#write h5:hover::after,
#write h5:is(:focus-visible, :focus-within, .md-focus)::after{
  opacity: 1;
  background:
    radial-gradient(60% 120% at 0% 50%,
      rgba(0,234,255,0.18) 0%,
      rgba(0,234,255,0.08) 30%,
      rgba(0,234,255,0) 60%),
    linear-gradient(115deg,
      transparent 0%,
      rgba(0,234,255,0.38) 48%,
      rgba(0,234,255,0.85) 50%,
      rgba(0,234,255,0.38) 52%,
      transparent 100%);
  background-size: 100% 100%, 300% 100%;
  background-position: 0 0, -180% 0;
  mix-blend-mode: screen;
  animation:
    h5-sweep var(--h5-sweep-anim) ease-out infinite,
    h5-radial-breathe var(--h5-breathe-anim) ease-in-out infinite;
}

/* 锤具轻摆（交互触发） */
#write h5:hover::before,
#write h5:is(:focus-visible, :focus-within, .md-focus)::before{
  transform-origin: 55% 15%;
  animation: h5-hover-swing var(--h5-icon-swing) ease-in-out 1;
  filter: drop-shadow(0 0 5px #00eaff) drop-shadow(0 0 12px #00f3ff);
}

/* 可达性：可见焦点环 */
#write h5:is(:focus-visible, :focus-within, .md-focus){
  outline: var(--h5-outline);
  outline-offset: 2px;
}

/* —— 扫光/呼吸/摆动关键帧 —— */
@keyframes h5-sweep{
  0%   { background-position: 0 0, -180% 0; }
  60%  { background-position: 0 0,  110% 0; }
  100% { background-position: 0 0,  110% 0; }
}
@keyframes h5-radial-breathe{
  0%,100% { opacity: .85; filter: brightness(1) saturate(1); }
  50%     { opacity: 1;   filter: brightness(1.08) saturate(1.08); }
}
@keyframes h5-hover-swing{
  0%   { transform: translateY(-50%) rotate(0deg); }
  30%  { transform: translateY(-50%) rotate(-9deg); }
  60%  { transform: translateY(-50%) rotate(7deg); }
  100% { transform: translateY(-50%) rotate(0deg); }
}

/* 降级：停动画，仅保留提亮与描边 */
@media (prefers-reduced-motion: reduce){
  #write h5:hover,
  #write h5:is(:focus-visible, :focus-within, .md-focus){
    animation: none !important;
  }
  #write h5::after,
  #write h5::before{
    animation: none !important;
  }
}

/* H5 聚焦：符文风提示条（不与扫光叠加冲突） */
#write h5:is(:focus-visible, :focus-within, :target, .md-focus){
  --h5-outline-focus: 2px solid #00eaff;
  outline: var(--h5-outline-focus);
  outline-offset: 2px;
}
#write h5:is(:focus-visible, :focus-within, :target, .md-focus)::before{
  transform-origin: 50% 0%;
  animation: h5-hammer-swing 900ms ease-in-out 1;
}
#write h5:is(:focus-visible, :focus-within, :target, .md-focus)::after{
  --h5-tip-text: "ᛋᛅ ᛁᛋ ᚼᛅᛚᛏᛁ ᛘᛅᛦᛚᚾᛁ ᚦᚢᚱᛋ, ᛁᚠ ᚼᛅᚾ ᛁᛋ ᚢᛁᚱᚦᚱ, ᛋᚴᛅᛚ ᛅᛁᚴᛅ ᛘᛅᚦ ᚦᚢᚱᛋ.";
  content: var(--h5-tip-text);
  animation: none;
  transition: none;
  filter: none;
  background: none;
  box-shadow: none;
  border: none;
  position: absolute;
  top: 0.2rem;
  left: calc(60% + 0.8rem);
  z-index: 11;
  pointer-events: none;
  color: #ffffff;
  background: rgba(0,204,255,.15);
  border: 1px solid #00ccff;
  border-radius: 6px;
  padding: 6px 10px;
  white-space: nowrap;
  font: 600 0.78rem 'AliPuHuiTi', sans-serif;
  line-height: 1.4;
  opacity: .98;
}
/* 窄屏回退 */
@media (max-width: 760px){
  #write h5:is(:focus-visible, :focus-within, :target, .md-focus)::after{
    top: -2.2rem;
    left: 50%;
    transform: translateX(-50%);
    max-width: min(82vw, 340px);
    white-space: normal;
    text-align: center;
  }
}
@media (prefers-reduced-motion: reduce){
  #write h5{ animation: none !important; }
  #write h5::before{ animation: none !important; }
}

/* ========================================================================== */
/* REGION F — H6 ROOT（狐面具）                                                */
/* Scope: 仅 #write 内的 <h6>                                                 */
/* Function: 定义六级标题的排版、底色/字色、间距与交互高亮                     */
/* Adjustable Params: 字号/行高/粗细、前景色、hover 背景与描边、阴影样式       */
/* Compatibility: Chromium/Electron (Typora)；旧内核忽略部分滤镜/渐变          */
/* ========================================================================== */
#write h6{
  /* ===================== H6 · Root Variables (Local Only) ===================== */
  --h6-font: 'GaoDuanHei','AliPuHuiTi',sans-serif;
  --h6-size: 0.93rem;
  --h6-line: 1.2rem;
  --h6-weight: 600;
  --h6-margin: 1.4rem 0 1rem;
  --h6-padding: 0.5rem 1.6rem 0.5rem 1.8rem;
  --h6-color: #b1222b;

  --h6-icon-url: url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Logo/Headings_Icon/%E7%8B%90%E7%8B%B8%E9%9D%A2%E5%85%B7.png');
  --h6-icon-size: 4.8em 2.5em;
  --h6-icon-filter: drop-shadow(0 0 2px #ffcccc);
  --h6-icon-hover: drop-shadow(0 0 3px #ff9999) drop-shadow(0 0 6px #ff6666);
  --h6-icon-anim: 1.6s;

  --h6-hover-color: #d62828;
  --h6-hover-bg: linear-gradient(to right, #fff5f5, #ffdada);
  --h6-hover-border: #f08080;
  --h6-hover-textshadow: 0 0 6px rgba(255,120,120,0.7), 1px 1px 3px rgba(150,0,0,0.3);
  --h6-hover-boxshadow: 0 0 12px rgba(255,80,80,0.35), inset 0 0 6px rgba(255,200,200,0.35);
  /* ============================================================================ */

  position: relative; display: block;
  font-size: var(--h6-size);
  line-height: var(--h6-line);
  font-weight: var(--h6-weight);
  margin: var(--h6-margin);
  padding: var(--h6-padding);
  font-family: var(--h6-font);
  color: var(--h6-color);
  overflow: visible; 
  z-index: 6;
}
/* 狐面具图标（左侧） */
#write h6::before{
  content: "";
  position: absolute;
  top: 20%; left: -1.4rem;
  transform: translateY(-10%);
  width: 4.8em; height: 2.5em;
  background: var(--h6-icon-url) center/contain no-repeat;
  filter: var(--h6-icon-filter);
  z-index: 7; pointer-events: none;
}
#write h6:hover {
  color: var(--h6-hover-color);
  background: var(--h6-hover-bg);
  border-color: var(--h6-hover-border);
  text-shadow: var(--h6-hover-textshadow);
  box-shadow: var(--h6-hover-boxshadow);
  transition: all 0.35s ease;
}
/* 狐面具图标 Hover 摇曳 */
#write h6:hover::before {
  animation: h6-mask-sway var(--h6-icon-anim) ease-in-out infinite alternate;
  filter: var(--h6-icon-hover);
}
@keyframes h6-mask-sway {
  0%   { transform: translateY(-10%) rotate(0deg); }
  25%  { transform: translateY(-12%) rotate(-5deg); }
  50%  { transform: translateY(-8%)  rotate(3deg); }
  75%  { transform: translateY(-11%) rotate(-3deg); }
  100% { transform: translateY(-10%) rotate(0deg); }
}
/* 降级：关闭面具摆动，仅保留色彩强调与名言 */
@media (prefers-reduced-motion: reduce){
  #write h6:hover::before { animation: none !important; }
}

/* H6 聚焦：樱语句签（与祭典红呼应） */
#write h6:is(:focus-visible, :focus-within, .md-focus, :target)::after{
  --h6-tip-text: "🌸 桜は散るからこそ美しい";
  content: var(--h6-tip-text);
  position: absolute;
  top: -.0rem;
  left: 50%;
  transform: translateX(-50%);
  z-index: 12;
  pointer-events: none;
}
/* =============================== END OF PACKAGE ============================ */


/* =======================================================================================
   Rhapsody · HR Dividers （正文分隔线 · 渐变 / 动效可选）
   设计理念 / Design Concept
   - 提供清晰、低干扰的分隔线样式：默认静态渐变，避免滚动文档时的持续重绘；
   - 动态脉冲动画仅在显式开关类存在时启用（或 hover 时触发），保证性能优先；
   - 使用颜色映射链（--typo-link-color → brand → fallback）+ 本地兜底，确保变量缺失时仍有可见色；
   - 圆角与粗细可通过类名快速调整（.hr-thin / .hr-thick），增强灵活性；
   - 尊重用户偏好：prefers-reduced-motion 时强制静态，保证可达性；
   - 不修改 DOM，仅作用于 #write 下的 hr 标签，避免跨区污染。
   ======================================================================================= */

/* =============================================================================
   REGION A — HR DIVIDERS（正文分隔线 · 渐变/可选动画）
   Scope:
     #write hr  （不影响侧栏/菜单/对话框）
   Function:
     - 提供清晰、低干扰的分隔线视觉（静态为默认；可选开启动画脉冲）
     - 动画仅在显式开关下启用；尊重 prefers-reduced-motion
   Adjustable Params:
     --hr-h / --hr-radius / --hr-gap / --hr-base / --hr-grad / --hr-size / --hr-dur / --hr-ease
   Notes:
     - 建议维持静态为默认，避免在大文档中产生无谓的合成与重绘
     - 仅使用渐变与 background-position 变化，不使用滤镜与大阴影
   ========================================================================== */

/* 根参数（挂在 #write，便于全局调参） */
#write {
  --hr-h: 1.5px;                                 /* 线高 */
  --hr-radius: 2px;                               /* 圆角 */
  --hr-gap: 2rem;                                 /* 上下间距 */
  --typo-link-color:#007fff;   
  --hr-base: #14181c;                             /* 两端基色 */
  --hr-grad: linear-gradient(90deg,
                 var(--hr-base),
                 var(--typo-link-color),
                 var(--hr-base));                 /* 中心高亮色使用主题链接色 */
  --hr-size: 200%;                                /* 背景尺寸（决定过渡宽度） */

  --hr-dur: 2.8s;                                 /* 动画时长 */
  --hr-ease: cubic-bezier(.4,.0,.2,1);            /* 动画节奏 */
}

/* 默认：静态渐变分隔线（性能友好） */
#write hr {
  height: var(--hr-h);
  margin: var(--hr-gap) ;
  border: none;
  border-radius: var(--hr-radius);
  background: var(--hr-grad);
  background-size: var(--hr-size);
  /* 不默认开启动画，避免大文档滚动时的持续重绘 */
}

/* 可选：按需开启动画（在 hr 上加 .is-animated，或在 #write 上加 .hr-animated） */
#write.hr-animated hr,
#write hr.is-animated {
  animation: hrPulse var(--hr-dur) var(--hr-ease) infinite;
}

@keyframes hrPulse {
  0%   { background-position:   0% 50%; }
  50%  { background-position: 100% 50%; }
  100% { background-position:   0% 50%; }
}

/* Hover 才动（更省电）：如果你想“需要时才动”，给 hr 加 .anim-on-hover */
@media (hover:hover){
  #write hr.anim-on-hover { animation: none; }
  #write hr.anim-on-hover:hover {
    animation: hrPulse var(--hr-dur) var(--hr-ease) infinite;
  }
}

/* 减少动态偏好：强制静态 */
@media (prefers-reduced-motion: reduce){
  #write.hr-animated hr,
  #write hr.is-animated,
  #write hr.anim-on-hover:hover {
    animation: none !important;
  }
}

/* 细款/粗款可选尺寸（按需给 hr 增加类名） */
#write hr.hr-thin { --hr-h: 1px; }
#write hr.hr-thick{ --hr-h: 3px; }

/* 主题变体：若需更柔的中性色，只覆盖 --hr-grad 即可 */
#write.hr-soft {
  --hr-grad: linear-gradient(90deg, var(--hr-base), #8aa5b7, var(--hr-base));
}
/* =============================== END OF PACKAGE ============================ */
/* =======================================================================================
   Rhapsody · Lists & Nested Lists （正文列表样式 · 有序 / 无序 / 嵌套）
   设计理念 / Design Concept
   - 使用变量集中维护（L- 前缀），实现多层级列表的缩进、配色、marker 内容统一管理。
   - 无需改动 DOM，不依赖 :has，范围严格限制在 #write。
   - 有序列表使用 counter + emoji 后缀；无序列表使用自定义 emoji 标记。
   - 每级列表封装为卡片式容器，具备独立前景/背景/阴影，保证可读性与层次感。
   - 兼顾编辑体验：修复 IME 光标抖动；Checklist 保留 Typora 原生交互。
   ======================================================================================= */

/* ========================================================================== */
/* REGION A — ROOT VARS（变量集中维护 · L 前缀 · 仅 #write）                    */
/* Scope: #write                                                               */
/* Function: 集中维护列表系统变量（缩进/卡片/marker/层级配色与内容）            */
/* Notes: 不改 DOM；不使用 :has；仅作用正文                                     */
/* Adjustable: 仅在本区调整 L- 系列变量                                         */
/* ========================================================================== */
#write{
  /* 基础缩进与层叠 */
  --L-indent-left: 1rem;
  --L-li-pad-left: .5rem;
  --L-li-text-indent: -.5rem;

  /* 卡片通用 */
  --L-card-radius: 8px;
  --L-card-shadow: 2px 2px 8px rgba(0,0,0,.1);

  /* ::marker 字体族（仅用于数字等宽风格；输出由 ::before 接管） */
  --L-marker-ff: "Segoe UI Emoji","Apple Color Emoji","Noto Color Emoji",system-ui,sans-serif;
  --L-marker-fs: 1em;
  --L-marker-fw: 400;

  /* 有序列表配色与内边距（1/2/3级） */
  --L-ol1-fg:#2e3b4e;   --L-ol1-bg:rgba(240,240,240,.7); --L-ol1-pad:.5rem;
  --L-ol2-fg:#9c27b0;   --L-ol2-bg:rgba(255,183,77,.2);  --L-ol2-pad:.4rem;
  --L-ol3-fg:#1976d2;   --L-ol3-bg:rgba(33,150,243,.2);  --L-ol3-pad:.3rem;

  /* 无序列表配色与内边距（1/2/3级） */
  --L-ul1-fg:#388e3c;   --L-ul1-bg:rgba(56,142,60,.2);   --L-ul1-pad:.5rem;
  --L-ul2-fg:#ff9800;   --L-ul2-bg:rgba(255,152,0,.2);   --L-ul2-pad:.4rem;
  --L-ul3-fg:#f44336;   --L-ul3-bg:rgba(244,67,54,.2);   --L-ul3-pad:.3rem;

  /* 无序 “标记内容/颜色”（供 ::before 使用） */
  --L-ul1-marker-content:"🪐  "; --L-ul1-marker-color:#ffb300;
  --L-ul2-marker-content:"📚  "; --L-ul2-marker-color:#8e24aa;
  --L-ul3-marker-content:"🍎  "; --L-ul3-marker-color:#f44336;

  /* 有序 “编号后缀/颜色”（供 ::before 使用） */
  --L-ol1-marker-suffix:". 🚀  "; --L-ol1-marker-color:#ffb300;
  --L-ol2-marker-suffix:". ⚡  ";  --L-ol2-marker-color:#8e24aa;
  --L-ol3-marker-suffix:". ⭐  ";  --L-ol3-marker-color:#1976d2;
}

/* ========================================================================== */
/* REGION B — BASE LAYOUT（基础缩进与稳定性 · ★以补丁为准·统一 ::before）         */
/* Scope: #write ul/ol/li                                                      */
/* Function: 列表缩进、悬挂缩进、稳定渲染；禁用过渡避免闪烁                      */
/* Notes: 原先 ::marker 输出已移除，避免与补丁打架                               */
/* ========================================================================== */

#write ul,
#write ol{
  list-style: none;              /* 统一关闭原生标记——改由 ::before 输出 */
  padding: 0;
  margin: 0 0 0 var(--L-indent-left);
  position: relative;
  z-index: 2;
  transition: none;
}

/* li 悬挂缩进：多行对齐 */
#write li{
  padding-left: var(--L-li-pad-left);
  text-indent: var(--L-li-text-indent);
  position: relative;            /* 供 ::before 定位 */
}

/* B' PATCH — 首段 <p> 行内化（IME 安全） */
#write li:not(.task-list-item) > p:first-child{
  display: inline-block;
  margin: 0;
  vertical-align: baseline;
  white-space: normal;
  line-height: inherit;
  min-width: .1px;
}

/* 统一数字等宽外观（不再用 ::marker 输出内容） */
#write li::marker{
  font-family: var(--L-marker-ff);
  font-variant-numeric: tabular-nums;
  font-size: var(--L-marker-fs);
  font-weight: var(--L-marker-fw);
  color: inherit;
  content: "";
}

/* ========================================================================== */
/* REGION C — ORDERED LIST CARDS（有序列表卡片）                                */
/* ========================================================================== */
#write ol{
  color: var(--L-ol1-fg);
  background-color: var(--L-ol1-bg);
  padding: var(--L-ol1-pad);
  border-radius: var(--L-card-radius);
  box-shadow: var(--L-card-shadow);
  transition: none;
}
#write ol ol{
  color: var(--L-ol2-fg);
  background-color: var(--L-ol2-bg);
  padding: var(--L-ol2-pad);
  border-radius: var(--L-card-radius);
  box-shadow: var(--L-card-shadow);
  transition: none;
}
#write ol ol ol{
  color: var(--L-ol3-fg);
  background-color: var(--L-ol3-bg);
  padding: var(--L-ol3-pad);
  border-radius: var(--L-card-radius);
  box-shadow: var(--L-card-shadow);
  transition: none;
}

/* ========================================================================== */
/* REGION D — UNORDERED LIST CARDS（无序列表卡片）                              */
/* ========================================================================== */
#write ul{
  color: var(--L-ul1-fg);
  background-color: var(--L-ul1-bg);
  padding: var(--L-ul1-pad);
  border-radius: var(--L-card-radius);
  box-shadow: var(--L-card-shadow);
  transition: none;
}
#write ul ul{
  color: var(--L-ul2-fg);
  background-color: var(--L-ul2-bg);
  padding: var(--L-ul2-pad);
  border-radius: var(--L-card-radius);
  box-shadow: var(--L-card-shadow);
  transition: none;
}
#write ul ul ul{
  color: var(--L-ul3-fg);
  background-color: var(--L-ul3-bg);
  padding: var(--L-ul3-pad);
  border-radius: var(--L-card-radius);
  box-shadow: var(--L-card-shadow);
  transition: none;
}

/* ========================================================================== */
/* REGION E — MARKERS（原方案移除，→ 由补丁的 ::before 槽位法接管）               */
/* Notes: 保留分区标题与注释，不再使用 ::marker 输出内容                         */
/* ========================================================================== */
/* （空置：以补丁为准，见下方 SLOT & ::before 输出） */

/* ========================================================================== */
/* === PATCH ① · 防止列表文字右侧溢出（长英文/URL 自动换行） === */
#write li,
#write li > p {
  overflow-wrap: anywhere;   /* 允许任意位置换行 */
  word-break: break-word;    /* 兼容旧浏览器 */
  hyphens: auto;             /* 自动加连字符（若字体支持） */
  box-sizing: border-box;
  max-width: 100%;
}

/* === 修正 · 禁止原生 marker 重影（以补丁为准） === */
#write ul,
#write ul li,
#write ul li::marker {
  list-style: none !important;
  content: none !important;
}

/* === Unordered Bullets: 固定在首行，不随文本换行/挤压（以补丁为准） === */
/* 变量：可按需微调 */
#write{
  --L-ul-gutter: 1.8em;            /* 点位槽宽：1个彩色 emoji 的安全宽度 */
  --L-spacer: 0.35em;              /* 点与文字的可见间距 */
  --L-marker-shift: 0em;           /* 垂直基线微调 */
}

/* 关闭 ul 原生/::marker，仅对 ul 生效；ol 由后文单独处理 */
#write ul { list-style: none; }
#write ul > li::marker { content: ""; }

/* 给文本让出固定槽位；多行自然与内容列对齐 */
#write ul > li{
  position: relative;
  padding-left: calc(var(--L-ul-gutter) + var(--L-spacer));
  text-indent: 0;
}

/* 在固定槽内绘制“点”（首行固定，永不换行） */
#write ul > li::before{
  content: var(--L-ul1-marker-content);
  color: var(--L-ul1-marker-color);
  position: absolute;
  left: 0;
  top: 0;
  width: var(--L-ul-gutter);
  white-space: nowrap;
  line-height: inherit;
  transform: translateY(var(--L-marker-shift));
}

/* 二、三级无序列表沿用各自的内容与颜色 */
#write ul ul > li::before{
  content: var(--L-ul2-marker-content);
  color: var(--L-ul2-marker-color);
}
#write ul ul ul > li::before{
  content: var(--L-ul3-marker-content);
  color: var(--L-ul3-marker-color);
}

/* === PATCH · 无序列表 图标 + 文字同步左移（不动卡片整体 · 以补丁为准） === */
/* 可调变量：负值=向左，正值=向右 */
#write { --L-ul-content-shift: -2.5em; }

#write ul > li {
  position: relative;
  padding-left: calc(var(--L-ul-gutter) + var(--L-spacer) + var(--L-ul-content-shift));
  text-indent: 0; /* 保证换行对齐 */
}

/* 图标同量左移，保持首行固定不随换行 */
#write ul > li::before { left: var(--L-ul-content-shift); }

/* === 修正 · 禁止有序原生 marker 重影（与 ::before 共存 · 以补丁为准） === */
#write ol,
#write ol li,
#write ol li::marker {
  list-style: none !important;
  content: none !important;
}

/* === Ordered Numbers: 固定首行编号，不随文本换行/挤压（以补丁为准） === */
/* 变量：根据编号位数与后缀 emoji 规模微调 */
#write{
  --L-ol-digit-ch: 3.2ch;   /* 1~999 建议 3.2ch；1~99 可 2.2ch */
  --L-ol-suffix-em: 1.4em;  /* ". " + emoji 的保守宽度 */
  --L-ol-gutter: calc(var(--L-ol-digit-ch) + var(--L-ol-suffix-em));
  --L-ol-marker-shift: 0em;
  --L-ol-content-shift: -2.0em;  /* 与无序左移量呼应 */
}

/* 给文本让出固定槽位；多行自然与内容列对齐 */
#write ol > li{
  position: relative;
  padding-left: calc(var(--L-ol-gutter) + var(--L-spacer) + var(--L-ol-content-shift));
  text-indent: 0;
}

/* 在固定槽内绘制“编号+后缀”（首行固定，永不换行） */
#write ol > li::before{
  position: absolute;
  left: var(--L-ol-content-shift); /* 与内容一起水平移动 */
  top: 0;
  width: var(--L-ol-gutter);       /* 固定宽度的编号槽 */
  white-space: nowrap;             /* 编号自身绝不换行 */
  line-height: inherit;
  transform: translateY(var(--L-ol-marker-shift));
  color: var(--L-ol1-marker-color);
  font-family: var(--L-marker-ff);
  font-variant-numeric: tabular-nums;
  font-size: var(--L-marker-fs);
  font-weight: var(--L-marker-fw);
  content: counter(list-item, decimal) var(--L-ol1-marker-suffix);
}

/* 二级/三级：编号体系与配色沿用你的变量 */
#write ol ol > li::before{
  color: var(--L-ol2-marker-color);
  content: counter(list-item, upper-alpha) var(--L-ol2-marker-suffix);
}
#write ol ol ol > li::before{
  color: var(--L-ol3-marker-color);
  content: counter(list-item, upper-roman) var(--L-ol3-marker-suffix);
}

/* ========================================================================== */
/* REGION F — CHECKLIST（复选列表兜底，不覆盖原生）                              */
/* Scope: #write task-list（ul/ol/li）                                          */
/* Function: 清空 ::before；移除默认缩进；不干扰内置复选框                       */
/* Notes: 保留你的注释与风格                                                     */
/* ========================================================================== */
#write li.task-list-item::marker{ content: ""; }
#write li.task-list-item::before{ content: none; }   /* 不自绘点/编号 */
#write ul.task-list,
#write ol.task-list{ list-style: none; padding-left: 0; }

/* 行距微调（列表段落） */
#write li > p{ margin: .25rem 0; }

#write ul.task-list > li.task-list-item,
#write ol.task-list > li.task-list-item{
  position: relative;
  padding-left: 1.6em;      /* 给复选框留位 */
}
#write li.task-list-item input[type="checkbox"]{
  position: absolute;
  left: 0;
  top: .1em;                /* 轻微基线校准 */
}

/* 嵌套组合统一去外边距，避免错乱 */
#write ul ul ul,
#write ul ul ol,
#write ul ol ul,
#write ul ol ol,
#write ol ul ul,
#write ol ul ol,
#write ol ol ul,
#write ol ol ol{ margin: 0; }

/* =============================== END OF PACKAGE ============================ */

/* =======================================================================================
   Rhapsody · Inline Emphasis Core （正文内联强调/斜体样式）
   设计理念 / Design Concept
   - 统一正文中 b/strong/em/i/dfn/cite 的强调与斜体配色，避免侧栏/菜单/代码块受影响；
   - 粗体强调用「红 → 金」的配色转变，体现警示与强调效果；
   - 斜体强调用「紫蓝 → 粉紫」的配色转变，突出柔性与文艺感；
   - Hover 提供轻度发光反馈，仅在鼠标环境启用；触控环境不制造干扰；
   - 明确排除 code/kbd/samp/pre，保持代码环境的可读性；
   - 尊重 prefers-reduced-motion，关闭阴影与过渡，保证可达性与稳定性。
   ======================================================================================= */

/* ========================================================================== */
/* REGION A — INLINE EMPHASIS CORE（正文内联强调/斜体，仅 #write）              */
/* Scope: #write 内的 b/strong/em/i/dfn/cite；不影响侧栏/菜单/代码块             */
/* Function: 统一强调/斜体的配色与 hover 提示；可单独定义斜体初始色              */
/* Adjustable: 颜色（--emp-red/--emp-red-hover/--emp-italic/--emp-vio）、阴影强度*/
/* Notes: 排除 code/kbd/samp/pre，尊重减少动态偏好                              */
/* ========================================================================== */

#write{
  /* 可调色盘（需要硬编码可把 var(...) 换成字面量色值） */
  --emp-red:        #ff0303;   /* 强调红（初始） */
  --emp-red-hover:  #ffb300;   /* 强调 hover 金色 */
  --emp-italic:     #7b2cff;   /* 斜体默认紫蓝色 */
  --emp-vio:        #ff00fd;   /* 斜体 hover 粉紫色 */
  --emp-glow-a:     rgba(255,180,80,.45);
  --emp-glow-b:     rgba(255,220,120,.25);
}

/* 粗体/强调 */
#write :is(b, strong){
  font-weight: 700;
  color: var(--emp-red);
  text-decoration: none;
  transition: color .22s ease, text-shadow .25s ease;
}

/* 斜体族（排除代码相关） */
#write :is(em, i, dfn, cite):not(code, kbd, samp, pre){
  font-style: italic;
  font-family: 'ZCOOLAddictItalic','AliPuHuiTi',sans-serif;
  color: var(--emp-italic); /* 默认自定义色 */
  transition: color .22s ease, text-shadow .25s ease;
}

/* Hover（仅鼠标设备；触控不加干扰） */
@media (hover: hover){
  #write :is(b, strong):hover{
    color: var(--emp-red-hover);
    text-shadow:
      0 0 8px var(--emp-glow-a),
      0 0 16px var(--emp-glow-b);
  }
  #write :is(em, i, dfn, cite):not(code, kbd, samp, pre):hover{
    color: var(--emp-vio);
    text-shadow:
      0 0 12px rgba(255,0,253,.5),
      0 0 22px rgba(255,0,253,.28);
  }
}

/* 减少动态偏好：关闭动画阴影与过渡 */
@media (prefers-reduced-motion: reduce){
  #write :is(b, strong, em, i, dfn, cite){
    transition: none !important;
    text-shadow: none !important;
  }
}
/* =============================== END OF PACKAGE ============================ */
/* =======================================================================================
   Rhapsody · Quotes & Admonitions（引用块与扩展提示，仅 #write）
   设计理念 / Design Concept
   - 仅在写作区域生效：所有选择器挂载 #write，避免外溢与无谓匹配开销。
   - 不改动 HTML 结构：完全依赖伪元素与局部变量实现视觉与动效，兼容 Typora 限制。
   - 性能优先：常态静止、悬停才动（@media (hover:hover)）；尊重 @media (prefers-reduced-motion)。
   - GPU 友好：交互只用 transform / opacity，禁止持续背景位移与昂贵滤镜的循环动画。
   - 区域化与解耦：A=blockquote 核心；B=md-alert 通用壳；C~G 分别为 tip/important/note/caution/warning，
     各区自带局部变量，不跨区污染，命名尽量前缀化（如 bq-/al-）。
   - 可维护性：将共同排版与结构属性收敛于 B 区（通用壳），类型区只保留配色、阴影与图标动画差异。
   - 温和装饰：使用轻渐变、柔阴影与 Emoji/图标点题；若平台字形不稳，可替换为稳定字体或 SVG mask。
   - 安全边界：必要处加 contain: paint 与 isolation: isolate，降低重绘传播；不使用 :has() 主动扫描。
   - 优雅降级：旧内核降级为静态色块与无动画形态，不影响阅读与导出。
   ======================================================================================= */

/* =======================================================================================
   REGION A — BLOCKQUOTE CORE（引用块 · 机械朋克风，仅 #write）
   Scope: #write blockquote / #write blockquote p / hover-only interactions
   Function:
     - 定义正文内引用块的“机械银灰”视觉与轻交互（hover 缩放、齿轮旋转）
     - 段落排版紧凑化（等宽/文艺体混排，轻字距）
   Adjustable Params:
     --bq-pad, --bq-margin, --bq-border, --bq-bg, --bq-fg, --bq-radius, --bq-shadow
     --bq-icon-size, --bq-icon-color, --bq-scale, --bq-anim-dur
   Compatibility: 现代 Chromium/Electron (Typora)；旧内核退化为静态
   Notes:
     - 动效仅在具备鼠标的设备启用（@media (hover: hover)）
     - 尊重用户“减少动态”偏好（@media (prefers-reduced-motion: reduce)）
   ======================================================================================= */

#write blockquote{
  /* ---- Local Vars (scoped here) ---- */
  --bq-pad: 2rem 2.5rem;
  --bq-margin: 1.5rem 0;
  --bq-border: 8px solid #b0b0b0;
  --bq-bg: #dcdcdc;
  --bq-fg: #333;
  --bq-radius: 10px;
  --bq-shadow: 0 6px 18px rgba(0,0,0,.2);
  --bq-icon-size: 1.5rem;
  --bq-icon-color: #b0b0b0;
  --bq-scale: 1.03;
  --bq-anim-dur: .3s;

  padding: var(--bq-pad);
  margin: var(--bq-margin);
  border-left: var(--bq-border);
  background: var(--bq-bg);
  color: var(--bq-fg);
  font-size: 1.2rem;
  line-height: 1.6;
  border-radius: var(--bq-radius);
  box-shadow: var(--bq-shadow);
  position: relative;
  z-index: 10;
  transition: transform var(--bq-anim-dur) ease, box-shadow var(--bq-anim-dur) ease;
}

/* 段落排版（紧凑） */
#write blockquote p{
  font-family: 'RobotoMono','ZhanKuWenYiTi',sans-serif;
  line-height: 1.28;
  letter-spacing: 0.01em;
  font-size: 1.09rem;
  margin: .10em 0;
  padding: 0;
}

/* 齿轮 icon（常态静止；仅 hover 旋转） */
#write blockquote::before{
  content: "⚙️";
  position: absolute;
  left: .8rem;
  top: 50%;
  transform: translateY(-50%) rotate(0deg);
  font-size: var(--bq-icon-size);
  color: var(--bq-icon-color);
  pointer-events: none;
  filter: drop-shadow(0 0 2px rgba(0,0,0,.15));
}

/* 旋转动画（A区私有命名避免冲突） */
@keyframes bq-gear-rotate{
  0%   { transform: translateY(-50%) rotate(0deg); }
  100% { transform: translateY(-50%) rotate(360deg); }
}

/* 仅鼠标设备启用轻交互 */
@media (hover: hover){
  #write blockquote:hover{
    transform: scale(var(--bq-scale));
    box-shadow: 0 10px 28px rgba(0,0,0,.22);
  }
  #write blockquote:hover::before{
    animation: bq-gear-rotate 4.6s linear infinite;
  }
}

/* A11y：减少动态偏好 */
@media (prefers-reduced-motion: reduce){
  #write blockquote{ transition: none !important; }
  #write blockquote::before{ animation: none !important; }
}


/* =======================================================================================
   REGION B — MD-ALERT CORE（扩展语法容器通用壳，仅 #write）
   Scope: #write .md-alert（统一壳：圆角/定位/层级）+ 全局 a11y 熄火
   Function:
     - 提供 admonitions 的基础容器形态；独立于各类型配色与动效
   Adjustable Params:
     --al-radius, --al-z
   Notes:
     - 各类型（C~G）自行定义配色与动画，不跨区变量
   ======================================================================================= */

#write .md-alert{
  --al-radius: 16px;
  --al-z: 6;
  position: relative;
  z-index: var(--al-z);
  border-radius: var(--al-radius);
}

/* 全局 a11y 熄火（含 ::before 动画） */
@media (prefers-reduced-motion: reduce){
  #write .md-alert{ transition: none !important; }
  #write .md-alert::before{ animation: none !important; }
}


/* =======================================================================================
   REGION C — MD-ALERT: TIP（💡 提示）
   Scope: #write .md-alert.md-alert-tip
   Function: 蓝系冷光、轻浮动（仅 hover）
   Adjustable:
     --tip-left, --tip-bg1, --tip-bg2, --tip-fg, --tip-icon, --tip-shadow, --tip-scale
   ======================================================================================= */

#write .md-alert.md-alert-tip{
  --tip-left: 8px;
  --tip-bg1: #e3f2fd; --tip-bg2: #b9e2ff; --tip-fg: #168fcf; --tip-icon: #23b3fc;
  --tip-shadow: 0 4px 20px 2px rgba(36,180,255,.13), 0 1.5px 14px rgba(36,180,255,.09);
  --tip-scale: 1.035;

  display:block;
  border-left: var(--tip-left) solid var(--tip-icon);
  background: linear-gradient(90deg,var(--tip-bg1) 83%,var(--tip-bg2) 100%);
  color: var(--tip-fg);
  font-family:'SourceHanSansSoft','AliPuHuiTi',sans-serif;
  font-size:1.07rem; line-height:1.45; letter-spacing:.01em;
  padding:1.12em 1.6em 1.1em 3.1em; margin:1.15em 0;
  box-shadow: var(--tip-shadow);
  transition: transform .26s cubic-bezier(.45,.09,.49,.94),
              box-shadow .32s cubic-bezier(.47,.1,.65,.53),
              background .28s cubic-bezier(.38,.1,.51,.89);
}
#write .md-alert.md-alert-tip::before{
  content:"💡"; position:absolute; left:1.22em; top:1.13em;
  font-size:1.55em; color:var(--tip-icon); opacity:.93;
  filter: drop-shadow(0 0 10px #23b3fc50);
  pointer-events:none;
  transform: translateY(0) scale(1);
}
@keyframes tipFloat{
  0%,100%{ transform: translateY(0) scale(1);    filter: drop-shadow(0 0 10px #23b3fc50); }
  50%    { transform: translateY(-7px) scale(1.07); filter: drop-shadow(0 0 28px #23b3fc); }
}
@media (hover: hover){
  #write .md-alert.md-alert-tip:hover{
    transform: scale(var(--tip-scale));
    background: linear-gradient(93deg,#e6f7ff 70%,#b2e6ff 100%);
    box-shadow: 0 8px 38px 4px rgba(36,180,255,.17), 0 4px 20px rgba(36,180,255,.10);
    border-left: calc(var(--tip-left) + 2px) solid #00e5ff;
  }
  #write .md-alert.md-alert-tip:hover::before{ animation: tipFloat 2.5s ease-in-out infinite; }
}


/* =======================================================================================
   REGION D — MD-ALERT: IMPORTANT（⭐ 重点）
   Scope: #write .md-alert.md-alert-important
   Function: 暖黄能量、星辉脉动（仅 hover）
   Adjustable:
     --imp-left, --imp-bg1, --imp-bg2, --imp-fg, --imp-icon, --imp-shadow, --imp-scale
   ======================================================================================= */

#write .md-alert.md-alert-important{
  --imp-left: 8px;
  --imp-bg1: #fffde7; --imp-bg2: #ffe082; --imp-fg: #b08900; --imp-icon: #ffb300;
  --imp-shadow: 0 4px 20px 2px rgba(255,179,0,.13), 0 1.5px 14px rgba(255,179,0,.09);
  --imp-scale: 1.035;

  display:block;
  border-left: var(--imp-left) solid var(--imp-icon);
  background:linear-gradient(90deg,var(--imp-bg1) 83%,var(--imp-bg2) 100%);
  color:var(--imp-fg);
  font-family:'SourceHanSansSoft','AliPuHuiTi',sans-serif;
  font-size:1.07rem; line-height:1.45; letter-spacing:.01em;
  padding:1.12em 1.6em 1.1em 3.1em; margin:1.15em 0;
  box-shadow:var(--imp-shadow);
  transition: transform .26s cubic-bezier(.45,.09,.49,.94), box-shadow .32s, background .28s;
}
#write .md-alert.md-alert-important::before{
  content:"⭐️"; position:absolute; left:1.15em; top:1.09em;
  font-size:1.46em; color:var(--imp-icon); opacity:.95;
  filter: drop-shadow(0 0 10px #ffec7f60);
  pointer-events:none;
  transform: rotate(-4deg) scale(1);
}
@keyframes importantPulse{
  0%,100%{ transform: scale(1) rotate(-4deg); filter:drop-shadow(0 0 10px #ffec7f60); opacity:.97; }
  20%    { transform: scale(1.15) rotate(8deg);  filter:drop-shadow(0 0 32px #ffe232) drop-shadow(0 0 4px #ffb300); opacity:1; }
  55%    { transform: scale(.98) rotate(-3deg);   filter:drop-shadow(0 0 14px #ffe082); opacity:.87; }
  75%    { transform: scale(1.08) rotate(6deg);   filter:drop-shadow(0 0 18px #ffec7f); opacity:.97; }
}
@media (hover: hover){
  #write .md-alert.md-alert-important:hover{
    transform: scale(var(--imp-scale));
    background: linear-gradient(93deg,#fffbe1 70%,#ffe082 100%);
    box-shadow: 0 8px 38px 4px rgba(255,179,0,.17), 0 4px 20px rgba(255,179,0,.10);
    border-left: calc(var(--imp-left) + 2px) solid #ffe232;
  }
  #write .md-alert.md-alert-important:hover::before{ animation: importantPulse 1.2s cubic-bezier(.63,.09,.47,.88) infinite; }
}


/* =======================================================================================
   REGION E — MD-ALERT: NOTE（📝 说明）
   Scope: #write .md-alert.md-alert-note
   Function: 青绿呼吸、轻柔放大（仅 hover）
   Adjustable:
     --note-left, --note-bg1, --note-bg2, --note-fg, --note-icon, --note-shadow, --note-scale
   ======================================================================================= */

#write .md-alert.md-alert-note{
  --note-left: 8px;
  --note-bg1: #e0f7fa; --note-bg2: #b2fff7; --note-fg: #009b7a; --note-icon: #1de9b6;
  --note-shadow: 0 4px 20px 2px rgba(29,233,182,.12), 0 1.5px 14px rgba(29,233,182,.10);
  --note-scale: 1.035;

  display:block;
  border-left: var(--note-left) solid var(--note-icon);
  background:linear-gradient(90deg,var(--note-bg1) 82%,var(--note-bg2) 100%);
  color:var(--note-fg);
  font-family:'SourceHanSansSoft','AliPuHuiTi',sans-serif;
  font-size:1.07rem; line-height:1.45; letter-spacing:.01em;
  padding:1.12em 1.6em 1.1em 3.1em; margin:1.15em 0;
  box-shadow:var(--note-shadow);
  transition: transform .26s cubic-bezier(.45,.09,.49,.94), box-shadow .32s, background .28s;
}
#write .md-alert.md-alert-note::before{
  content:"📝"; position:absolute; left:1.13em; top:1.13em;
  font-size:1.44em; color:var(--note-icon); opacity:.96;
  filter: drop-shadow(0 0 14px #b2fff7);
  pointer-events:none;
  transform: scale(1);
}
@keyframes noteBreathe{
  0%,100%{ opacity:.88; filter:drop-shadow(0 0 8px #b2fff7) drop-shadow(0 0 0 #1de9b6); transform:scale(1); }
  45%    { opacity:1;    filter:drop-shadow(0 0 22px #1de9b6) drop-shadow(0 0 6px #b2fff7); transform:scale(1.10); }
  75%    { opacity:.94;  filter:drop-shadow(0 0 14px #1de9b6) drop-shadow(0 0 2px #b2fff7); transform:scale(1.03); }
}
@media (hover: hover){
  #write .md-alert.md-alert-note:hover{
    transform: scale(var(--note-scale));
    background: linear-gradient(93deg,#e6fffb 70%,#b2fff7 100%);
    box-shadow: 0 8px 38px 4px rgba(29,233,182,.15), 0 4px 20px rgba(29,233,182,.10);
    border-left: calc(var(--note-left) + 2px) solid #10bfa5;
  }
  #write .md-alert.md-alert-note:hover::before{ animation: noteBreathe 2.3s cubic-bezier(.41,.09,.56,.89) infinite; }
}


/* =======================================================================================
   REGION F — MD-ALERT: CAUTION（⚠️ 注意）
   Scope: #write .md-alert.md-alert-caution
   Function: 电紫霓虹、警示微光（仅 hover）
   Adjustable:
     --cau-left, --cau-bg1, --cau-bg2, --cau-fg, --cau-icon, --cau-shadow, --cau-scale
   ======================================================================================= */

#write .md-alert.md-alert-caution{
  --cau-left: 8px;
  --cau-bg1: #f5eaff; --cau-bg2: #ecc7ff; --cau-fg: #7c36b8; --cau-icon: #c158ff;
  --cau-shadow: 0 4px 20px 2px rgba(193,88,255,.13), 0 1.5px 14px rgba(193,88,255,.10);
  --cau-scale: 1.035;

  display:block;
  border-left: var(--cau-left) solid var(--cau-icon);
  background:linear-gradient(90deg,var(--cau-bg1) 82%,var(--cau-bg2) 100%);
  color:var(--cau-fg);
  font-family:'SourceHanSansSoft','AliPuHuiTi',sans-serif;
  font-size:1.07rem; line-height:1.45; letter-spacing:.01em;
  padding:1.12em 1.6em 1.1em 3.1em; margin:1.15em 0;
  box-shadow:var(--cau-shadow);
  transition: transform .26s cubic-bezier(.45,.09,.49,.94), box-shadow .32s, background .28s;
}
#write .md-alert.md-alert-caution::before{
  content:"⚠️"; position:absolute; left:1.08em; top:1.09em;
  font-size:1.5em; color:var(--cau-icon); opacity:.98;
  filter: drop-shadow(0 0 18px #ecc7ffb0);
  pointer-events:none;
}
@keyframes cautionNeonGlow{
  0%,100%{ filter: drop-shadow(0 0 8px #ecc7ffb0); }
  33%    { filter: drop-shadow(0 0 28px #c158ff); }
  66%    { filter: drop-shadow(0 0 14px #ae7cf5); }
}
@media (hover: hover){
  #write .md-alert.md-alert-caution:hover{
    transform: scale(var(--cau-scale));
    background: linear-gradient(93deg,#f7eaff 70%,#eac8ff 100%);
    box-shadow: 0 8px 38px 4px rgba(193,88,255,.17), 0 4px 20px rgba(193,88,255,.12);
    border-left: calc(var(--cau-left) + 2px) solid #9c32d9;
  }
  #write .md-alert.md-alert-caution:hover::before{ animation: cautionNeonGlow 1.48s cubic-bezier(.62,.05,.51,1.04) infinite; }
}


/* =======================================================================================
   REGION G — MD-ALERT: WARNING（❗ 警告）
   Scope: #write .md-alert.md-alert-warning
   Function: 红能量脉冲、强警示（仅 hover）
   Adjustable:
     --war-left, --war-bg1, --war-bg2, --war-fg, --war-icon, --war-shadow, --war-scale
   ======================================================================================= */

#write .md-alert.md-alert-warning{
  --war-left: 8px;
  --war-bg1: #ffeaea; --war-bg2: #ffbaba; --war-fg: #c02020; --war-icon: #ff2a2a;
  --war-shadow: 0 4px 20px 2px rgba(255,42,42,.15), 0 1.5px 14px rgba(255,42,42,.08);
  --war-scale: 1.035;

  display:block;
  border-left: var(--war-left) solid var(--war-icon);
  background:linear-gradient(90deg,var(--war-bg1) 82%,var(--war-bg2) 100%);
  color:var(--war-fg);
  font-family:'SourceHanSansSoft','AliPuHuiTi',sans-serif;
  font-size:1.07rem; line-height:1.45; letter-spacing:.01em;
  padding:1.12em 1.6em 1.1em 3.1em; margin:1.15em 0;
  box-shadow:var(--war-shadow);
  transition: transform .26s cubic-bezier(.45,.09,.49,.94), box-shadow .32s, background .28s;
}
#write .md-alert.md-alert-warning::before{
  content:"❗️"; position:absolute; left:1.12em; top:1.13em;
  font-size:1.52em; color:var(--war-icon); opacity:.99;
  filter: drop-shadow(0 0 16px #ffbaba90);
  pointer-events:none;
  transform: scale(1);
}
@keyframes warningPulse{
  0%,100%{ transform:scale(1);   filter:drop-shadow(0 0 8px #ffbaba90); opacity:.97; }
  20%    { transform:scale(1.18); filter:drop-shadow(0 0 24px #ff1744);   opacity:1; }
  55%    { transform:scale(.95);  filter:drop-shadow(0 0 14px #ffbaba);   opacity:.83; }
  75%    { transform:scale(1.09); filter:drop-shadow(0 0 18px #ff1744);   opacity:.97; }
}
@media (hover: hover){
  #write .md-alert.md-alert-warning:hover{
    transform: scale(var(--war-scale));
    background: linear-gradient(93deg,#fff3f3 70%,#ffc4c4 100%);
    box-shadow: 0 8px 38px 4px rgba(255,42,42,.21), 0 4px 20px rgba(255,42,42,.13);
    border-left: calc(var(--war-left) + 2px) solid #ff1744;
  }
  #write .md-alert.md-alert-warning:hover::before{ animation: warningPulse 1.08s cubic-bezier(.47,.1,.65,.53) infinite; }
}
/* =============================== END OF PACKAGE ============================ */
/* =======================================================================================
   Rhapsody · Inline Code · Geek Neon（行内代码 · 黑色极客霓虹版）
   设计理念 / Design Concept
   - 仅在 #write 区域内为“行内 <code>”上色，**精准排除** 代码块（pre/.md-fences）、工具提示与数学预览。
   - 一键换色：只改 --ic-rgb，其它衍生变量联动生成，降低维护成本。
   - 性能优先：常态静止；仅鼠标设备 hover 时启用过渡；尊重 prefers-reduced-motion。
   - GPU 友好：使用 filter/box-shadow 做轻微霓虹发光，避免布局抖动（默认给 1px 边框占位）。
   - 限域重绘：必要处添加 contain:paint 与 isolation:isolate，不改动任何 HTML 结构（兼容 Typora 限制）。
   ======================================================================================= */

/* ========================================================================== */
/* REGION A — INLINE CODE CORE（行内 code 核心 · Geek Neon）                  */
/* Scope:                                                                     */
/*   - #write 内的纯“行内 <code>”                                             */
/*   - 排除：pre code、.md-fences code、.code-tooltip-content、#math-inline-preview-content */
/* Function:                                                                  */
/*   - 定义行内代码的霓虹发光、可读配色与交互反馈（hover 轻滤镜+外发光）       */
/* Adjustable Params:                                                         */
/*   - --ic-rgb 主色；--ic-radius/--ic-pad-* 形状间距；--ic-* 衍生发光与边框   */
/* Compatibility:                                                             */
/*   - 现代 Chromium/Electron (Typora)；旧内核降级为静态样式                   */
/* ========================================================================== */


/* —— 变量（仅本区使用）—— */
#write{
  /* 主色（RGB）— 黑色极客：0,173,255 | 霓虹粉：255,94,247 | 翡翠绿：16,233,128 */
  --ic-rgb: 0.0.0;

  /* 形状/间距 */
  --ic-radius: .75em;
  --ic-pad-y: .10em;
  --ic-pad-x: .50em;

  /* 暗/浅背景混合强度（霓虹底，按需可用） */
  --ic-bg-deep: rgba(0,0,0,.72);
  --ic-bg-shallow: rgba(0,0,0,.35);

  /* 衍生色（随主色联动） */
  --ic-text: rgb(var(--ic-rgb));
  --ic-border: rgba(var(--ic-rgb), .18);
  --ic-border-hover: rgba(var(--ic-rgb), .28);
  --ic-glow-outer: rgba(var(--ic-rgb), .22);
  --ic-glow-outer-hover: rgba(var(--ic-rgb), .32);
  --ic-glow-text-1: rgba(255,255,255,.15);
  --ic-glow-text-2: rgba(var(--ic-rgb), .55);
  --ic-glow-text-2-link: rgba(var(--ic-rgb), .45);
}


/* —— 目标选择器（精准排除 pre/.md-fences/tooltip/math preview）—— */
#write code:not(:is(pre code, .md-fences code, .code-tooltip-content, #math-inline-preview-content)){
  display: inline-block;
  padding: var(--ic-pad-y) var(--ic-pad-x);
  margin: 0 .06em;
  border-radius: var(--ic-radius);

  /* 文本与发光（常态降一层，减重绘） */
  color: var(--ic-text);
  text-shadow: 0 0 1px var(--ic-glow-text-1);

  /* 字体/排版 */
  font-family: 'JetBrainsMonoNL','RobotoMono',monospace;
  font-size: .95em;
  line-height: 1.35;
  white-space: break-spaces;
  tab-size: 2;

  /* 稳定边框避免 hover 新增边框触发布局 */
  border: 1px solid var(--ic-border);

  /* 重绘限域（大文档更稳） */
  contain: paint;
  isolation: isolate;

  /* 默认不设过渡（触屏更省） */
  transition: none;
}

/* —— 交互态（仅鼠标设备启用过渡与增强发光）—— */
@media (hover:hover){
  #write code:not(:is(pre code, .md-fences code, .code-tooltip-content, #math-inline-preview-content)){
    transition: filter .18s ease, box-shadow .18s ease, border-color .18s ease;
  }
  #write code:not(:is(pre code, .md-fences code, .code-tooltip-content, #math-inline-preview-content)):hover{
    filter: brightness(1.06) saturate(1.08);
    text-shadow:
      0 0 1px var(--ic-glow-text-1),
      0 0 6px var(--ic-glow-text-2);
    box-shadow:
      inset 0 0 0 1px rgba(255,255,255,.06),
      0 0 18px var(--ic-glow-outer-hover),
      0 3px 14px rgba(0,0,0,.28);
    border-color: var(--ic-border-hover);
  }
  #write code:not(:is(pre code, .md-fences code, .code-tooltip-content, #math-inline-preview-content)):active{
    filter: brightness(.95);
  }
}

/* —— 链接中的行内 code：维持可读性 —— */
#write a code{
  color: var(--ic-text);
  text-shadow:
    0 0 1px rgba(255,255,255,.12),
    0 0 5px var(--ic-glow-text-2-link);
  border-color: var(--ic-border-hover);
}

/* —— 减少动态偏好：关闭滤镜/过渡 —— */
@media (prefers-reduced-motion: reduce){
  #write code:not(:is(pre code, .md-fences code, .code-tooltip-content, #math-inline-preview-content)){
    transition: none !important;
  }
}

/* =============================== END OF PACKAGE ============================ */

/* =======================================================================================
   Rhapsody · Code Blocks（代码块 · 极客霓虹）
   设计理念 / Design Concept
   - 仅限 #write：外壳承担霓虹与能量条动效，内部 code 保持透明避免双重底色。
   - 全量变量化（前景/高光/阴影/tooltip/行号/选区/语法色），便于主题统一调色。
   - 动画命名本地化；尊重 prefers-reduced-motion，静态降级稳定。
   ======================================================================================= */

/* ========================================================================== */
/* REGION A — ROOT VARS（仅 #write 生效 · 变量集中维护）                       */
/* Scope: #write                                                               */
/* Function: 统一维护代码块/语法高亮/浮层/键盘键的配色、阴影、动效参数           */
/* Notes: 不改 DOM；不使用 :has；仅变量化，不改变视觉                           */
/* Adjustable: A 区全部变量（主色/阴影/动效时长/字体/token 色）                 */
/* ========================================================================== */
#write{
  /* ------ Palette（主色） ------ */
  --cb-bg: #101218;                 /* 代码块底色 */
  --cb-fg: #2aff5a;                 /* 前景主色（青绿） */
  --cb-cyan: #23b3fc;               /* 次要高光（青） */
  --cb-accent-cyan: #00ffe7;        /* 能量条青 */
  --cb-accent-gold: #ffd700;        /* 能量条金 */
  --cb-accent-pink: #ff007f;        /* 能量条品红 */
  --cb-gutter: #00eaff;             /* 行号栏文字青 */
  --cb-border: #00c18a;             /* 外壳描边 */
  --cb-select-fg: #ffffff;          /* 选中前景 */
  --cb-select-bg: #23b3fc;          /* 选中底色 */
  --cb-deep-2: #232931;             /* 深色描边/阴影辅助 */
  --cb-tooltip-bg: #19271f;         /* 代码提示底色 */
  --cb-tooltip-fg: #e91ee3;         /* 代码提示前景（洋红） */
  --cb-key-cyan: #00ccff;           /* kbd 专用青（#0cf） */

  /* ------ RGB 派生（便于半透明 rgba） ------ */
  --cb-fg-rgb: 42,255,90;
  --cb-cyan-rgb: 35,179,252;
  --cb-accent-cyan-rgb: 0,255,231;
  --cb-accent-gold-rgb: 255,215,0;
  --cb-accent-pink-rgb: 255,0,127;
  --cb-gutter-rgb: 0,234,255;
  --cb-key-cyan-rgb: 0,204,255;

  /* ------ Geometry ------ */
  --cb-radius: 1.1em;

  /* ------ Shadows（休止/激活） ------ */
  --cb-shadow-rest:
      0 0 32px 1px rgba(var(--cb-fg-rgb), .38),
      0 0 6px 0 rgba(var(--cb-cyan-rgb), .19),
      0 2px 12px rgba(0,0,0,.66);
  --cb-shadow-hover:
      0 0 56px 4px var(--cb-cyan),
      0 0 20px 4px var(--cb-fg),
      0 2px 20px var(--cb-deep-2);

  /* ------ Motion & Transition ------ */
  --cb-breath-dur: 4.2s;
  --cb-energy-dur: 6.2s;
  --cb-trans-fast: .18s;
  --cb-trans-mid:  .22s;
  --cb-trans-slow: .40s;

  /* ------ Font ------ */
  --cb-font-mono: 'JetBrainsMonoNL', monospace;

  /* ------ Syntax Tokens（如需统一调色可改此处） ------ */
  --cb-token-keyword:      #ff007f;
  --cb-token-variable:     var(--cb-fg);
  --cb-token-builtin:      var(--cb-accent-cyan);
  --cb-token-string:       var(--cb-accent-gold);
  --cb-token-number-atom:  #8b2aff;
  --cb-token-comment:      var(--cb-cyan);
  --cb-token-tag:          #ff5200;
  --cb-token-attr-prop:    #00d6ff;
  --cb-token-operator:     #ff9e00;
  --cb-token-error:        #ff1a1a;
  --cb-token-meta:         #ff00d0;
  --cb-token-type:         #aaff00;
}

/* ========================================================================== */
/* REGION B — WRAPPER（外壳 pre.md-fences）                                    */
/* Scope: #write pre.md-fences                                                  */
/* Function: 外壳底色/描边/阴影/能量条动效/滚动与字体                           */
/* Notes: 动画名本地化；滚动条 UI 隐藏但保留滚动；不改结构                      */
/* Adjustable: 半径/阴影/描边/内外边距/动画时长                                 */
/* ========================================================================== */
#write pre.md-fences{
  background: var(--cb-bg);
  color: var(--cb-fg);
  border-radius: var(--cb-radius);
  box-shadow: var(--cb-shadow-rest);
  border: 1.5px solid var(--cb-border);
  padding: 1.2em 2em 1.2em 2.5em;
  margin: 1.8em 0 2.2em 0;
  position: relative;
  overflow-x: auto;
  z-index: 6;
  text-shadow:
    0 0 8px rgba(var(--cb-fg-rgb), .38),
    0 0 2px rgba(var(--cb-cyan-rgb), .33);
  animation: borderBreath--cb var(--cb-breath-dur) cubic-bezier(.45,1.7,.32,.94) infinite alternate;
  transition: box-shadow var(--cb-trans-slow), border var(--cb-trans-slow), text-shadow var(--cb-trans-slow);
  scrollbar-color: var(--cb-accent-cyan) var(--cb-bg);
  scrollbar-width: thin;
  font-family: var(--cb-font-mono);
}
/* WebKit 隐藏滚动条 UI，保留滚动功能 */
#write pre.md-fences::-webkit-scrollbar{ display: none; width: 0; height: 0; }

/* Hover/Focus 激活态 */
#write pre.md-fences:hover,
#write pre.md-fences:focus-within{
  box-shadow: var(--cb-shadow-hover);
  border: 1.5px solid var(--cb-cyan);
  text-shadow:
    0 0 24px var(--cb-fg),
    0 0 10px var(--cb-cyan);
}

/* 顶部能量条 */
#write pre.md-fences::before{
  content: "";
  display: block;
  position: absolute;
  left: 2.2em; right: 2.2em; top: 1.1em; height: 6px;
  border-radius: 6px;
  background: linear-gradient(90deg,
              var(--cb-accent-cyan) 8%,
              var(--cb-accent-gold) 51%,
              var(--cb-accent-pink) 95%);
  opacity: 0.18;
  filter: blur(4px);
  animation: geekEnergyBar--cb var(--cb-energy-dur) cubic-bezier(.45,1.7,.32,.94) infinite alternate;
  pointer-events: none;
  z-index: 6;
  transition: background .38s cubic-bezier(.72,.08,.43,1.45), opacity .32s;
}
#write pre.md-fences:hover::before,
#write pre.md-fences:focus-within::before{
  background: linear-gradient(90deg,
              var(--cb-accent-cyan) 0%,
              var(--cb-accent-gold) 40%,
              var(--cb-accent-pink) 100%);
  opacity: 0.40;
  filter: blur(5.5px);
  transition: background .38s cubic-bezier(.72,.08,.43,1.45), opacity .32s, filter .26s;
}

/* 关键帧（本地化） */
@keyframes geekEnergyBar--cb{
  0%   { opacity: 0.12; left: 2.2em; right: 2.2em; }
  58%  { opacity: 0.36; left: 4em; right: 1.1em; }
  100% { opacity: 0.12; left: 2.2em; right: 2.2em; }
}
@keyframes borderBreath--cb{
  0% {
    box-shadow:
      0 0 32px 1px rgba(var(--cb-fg-rgb), .38),
      0 0 6px 0 rgba(var(--cb-cyan-rgb), .19),
      0 2px 12px rgba(0,0,0,.66);
  }
  100% {
    box-shadow:
      0 0 56px 4px var(--cb-cyan),
      0 0 20px 4px var(--cb-fg),
      0 2px 20px var(--cb-deep-2);
  }
}

/* ========================================================================== */
/* REGION C — CODEMIRROR（正文编辑器）                                         */
/* Scope: #write .CodeMirror*                                                   */
/* Function: 文本色/行高/字影与悬停行背景                                        */
/* Notes: 仅正文；不影响侧栏与菜单                                               */
/* Adjustable: 字号/行高/悬停透明度/文本阴影                                     */
/* ========================================================================== */
#write .CodeMirror,
#write .CodeMirror-code,
#write .CodeMirror-line{
  color: var(--cb-fg);
  background: transparent;
  font-family: var(--cb-font-mono);
  font-size: 1em;
  line-height: 1.7;
  text-shadow:
    0 0 6px rgba(var(--cb-fg-rgb), .50),
    0 0 2px rgba(var(--cb-cyan-rgb), .33);
}
#write .CodeMirror-line:hover{
  background: rgba(var(--cb-fg-rgb), .10);
  transition: background var(--cb-trans-fast);
}

/* 行号栏 */
#write .CodeMirror-gutters{
  background: transparent;
  color: var(--cb-gutter);
  border-right: 1.5px solid var(--cb-deep-2);
  opacity: 0.87;
  z-index: 6;
  font-size: 1em;
  font-family: var(--cb-font-mono);
  text-shadow:
    0 0 8px rgba(var(--cb-gutter-rgb), .60),
    0 0 2px rgba(var(--cb-fg-rgb), .25);
}

/* 光标 */
#write .CodeMirror-cursor{ border-left: 2px solid var(--cb-select-fg); }

/* ========================================================================== */
/* REGION D — TOOLTIP（浮层与工具提示）                                        */
/* Scope: #write pre.md-fences(.+ .code-tooltip)                                */
/* Function: tooltip 的底色/前景/阴影与 hover 交互                               */
/* Notes: 覆盖两种结构（内部/相邻兄弟）；z-index 本区控制                        */
/* Adjustable: 背景/前景/阴影/圆角/字号                                          */
/* ========================================================================== */
#write pre.md-fences .code-tooltip,
#write pre.md-fences + .code-tooltip,
#write .md-fences .code-tooltip{
  background: var(--cb-tooltip-bg);
  color: var(--cb-tooltip-fg);
  border-radius: 6px;
  box-shadow: 0 0 8px rgba(var(--cb-fg-rgb), .27);
  font-family: var(--cb-font-mono);
  font-size: 0.96em;
  z-index: 9;
}
#write pre.md-fences .code-tooltip:hover,
#write pre.md-fences + .code-tooltip:hover,
#write .md-fences .code-tooltip:hover{
  background: var(--cb-cyan);
  color: var(--cb-select-fg);
  box-shadow:
    0 0 16px rgba(var(--cb-cyan-rgb), .53),
    0 0 8px  rgba(var(--cb-fg-rgb), .27);
}

/* Mermaid/Flowchart 浮窗定位 */
#write .enable-diagrams pre.md-fences[lang="sequence"] .code-tooltip,
#write .enable-diagrams pre.md-fences[lang="flow"] .code-tooltip,
#write .enable-diagrams pre.md-fences[lang="mermaid"] .code-tooltip{
  bottom: -2.2em;
  right: 4px;
}

/* ========================================================================== */
/* REGION E — INNER CODE（内部 code 元素去双底）                                */
/* Scope: #write pre.md-fences code                                             */
/* Function: 透明化内部 <code>，继承外壳霓虹氛围                                 */
/* Notes: 只做字体/阴影继承，不叠加背景与圆角                                     */
/* Adjustable: 字体家族/字号                                                     */
/* ========================================================================== */
#write pre.md-fences > code,
#write pre.md-fences code{
  background: transparent;
  color: inherit;
  font-family: var(--cb-font-mono);
  text-shadow: inherit;
  padding: 0;
  border-radius: 0;
  box-shadow: none;
}

/* ========================================================================== */
/* REGION F — KBD（键盘键样式）                                                */
/* Scope: #write kbd                                                            */
/* Function: 轻量渐变 + 边框 + 霓虹字影                                          */
/* Notes: 不影响侧栏/菜单；与代码块配色统一                                      */
/* Adjustable: 渐变/描边/阴影/过渡时间                                           */
/* ========================================================================== */
#write kbd{
  padding: 2px 4px;
  font-size: 90%;
  color: var(--cb-select-fg);
  background: linear-gradient(90deg, var(--cb-key-cyan) 60%, var(--cb-bg) 100%);
  border-radius: 6px;
  border: 1.5px solid var(--cb-key-cyan);
  box-shadow: 0 2px 12px rgba(var(--cb-gutter-rgb), .27);
  text-shadow:
    0 0 8px rgba(var(--cb-gutter-rgb), .69),
    0 0 2px rgba(var(--cb-fg-rgb), .25);
  font-family: var(--cb-font-mono);
  transition:
    background var(--cb-trans-mid),
    color var(--cb-trans-mid),
    text-shadow var(--cb-trans-mid),
    border var(--cb-trans-mid);
}
#write kbd:hover{
  background: linear-gradient(90deg, var(--cb-bg) 0%, var(--cb-key-cyan) 100%);
  color: var(--cb-fg);
  text-shadow:
    0 0 8px rgba(var(--cb-fg-rgb), .60),
    0 0 8px rgba(var(--cb-cyan-rgb), .80);
  border-color: var(--cb-fg);
}

/* ========================================================================== */
/* REGION G — ACTIVE / SELECTION（活动行与选区）                                */
/* Scope: #write .CodeMirror-activeline / ::selection                           */
/* Function: 活动行底色与选区前/背景色                                           */
/* Notes: 仅正文编辑区；文本阴影与主题色联动                                     */
/* Adjustable: 透明度/过渡/前景背景色                                            */
/* ========================================================================== */
#write .CodeMirror-activeline-background{
  background: rgba(var(--cb-cyan-rgb), .12);
  transition: background var(--cb-trans-mid);
}
#write .CodeMirror-selected,
#write .CodeMirror-line::selection,
#write .CodeMirror-line::-moz-selection{
  background: var(--cb-select-bg);
  color: var(--cb-select-fg);
  text-shadow:
    0 0 8px var(--cb-select-bg),
    0 0 2px var(--cb-select-fg);
}

/* ========================================================================== */
/* REGION H — SYNTAX TOKENS（语法高亮）                                        */
/* Scope: #write .cm-*                                                          */
/* Function: 以变量映射 token 颜色，便于主题化一键联动                           */
/* Notes: 不改变语义，仅设色与字影；提供兜底高亮                                 */
/* Adjustable: Token 变量（--cb-token-*）与字影强度                              */
/* ========================================================================== */
#write .cm-keyword{   color: var(--cb-token-keyword);      text-shadow: 0 0 7px rgba(255,0,127,.53), 0 0 2px transparent; }
#write .cm-variable,
#write .cm-def{       color: var(--cb-token-variable);     text-shadow: 0 0 6px rgba(var(--cb-fg-rgb), .50), 0 0 2px rgba(var(--cb-cyan-rgb), .33); }
#write .cm-builtin{   color: var(--cb-token-builtin);      text-shadow: 0 0 6px rgba(var(--cb-accent-cyan-rgb), .50), 0 0 2px rgba(var(--cb-accent-gold-rgb), .27); }
#write .cm-string{    color: var(--cb-token-string);       text-shadow: 0 0 7px rgba(var(--cb-accent-gold-rgb), .63), 0 0 2px rgba(var(--cb-accent-cyan-rgb), .27); }
#write .cm-number,
#write .cm-atom{      color: var(--cb-token-number-atom);  text-shadow: 0 0 6px rgba(139,42,255,.53), 0 0 2px rgba(var(--cb-cyan-rgb), .27); }
#write .cm-comment{   color: var(--cb-token-comment);      font-style: italic; opacity: .87; text-shadow: 0 0 8px rgba(var(--cb-cyan-rgb), .40), 0 0 2px rgba(255,255,255,.27); }
#write .cm-tag{       color: var(--cb-token-tag);          text-shadow: 0 0 7px rgba(255,82,0,.50), 0 0 2px rgba(var(--cb-accent-gold-rgb), .27); }
#write .cm-attribute,
#write .cm-property{  color: var(--cb-token-attr-prop);    text-shadow: 0 0 5px rgba(0,214,255,.47), 0 0 2px transparent; }
#write .cm-operator{  color: var(--cb-token-operator);     text-shadow: 0 0 6px rgba(255,158,0,.53), 0 0 2px rgba(var(--cb-accent-gold-rgb), .27); }
#write .cm-error{     color: var(--cb-token-error);        text-shadow: 0 0 7px rgba(255,26,26,.53), 0 0 2px rgba(var(--cb-accent-gold-rgb), .27);
                       font-weight: bold; border-bottom: 1.5px dashed rgba(255,26,26,.40); }
#write .cm-meta{      color: var(--cb-token-meta);         text-shadow: 0 0 5px rgba(255,0,208,.53), 0 0 2px transparent; font-style: italic; }
#write .cm-type{      color: var(--cb-token-type);         text-shadow: 0 0 6px rgba(170,255,0,.53), 0 0 2px rgba(var(--cb-accent-cyan-rgb), .27); }
/* 兜底高亮 */
#write .cm-s-inner span,
#write .CodeMirror span{
  text-shadow: 0 0 4px rgba(var(--cb-fg-rgb), .20), 0 0 2px rgba(var(--cb-cyan-rgb), .20);
}

/* ========================================================================== */
/* REGION R — REDUCED MOTION（尊重减少动态）                                    */
/* Scope: @media (prefers-reduced-motion: reduce)                               */
/* Function: 停用动画/过渡，只保留静态样式                                       */
/* Notes: 关键帧与激活过渡全部关闭                                               */
/* Adjustable: 可按需细分禁用范围                                                */
/* ========================================================================== */
@media (prefers-reduced-motion: reduce){
  #write pre.md-fences{ animation: none !important; }
  #write pre.md-fences::before{ animation: none !important; }
  #write .CodeMirror-activeline-background{ transition: none !important; }
}
/* =============================== END OF PACKAGE ============================ */

/* =======================================================================================
   Rhapsody — BODY LINKS（正文内普通链接）
   设计理念 / Design Concept
   - 严格作用域：仅限 #write 下的外链 a[href^="http"]，避免影响内部锚点与菜单。
   - 视觉平衡：默认青色文字，hover 焦点时切换暖橙色并伴随轻微光晕，提升交互感。
   - 一致性：使用透明描边占位，避免 hover 边框粗细跳动；变量集中管理颜色/圆角/描边。
   - 可读性：仅在交互态使用 text-shadow，保持常态清爽，聚焦时增强可达性。
   - 兼容性：提供黑名单排除（代码、目录、脚注、标题、图像链接），避免样式污染。
   - 性能友好：无持续动画与大范围滤镜，常态静止；符合 Typora/Electron 长文场景。
   ======================================================================================= */

/* ========================================================================== */
/* REGION A — BODY LINK ROOT                                                  */
/* Scope: #write a[href^="http"]                                              */
/* Function: 定义正文外链的基础变量（颜色、字号、内边距、圆角、描边等）         */
/* Adjustable Params: --link-fg / --link-fg-hover / --link-radius / --link-pad*/
/* Compatibility: 现代浏览器 / Typora(Electron)；无动画时回退为静态           */
/* ========================================================================== */
#write {
  --link-fg: #00c5d4;                /* 链接常态前景色 */
  --link-fg-hover: #ff9e4d;          /* hover/焦点前景色 */
  --link-radius: 0.75em;             /* 圆角 */
  --link-pad-y: 0.05em;              /* 垂直内边距 */
  --link-pad-x: 0.4em;               /* 水平内边距 */
  --link-fs: 1.02rem;                /* 字号 */
  --link-fw: 500;                    /* 字重 */
  --link-lh: 1.5;                    /* 行高 */
  --link-border: 1.2px solid transparent; /* 透明描边占位 */
}

/* ========================================================================== */
/* REGION B — BODY LINK BASE                                                  */
/* Scope: #write a[href^="http"]                                              */
/* Function: 应用 Root 变量，设定常态样式与交互过渡                           */
/* ========================================================================== */
#write a[href^="http"] {
  position: relative; 
  display: inline;
  padding: var(--link-pad-y) var(--link-pad-x);
  font-size: var(--link-fs);
  font-weight: var(--link-fw);
  line-height: var(--link-lh);

  color: var(--link-fg);
  text-decoration: none;
  border-radius: var(--link-radius);
  border-bottom: var(--link-border);

  transition: color .25s ease, border-color .25s ease, text-shadow .25s ease;
  cursor: pointer;
}

/* Hover 效果 */
#write a[href^="http"]:hover {
  color: var(--link-fg-hover);
  border-bottom-color: var(--link-fg-hover);
  text-shadow:
    0 0 1px rgba(0, 0, 0, 0.25),
    0 0 4px rgba(255, 130, 0, 0.4),
    0 0 10px rgba(255, 90, 0, 0.2);
}

/* 外链前缀图标 */
#write a[href^="http"]::before {
  content: "🌐 ";
  color: var(--link-fg-hover);
  font-size: 0.9em;
  margin-right: 0.2em;
}

/* ========================================================================== */
/* REGION C — BODY LINK BLACKLIST                                             */
/* Scope: code/目录/脚注/标题锚点/图片链接                                    */
/* Function: 恢复朴素链接样式，禁用前缀图标                                   */
/* ========================================================================== */
#write :is(pre, code, kbd, tt, var) a[href^="http"],
#write .CodeMirror a[href^="http"],
#write .md-toc a[href^="http"],
#write .footnotes a[href^="http"],
#write :is(h1,h2,h3,h4,h5,h6) a[href^="http"],
#write a[href^="http"]:has(:where(img,svg)),
#write a.md-header-anchor {
  color: inherit;
  text-decoration: underline;
  padding: 0;
  border: 0;
  text-shadow: none;
  background: transparent;
}

#write :is(pre, code, kbd, tt, var) a[href^="http"]::before,
#write .CodeMirror a[href^="http"]::before,
#write .md-toc a[href^="http"]::before,
#write .footnotes a[href^="http"]::before,
#write :is(h1,h2,h3,h4,h5,h6) a[href^="http"]::before,
#write a[href^="http"]:has(:where(img,svg))::before,
#write a.md-header-anchor::before {
  content: "";
}

/* ========================================================================== */
/* REGION D — BODY LINK ACCESSIBILITY                                         */
/* Scope: focus-visible 状态                                                   */
/* Function: 增强键盘可达性，保证焦点可见                                     */
/* ========================================================================== */
#write a[href^="http"]:not(:has(:where(img,svg))):focus-visible {
  color: var(--link-fg-hover);
  border-bottom-color: var(--link-fg-hover);
  outline: 2px solid currentColor;
  outline-offset: 2px;
  text-decoration: underline;
}

/* =============================== END OF PACKAGE ============================ */

/* =======================================================================================
   Rhapsody · Footnotes（正文脚注系统 · 上标 / 文末卡片 / 浮窗提示）
   设计理念 / Design Concept
   - 使用 --fn-* 局部变量集中维护脚注色彩、间距、阴影，避免散点硬编码。
   - 保持 Typora 原生 DOM 结构不变，所有装饰与浮窗均以选择器约束实现。
   - 交互层分三类：上标（sup.md-footnote）、文末卡片（.footnotes）、浮窗提示（.code-tooltip）。
   - 浮窗严格限定为“纯文本脚注”，显式排除数学节点，防止样式串扰。
   - 提供 prefers-reduced-motion 兜底，禁用动画/过渡以降低性能消耗。
   ======================================================================================= */

/* ========================================================================== */
/* REGION A — FOOTNOTE ROOT VARIABLES                                         */
/* Scope: #write                                                              */
/* Function: 脚注上标、文末卡片、圆点编号、返回箭头的核心变量                   */
/* Adjustable Params: 色彩、尺寸、阴影、过渡                                  */
/* ========================================================================== */
#write {
  /* 上标 */
  --fn-sup-fs: .78em;
  --fn-sup-fw: 500;
  --fn-sup-lh: 1.1;
  --fn-sup-pad-y: .04em;
  --fn-sup-pad-x: .3em;
  --fn-sup-mx: .1em;
  --fn-sup-radius: .45em;
  --fn-sup-fg: #a86a74;
  --fn-sup-bg: rgba(220,100,110,.12);
  --fn-sup-bd: #e49ca3;
  --fn-sup-hover-bg: #f5d6b8;
  --fn-sup-hover-fg: #a86a74;
  --fn-sup-hover-bd: #f5d6b8;
  --fn-sup-hover-bs: 0 0 4px #e49ca344,0 0 8px #f5d6b866;
  --fn-sup-hover-ts: 0 0 2px #fff;

  /* 文末卡片 */
  --fn-card-bg: #fff7f7;
  --fn-card-bd-left: #e49ca3;
  --fn-card-radius: .9em;
  --fn-card-pad: 1em 1.2em 1em 2.2em;
  --fn-card-my: 1.4em;
  --fn-card-bs: 0 1px 2px rgba(180,90,110,.05), 0 0 9px #e49ca315;
  --fn-card-gap: 1em;
  --fn-card-text: #8c4c5a;

  /* 编号圆点 */
  --fn-num-bg: #e49ca3;
  --fn-num-fg: #fff;
  --fn-num-fs: .8rem;
  --fn-num-box: 1.65em;
  --fn-num-bs: 0 0 4px #e49ca344;

  /* 返回箭头 */
  --fn-back-fg: #e49ca3;
  --fn-back-hover-fg: #a86a74;
  --fn-back-pos-x: 1em;
  --fn-back-pos-y: .65em;
  --fn-back-scale: 1.2;

  /* 动画 */
  --fn-tr-slow: .25s ease;
  --fn-tr-fast: .2s ease;

  /* 装饰 emoji */
  --fn-emoji: "🍷";
  --fn-emoji-left: .65em;
  --fn-emoji-top: .65em;
  --fn-emoji-fs: 1.18em;
  --fn-emoji-op: .68;
}

/* Scope: #write sup.md-footnote */
#write sup.md-footnote {
  display:inline-block;
  font-size:var(--fn-sup-fs);
  font-weight:var(--fn-sup-fw);
  line-height:var(--fn-sup-lh);
  padding:var(--fn-sup-pad-y) var(--fn-sup-pad-x);
  margin:0 var(--fn-sup-mx);
  border-radius:var(--fn-sup-radius);

  vertical-align:baseline;
  color:var(--fn-sup-fg);
  background:var(--fn-sup-bg);
  border:1px dashed var(--fn-sup-bd);

  text-decoration:none;
  position:relative;
  cursor:pointer;

  transition:
    color var(--fn-tr-slow),
    background-color var(--fn-tr-slow),
    border-color var(--fn-tr-slow),
    box-shadow var(--fn-tr-slow),
    text-shadow var(--fn-tr-slow);
}
#write sup.md-footnote:hover {
  background:var(--fn-sup-hover-bg);
  color:var(--fn-sup-hover-fg);
  border-color:var(--fn-sup-hover-bd);
  box-shadow:var(--fn-sup-hover-bs);
  text-shadow:var(--fn-sup-hover-ts);
}
#write sup.md-footnote:focus-visible {
  outline:2px solid currentColor;
  outline-offset:2px;
  text-decoration:underline;
}


/* Scope: #write .footnotes.md-def-footnote*/
#write .footnotes.md-def-footnote {
  background:var(--fn-card-bg);
  border-left:4px solid var(--fn-card-bd-left);
  border-radius:var(--fn-card-radius);
  padding:var(--fn-card-pad);
  margin:var(--fn-card-my) 0;
  box-shadow:var(--fn-card-bs);
  display:flex;
  align-items:flex-start;
  gap:var(--fn-card-gap);
  position:relative;
}
#write .footnotes.md-def-footnote::before {
  content:var(--fn-emoji);
  position:absolute;
  left:var(--fn-emoji-left);
  top:var(--fn-emoji-top);
  font-size:var(--fn-emoji-fs);
  opacity:var(--fn-emoji-op);
  filter:blur(.1px);
  pointer-events:none;
}
#write .footnotes .md-def-name {
  display:inline-block;
  background:var(--fn-num-bg);
  color:var(--fn-num-fg);
  font-weight:bold;
  font-size:var(--fn-num-fs);
  width:var(--fn-num-box);
  height:var(--fn-num-box);
  text-align:center;
  line-height:var(--fn-num-box);
  border-radius:50%;
  flex-shrink:0;
  box-shadow:var(--fn-num-bs);
}
#write .footnotes .md-def-content {
  font-size:.97em;
  line-height:1.7;
  color:var(--fn-card-text);
  flex:1;
  word-break:break-word;
}
#write .footnotes .md-footnote-backref {
  position:absolute;
  bottom:var(--fn-back-pos-y);
  right:var(--fn-back-pos-x);
  font-size:.9em;
  color:var(--fn-back-fg);
  text-decoration:none;
  opacity:.82;
  transition:color var(--fn-tr-fast), transform var(--fn-tr-fast), opacity var(--fn-tr-fast);
}
#write .footnotes .md-footnote-backref:hover {
  color:var(--fn-back-hover-fg);
  transform:scale(var(--fn-back-scale));
  opacity:1;
}
#write .footnotes .md-footnote-backref:focus-visible {
  outline:2px solid currentColor;
  outline-offset:2px;
}

/* ========================================================================== */
/* REGION B — FOOTNOTE TOOLTIP (Lite Strict)                                   */
/* Scope: 仅“脚注触发 + 纯文本内容”，显式排除数学；保持原交互与视觉               */
/* Notes: 合并选择器，减少重复；不更改 DOM 与语义。                              */
/* 触发条件（A）：页面上存在“获得焦点/悬停”的脚注上标，且目标浮窗必须：                   */
/*   1) .code-tooltip（Typora 原生）                                                       */
/*   2) 含 .md-plain（脚注纯文本）                                                         */
/*   3) 不包含任意数学相关节点（mjx-container/.MathJax/.md-inline-math/.md-math-block等） */
/* ========================================================================== */

html:has(#write sup.md-footnote:is(:hover,:focus,:focus-visible))
  .code-tooltip:has(.code-tooltip-content .md-plain):not(:has(
    mjx-container, .MathJax, .md-inline-math, .md-math-block,
    .md-mathjax-preview, #math-inline-preview-content
  )){
  background:#f8ecec !important;
  border-radius:.85em;
  box-shadow:0 2px 12px #e49ca322;
  padding:.95em 1.25em;
  max-width:min(36rem,90vw);
  transform:translateY(var(--fn-tip-offset-y,0));
  outline:none;
}

/* 箭头同色（同样限定为“纯文本脚注浮窗”，并排除数学） */
html:has(#write sup.md-footnote:is(:hover,:focus,:focus-visible))
  .code-tooltip.md-hover-tip:has(.code-tooltip-content .md-plain):not(:has(
    mjx-container, .MathJax, .md-inline-math, .md-math-block,
    .md-mathjax-preview, #math-inline-preview-content
  )) .md-arrow::after{
  background:#f8ecec !important;
  box-shadow:0 1px 6px rgba(228,156,163,.35);
  border-radius:2px;
}

/* A 文本着色（同样严格限定为“脚注纯文本浮窗”） */
html:has(#write sup.md-footnote:is(:hover,:focus,:focus-visible))
  .code-tooltip:has(.code-tooltip-content .md-plain):not(:has(
    mjx-container, .MathJax, .md-inline-math, .md-math-block,
    .md-mathjax-preview, #math-inline-preview-content
  )) .code-tooltip-content .md-plain{
  color:#a86a74;
  font-size:1.06em;
  font-weight:600;
  text-shadow:0 0 6px #e49ca328;
  letter-spacing:.02em;
}

/* B) 允许鼠标移入浮窗本身而不中断样式（仍仅限“纯文本脚注浮窗”） */
.code-tooltip:has(.code-tooltip-content .md-plain):not(:has(
  mjx-container, .MathJax, .md-inline-math, .md-math-block,
  .md-mathjax-preview, #math-inline-preview-content
)):hover,
.code-tooltip:has(.code-tooltip-content .md-plain):not(:has(
  mjx-container, .MathJax, .md-inline-math, .md-math-block,
  .md-mathjax-preview, #math-inline-preview-content
)):focus-within{
  background:#f8ecec !important;
  border-radius:.85em;
  box-shadow:0 2px 12px #e49ca322;
  padding:.95em 1.25em;
  max-width:min(36rem,90vw);
  outline:none;
}
.code-tooltip.md-hover-tip:has(.code-tooltip-content .md-plain):not(:has(
  mjx-container, .MathJax, .md-inline-math, .md-math-block,
  .md-mathjax-preview, #math-inline-preview-content
)):is(:hover,:focus-within) .md-arrow::after{
  background:#f8ecec !important;
  box-shadow:0 1px 6px rgba(228,156,163,.35);
  border-radius:2px;
}
.code-tooltip:has(.code-tooltip-content .md-plain):not(:has(
  mjx-container, .MathJax, .md-inline-math, .md-math-block,
  .md-mathjax-preview, #math-inline-preview-content
)) :is(.code-tooltip-content .md-plain){
  color:#a86a74;
  font-size:1.06em;
  font-weight:600;
  text-shadow:0 0 6px #e49ca328;
  letter-spacing:.02em;
}

/* C) 复原：当上标未激活且浮窗也未被 hover/focus-within 时，且仅限“纯文本脚注浮窗” */
html:not(:has(#write sup.md-footnote:is(:hover,:focus,:focus-visible)))
  .code-tooltip:has(.code-tooltip-content .md-plain):not(:has(
    mjx-container, .MathJax, .md-inline-math, .md-math-block,
    .md-mathjax-preview, #math-inline-preview-content
  )):not(:hover):not(:focus-within){
  background:revert !important;
  border-radius:revert;
  box-shadow:none;
  padding:revert;
  transform:none;
  outline:none;
}
html:not(:has(#write sup.md-footnote:is(:hover,:focus,:focus-visible)))
  .code-tooltip.md-hover-tip:has(.code-tooltip-content .md-plain):not(:has(
    mjx-container, .MathJax, .md-inline-math, .md-math-block,
    .md-mathjax-preview, #math-inline-preview-content
  )):not(:hover):not(:focus-within) .md-arrow::after{
  background:revert !important;
  box-shadow:none;
  border-radius:0;
}

/* === 兜底：任何“含数学内容”的 tooltip 一律强制复原，防止黑菱形等串样式 ================= */
.code-tooltip:has(
  mjx-container, .MathJax, .md-inline-math, .md-math-block,
  .md-mathjax-preview, #math-inline-preview-content
){
  background:revert !important;
  border-radius:revert;
  box-shadow:none;
  padding:revert;
  outline:none;
}
.code-tooltip:has(
  mjx-container, .MathJax, .md-inline-math, .md-math-block,
  .md-mathjax-preview, #math-inline-preview-content
) .md-arrow::after{
  background:revert !important;
  box-shadow:none;
  border-radius:0;
}

/* 减少动态偏好：脚注相关动画停用 */
@media (prefers-reduced-motion: reduce){
  #write .footnotes .md-footnote-backref{ transition:none; transform:none; }
  #write sup.md-footnote{ transition:none; }
  html:has(#write sup.md-footnote:is(:hover,:focus,:focus-visible))
    .code-tooltip:has(.code-tooltip-content .md-plain){ transition:none; transform:none; }
  .code-tooltip:has(.code-tooltip-content .md-plain):is(:hover,:focus-within){
    transition:none; transform:none;
  }
}
/* =============================== END OF PACKAGE ============================ */
/* =======================================================================================
  TABLES · 江山如故（#write 正文表格体系 · A/B/C/D 四区）
   Design Philosophy · 设计理念
   ------------------------------------------------------------------------------
   Scope（限域）
     - 仅在写作区 #write 生效，覆盖：
       · A — 表格编辑工具条（.ty-table-edit / .md-table-edit）
       · B — 表格主体（.markdown-rendered table / .md-table 及 th/td/tr/a）
       · C — 表格创建器（.md-grid-board-wrap 新建表格时的网格面板）
       · D — 减少动态偏好（prefers-reduced-motion: reduce）
     - 不改动 HTML 结构，不影响侧栏/弹窗/偏好面板等全局 UI。

   Structure（结构）
     - 分区化维护：A/B/C/D 四大区域，各自含「变量块 + 样式块」。
     - 变量命名以 --tbl-* 为前缀，视觉与尺寸默认值与原实现一致；按需覆盖即可。
     - 统一注释层级：A0/B0/C0 为变量，A1~A5、B1~B8、C1~C4 为功能小节。

   Performance（性能）
     - 彻底移除全局 :has() 扫描与多余 :is() 组合，选择器收敛到 #write。
     - 避免常驻 will-change；仅在需要时短暂提升（D 区域另含无动效方案）。
     - 大图放在 ::before 作为装饰图层，可通过变量快速关闭或替换。

   Theming（主题变量）
     - 颜色、阴影、圆角、z-index、背景图等全部由变量统一管理：
       · A 区工具条：--tbl-bg / --tbl-bd / --tbl-radius / --tbl-shadow / ……
       · B 区主体：--tbl-body-*（背景图、圆角、阴影、连结色等）
       · C 区创建器：--tbl-creator-*（圆角、渐变、插图、输入与按钮）
     - 若需轻量模式：可把相关 *-img 设为 none，或下调不透明度/阴影强度。

   Accessibility（可访问性）
     - D 区在系统开启“减少动态效果”时取消 transform/transition，降低眩晕与 GPU 占用。

   Notes（说明）
     - 变量默认值与原版视觉完全一致；替换本文件不会改变现有效果。
     - 若未来发现编辑工具条并非表格子节点，可追加一段「备用守门」选择器于 A 区。
     - 遵循 Typora 限制：不随意改动 HTML 结构，不滥用全局 !important。
   ======================================================================================= */



/* ========================================================================== */
/* REGION A — TABLE TOOLBAR（仅 #write 表格编辑工具条，视觉参数与原版一致）    */
/* Scope: (#write figure.md-table-fig > .ty|.md-table-edit) 与                 */
/*        (#write table .ty|.md-table-edit)                                    */
/* ========================================================================== */

/* 变量：默认值 = 你原来的具体数值 */
#write{
  --tbl-bg: #fffdfa;
  --tbl-fg: #232931;
  --tbl-bd-color: #ecd06b;
  --tbl-bd: 1.2px solid var(--tbl-bd-color);
  --tbl-radius: .9em;
  --tbl-shadow: 0 1.5px 8px #ecd06b18;
  --tbl-z: 6;
  --tbl-offset-y: 16px;

  --tbl-icon-stroke: .6px rgba(255,253,250,.8);
  --tbl-icon-shadow: 0 0 3px rgba(255,253,250,.7), 0 0 6px rgba(236,208,107,.35);

  --tbl-icon-menu: #168fcf;
  --tbl-icon-dots: #232931;
  --tbl-icon-del:  #a35a1f;

  --tbl-hover-menu: #1eb7ff;
  --tbl-hover-dots: #4a4f57;
  --tbl-hover-del:  #ff7b29;

  --tbl-active-menu: #117fb3;
  --tbl-active-dots: #1c1e21;
  --tbl-active-del:  #8b4513;

  --tbl-btn-bg:       rgba(255,253,250,.82);
  --tbl-btn-fg:       #0770fd;
  --tbl-btn-bg-hover: rgba(255,253,250,.18);
  --tbl-btn-fg-hover: #ffd700;
  --tbl-btn-bg-on:    rgba(255,253,220,.29);
  --tbl-btn-fg-on:    #ff2a2a;

  --tbl-overlay-img: url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/assets/Table/%E5%8D%83%E9%87%8C%E6%B1%9F%E5%B1%B1.png');
}

/* 容器（保持 position/z-index/transform 等一致） */
#write figure.md-table-fig > .ty-table-edit,
#write figure.md-table-fig > .md-table-edit,
#write table .ty-table-edit,
#write table .md-table-edit{
  background: var(--tbl-bg);
  border: var(--tbl-bd);
  border-radius: var(--tbl-radius);
  box-shadow: var(--tbl-shadow);
  color: var(--tbl-fg);
  position: absolute;
  z-index: var(--tbl-z);
  transform: translateY(var(--tbl-offset-y));
  will-change: transform; /* 按你的原始写法保留 */
}

/* 图标（保持 stroke / text-shadow 与颜色一致） */
#write figure.md-table-fig > .ty-table-edit .ty-icon.ty-menu::before,
#write figure.md-table-fig > .md-table-edit .ty-icon.ty-menu::before,
#write table .ty-table-edit .ty-icon.ty-menu::before,
#write table .md-table-edit .ty-icon.ty-menu::before,
#write figure.md-table-fig > .ty-table-edit .ty-icon.ty-dots-v::before,
#write figure.md-table-fig > .md-table-edit .ty-icon.ty-dots-v::before,
#write table .ty-table-edit .ty-icon.ty-dots-v::before,
#write table .md-table-edit .ty-icon.ty-dots-v::before,
#write figure.md-table-fig > .ty-table-edit .ty-icon.ty-delete::before,
#write figure.md-table-fig > .md-table-edit .ty-icon.ty-delete::before,
#write table .ty-table-edit .ty-icon.ty-delete::before,
#write table .md-table-edit .ty-icon.ty-delete::before{
  position: relative; z-index: 2;
  -webkit-text-stroke: var(--tbl-icon-stroke);
  text-shadow: var(--tbl-icon-shadow);
  mix-blend-mode: normal;
  transition: color .18s ease, text-shadow .18s ease, transform .18s ease;
}

/* 常态色（与原值一致） */
#write figure.md-table-fig > .ty-table-edit .ty-icon.ty-menu::before,
#write figure.md-table-fig > .md-table-edit .ty-icon.ty-menu::before,
#write table .ty-table-edit .ty-icon.ty-menu::before,
#write table .md-table-edit .ty-icon.ty-menu::before{ color: var(--tbl-icon-menu); }

#write figure.md-table-fig > .ty-table-edit .ty-icon.ty-dots-v::before,
#write figure.md-table-fig > .md-table-edit .ty-icon.ty-dots-v::before,
#write table .ty-table-edit .ty-icon.ty-dots-v::before,
#write table .md-table-edit .ty-icon.ty-dots-v::before{ color: var(--tbl-icon-dots); }

#write figure.md-table-fig > .ty-table-edit .ty-icon.ty-delete::before,
#write figure.md-table-fig > .md-table-edit .ty-icon.ty-delete::before,
#write table .ty-table-edit .ty-icon.ty-delete::before,
#write table .md-table-edit .ty-icon.ty-delete::before{ color: var(--tbl-icon-del); }

/* Hover / Active（保持完全一致的色与阴影与位移） */
#write .ty-table-edit .btn:hover .ty-icon.ty-menu::before,
#write .md-table-edit .btn:hover .ty-icon.ty-menu::before{
  color: var(--tbl-hover-menu);
  text-shadow: 0 0 8px rgba(30,183,255,.4), 0 0 3px #fffbe3;
  transform: translateY(-.5px);
}
#write .ty-table-edit .btn:hover .ty-icon.ty-dots-v::before,
#write .md-table-edit .btn:hover .ty-icon.ty-dots-v::before{
  color: var(--tbl-hover-dots);
  text-shadow: 0 0 8px rgba(74,79,87,.4), 0 0 3px #fffbe3;
  transform: translateY(-.5px);
}
#write .ty-table-edit .btn:hover .ty-icon.ty-delete::before,
#write .md-table-edit .btn:hover .ty-icon.ty-delete::before{
  color: var(--tbl-hover-del);
  text-shadow: 0 0 8px rgba(255,123,41,.4), 0 0 3px #fffbe3;
  transform: translateY(-.5px);
}
#write .ty-table-edit .btn:active .ty-icon.ty-menu::before,
#write .ty-table-edit .btn.active .ty-icon.ty-menu::before,
#write .md-table-edit .btn:active .ty-icon.ty-menu::before,
#write .md-table-edit .btn.active .ty-icon.ty-menu::before{ color: var(--tbl-active-menu); }

#write .ty-table-edit .btn:active .ty-icon.ty-dots-v::before,
#write .ty-table-edit .btn.active .ty-icon.ty-dots-v::before,
#write .md-table-edit .btn:active .ty-icon.ty-dots-v::before,
#write .md-table-edit .btn.active .ty-icon.ty-dots-v::before{ color: var(--tbl-active-dots); }

#write .ty-table-edit .btn:active .ty-icon.ty-delete::before,
#write .ty-table-edit .btn.active .ty-icon.ty-delete::before,
#write .md-table-edit .btn:active .ty-icon.ty-delete::before,
#write .md-table-edit .btn.active .ty-icon.ty-delete::before{ color: var(--tbl-active-del); }

/* 工具条按钮（尺寸/颜色/间距完全一致） */
#write .ty-table-edit .btn,
#write .md-table-edit .btn{
  background: var(--tbl-btn-bg);
  color: var(--tbl-btn-fg);
  border: none;
  border-radius: .5em;
  padding: .28em 1em;
  margin: 0 3px;
  font-size: 1em;
  font-family: inherit;
  outline: none;
  cursor: pointer;
  box-shadow: none;
  transition: background .16s, color .14s, font-weight .18s;
  user-select: none;
}
#write .ty-table-edit .btn:hover,
#write .md-table-edit .btn:hover,
#write .ty-table-edit .btn:active,
#write .md-table-edit .btn:active{
  background: var(--tbl-btn-bg-hover);
  color: var(--tbl-btn-fg-hover);
}
#write .ty-table-edit .btn.active,
#write .ty-table-edit .btn.selected,
#write .ty-table-edit .btn[aria-pressed="true"],
#write .md-table-edit .btn.active,
#write .md-table-edit .btn.selected,
#write .md-table-edit .btn[aria-pressed="true"]{
  background: var(--tbl-btn-bg-on);
  color: var(--tbl-btn-fg-on);
  font-weight: bold;
}

/* 墨画蒙层（保持你的渐变 + 图片；仅 hover 显现） */
#write .ty-table-edit::before,
#write .md-table-edit::before{
  content:"";
  position:absolute; inset:0; z-index:1; border-radius:var(--tbl-radius);
  background:
    linear-gradient(115deg, #fffefa90 60%, #ecd06b22 100%),
    var(--tbl-overlay-img) center/cover no-repeat;
  opacity:0; pointer-events:none; transition: opacity .36s;
}
#write .ty-table-edit:hover::before,
#write .md-table-edit:hover::before{ opacity:.95; }

/* =======================================================================================
   REGION B — TABLE BODY（#write 正文表格主体）
   Scope: #write 内的 .markdown-rendered table / .md-table 及其 th、td、tr、a
   Function
     - 定义正文表格的背景、圆角、阴影、文字与 hover 效果；
     - 视觉保持原始参数不变，封装变量方便调整。
   Adjustable Params
     - --tbl-body-bg-img / --tbl-body-radius / --tbl-body-shadow / --tbl-body-border
     - --tbl-head-color / --tbl-td-color / --tbl-link / --tbl-link-hover
   ======================================================================================= */


/* ====================== B0. 变量（默认值 = 原始数值） ====================== */
#write{
  --tbl-body-bg-img: url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/assets/Table/%E5%A4%A9%E4%B8%8A%E4%BA%BA%E9%97%B4.png');
  --tbl-body-radius: 1.4em;
  --tbl-body-margin: 2em 0 0.5em 0;
  --tbl-body-shadow: 0 6px 28px -4px rgba(20,24,28,.14);
  --tbl-body-border: 0 0 0 2px #e3d7b3;

  --tbl-head-color: #a35a1f;
  --tbl-head-shadow: 0 1.5px 0 #ecd06b inset, 0 .8px 16px #0002;

  --tbl-td-color: #3b2e1e;
  --tbl-link: #168fcf;
  --tbl-link-hover: #ff2a2a;
  --tbl-link-bd: 1.5px dotted #168fcf;
  --tbl-link-bd-hover: 2px solid #ecd06b;
}


/* ====================== B1. 表格容器（table 本体） ====================== */
#write :is(.markdown-rendered table, .md-table){
  width: 100%;
  position: relative;
  background: var(--tbl-body-bg-img) center top/cover no-repeat;
  border-radius: var(--tbl-body-radius);
  overflow: hidden;
  margin: var(--tbl-body-margin);
  box-shadow: var(--tbl-body-shadow), var(--tbl-body-border);
  border-collapse: separate;
  border-spacing: 0;
  font-family: 'GuDuYanHei','AliPuHuiTi',serif;
  -webkit-font-smoothing: antialiased;
  z-index: 5;
}


/* ====================== B2. 表头（th） ====================== */
#write :is(.markdown-rendered th, .md-table th){
  position: relative;
  font-size: 1.3em; /* 原代码 1.08em 与 1.3em 同时出现，这里保留大号 */
  color: var(--tbl-head-color);
  text-shadow: 0 0 1px #fff6ed, 0 0 2px rgba(255,240,200,.4);
  background: transparent;
  padding: 1.1em 1.6em 1em 1.4em;
  box-shadow: var(--tbl-head-shadow);
  letter-spacing: .08em;
  text-align: left;
  z-index: 7;
  border: none;
  box-sizing: border-box;
}


/* ====================== B3. 单元格（td） ====================== */
#write :is(.markdown-rendered td, .md-table td){
  font-size: 1em;
  font-family: 'AliPuHuiTi','SourceHanSansSoft',sans-serif;
  color: var(--tbl-td-color);
  background: transparent;
  padding: 1em 1.5em 1em 1.3em;
  border: none;
  transition: background .2s, color .2s;
  box-sizing: border-box;
}


/* ====================== B4. 行 Hover 高亮 ====================== */
#write :is(.markdown-rendered tr:hover td, .md-table tr:hover td){
  background: linear-gradient(90deg, #fffbe3aa 70%, #ffe06b33 100%);
  box-shadow: 0 0 18px #ecd06b33;
  transition: background .25s, box-shadow .28s;
}


/* ====================== B5. 链接高亮 ====================== */
#write :is(.markdown-rendered td a, .md-table td a){
  color: var(--tbl-link);
  border-bottom: var(--tbl-link-bd);
  text-decoration: none;
  transition: color .2s, border .2s;
}
#write :is(.markdown-rendered td a:hover, .md-table td a:hover){
  color: var(--tbl-link-hover);
  border-bottom: var(--tbl-link-bd-hover);
}


/* ====================== B6. 编辑聚焦态 ====================== */
#write th .td-span,
#write td .td-span{
  display: block;
  min-height: 1.6em;
  outline: none;
  word-break: break-word;
  background: transparent;
  overflow: visible;
}
#write th .td-span:focus,
#write td .td-span:focus{
  background: #fffbe3;
  box-shadow: 0 0 8px #ecd06b66;
  border-radius: .24em;
  color: var(--tbl-link-hover);
}


/* ====================== B7. 圆角收尾 ====================== */
#write .markdown-rendered tr:first-child th:first-child,
#write .md-table tr:first-child th:first-child{ border-top-left-radius: 1.1em; }
#write .markdown-rendered tr:first-child th:last-child,
#write .md-table tr:first-child th:last-child{ border-top-right-radius: 1.1em; }
#write .markdown-rendered tr:last-child td:first-child,
#write .md-table tr:last-child td:first-child{ border-bottom-left-radius: 1.1em; }
#write .markdown-rendered tr:last-child td:last-child,
#write .md-table tr:last-child td:last-child{ border-bottom-right-radius: 1.1em; }


/* ====================== B8. 对齐映射 ====================== */
#write .td-span.md-align-left  { text-align: left; }
#write .td-span.md-align-center{ text-align: center; }
#write .td-span.md-align-right { text-align: right; }

/* =======================================================================================
   REGION C — TABLE CREATOR（表格创建器 · 新建表格时弹出面板）
   Scope: #write 激活时出现的 .md-grid-board-wrap 及其子元素
   Function
     - 定义表格创建器网格面板的背景、蒙层、输入框与按钮样式。
     - 保持与表格主体/工具条视觉统一；用变量可一键换背景图或调整圆角。
   ======================================================================================= */

/* ---------------------- C0. 变量（默认值 = 原始数值） ---------------------- */
#write {
  --tbl-creator-radius: .9em;
  --tbl-creator-bg: linear-gradient(115deg, rgba(255,254,250,.92) 60%, rgba(236,208,107,.15) 100%);
  --tbl-creator-img: url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/assets/Table/%E6%B8%94%E8%88%9F%E5%94%B1%E6%99%9A.png');
  --tbl-creator-bd: 1.2px solid #ecd06b;
  --tbl-creator-title-shadow: inset 0 1px 2px rgba(236,208,107,.2);

  --tbl-creator-input-bg: rgba(255,253,250,.92);
  --tbl-creator-input-bd: 1px solid #ecd06b;
  --tbl-creator-input-color: #3b2e1e;
  --tbl-creator-input-fg: 'AliPuHuiTi',sans-serif;
  --tbl-creator-input-fs: .9em;

  --tbl-creator-input-focus-bd: #ff2a2a;
  --tbl-creator-input-focus-shadow: 0 0 6px rgba(255,42,42,.3);

  --tbl-creator-btn-bg: rgba(255,253,250,.92);
  --tbl-creator-btn-bd: 1px solid #ecd06b;
  --tbl-creator-btn-color: #a35a1f;
  --tbl-creator-btn-radius: .4em;
  --tbl-creator-btn-shadow: 0 1px 4px rgba(236,208,107,.12);
}

/* ---------------------- C1. 主容器与蒙层 ---------------------- */
#write .md-grid-board-wrap {
  position: relative;
  border-radius: var(--tbl-creator-radius);
  overflow: hidden;
  background: var(--tbl-creator-bg);
  transition: background .6s ease;
}
#write .md-grid-board-wrap::before {
  content: "";
  position: absolute; inset: 0; z-index: 0;
  background: var(--tbl-creator-img) center/cover no-repeat;
  opacity: 0;
  transition: opacity .6s ease;
}
#write .md-grid-board-wrap:hover::before { opacity: 1; }
#write .md-grid-board-wrap * { position: relative; z-index: 1; }

/* ---------------------- C2. 标题栏 ---------------------- */
#write .md-grid-board-wrap .popover-title {
  display: flex; align-items: center; gap: .4em;
  padding: .4em .6em;
  border-top: var(--tbl-creator-bd);
  border-radius: 0 0 var(--tbl-creator-radius) var(--tbl-creator-radius);
  box-shadow: var(--tbl-creator-title-shadow);
  background: transparent;
}

/* ---------------------- C3. 输入框 ---------------------- */
#write .md-grid-board-wrap .popover-title input {
  border: var(--tbl-creator-input-bd);
  border-radius: .4em;
  background: var(--tbl-creator-input-bg);
  color: var(--tbl-creator-input-color);
  padding: .25em .5em;
  font-family: var(--tbl-creator-input-fg);
  font-size: var(--tbl-creator-input-fs);
  box-shadow: var(--tbl-creator-btn-shadow);
  transition: all .2s ease;
}
#write .md-grid-board-wrap .popover-title input:focus {
  outline: none;
  border-color: var(--tbl-creator-input-focus-bd);
  box-shadow: var(--tbl-creator-input-focus-shadow);
}

/* ---------------------- C4. 按钮 ---------------------- */
#write .md-grid-board-wrap .popover-title button.btn.btn-primary.btn-xs {
  border: var(--tbl-creator-btn-bd);
  border-radius: var(--tbl-creator-btn-radius);
  background: var(--tbl-creator-btn-bg);
  color: var(--tbl-creator-btn-color);
  padding: .25em .6em;
  font-family: 'AliPuHuiTi',sans-serif;
  font-size: .9em;
  cursor: pointer;
  box-shadow: var(--tbl-creator-btn-shadow);
  transition: all .2s ease;
}


/* =======================================================================================
   REGION D — REDUCED MOTION（无障碍设置下减少动态效果）
   Scope: prefers-reduced-motion: reduce
   Function
     - 当系统启用“减少动态效果”时，关闭表格工具条的 transform/transition 动画，
       以降低 GPU 占用并提升可访问性。
   ======================================================================================= */

@media (prefers-reduced-motion: reduce) {
  #write .ty-table-edit,
  #write .md-table-edit {
    transform: none;
    transition: none;
  }
}
/* =============================== END OF PACKAGE ============================ */
/* =======================================================================================
   Rhapsody · Inline Math（行内数学公式 · MathJax/SVG 一体 + 预览气泡）
   设计理念 / Design Concept
   - 范围仅 #write：正文与 md-alert 中行内公式统一风格。
   - 所有色值/字体/阴影/过渡参数变量化，SVG 与 tooltip 共用 --im-*。
   - Hover 高亮统一；预览气泡背景/描边/阴影可独立调整。
   ======================================================================================= */

/* ========================================================================== */
/* REGION A — ROOT VARS（集中变量 · 仅 #write）                                */
/* Scope: #write                                                               */
/* Function: 集中维护行内公式与预览气泡配色/字体/阴影/过渡                      */
/* Adjustable Params: --im-* 全部                                              */
/* ========================================================================== */
#write {
  /* 行内公式 */
  --im-fg: #2500ed;
  --im-font-size: 1.09em;
  --im-font-family: 'LatinmodernmathRegular';
  --im-line-height: 1.4;
  --im-shadow-a: 0 0.7px 0.8px #fff;
  --im-shadow-b: 0 1.2px 4px #23b3fc19;
  --im-trans-fast: 0.16s;

  /* SVG 渲染 */
  --im-svg-fg: #9916cf;

  /* Hover 高亮 */
  --im-hover-fg: #ff2a2a;
  --im-hover-shadow: 0 1.2px 1.2px #fff, 0 1.6px 6px #ffd70022;

  /* 预览气泡 */
  --im-tip-bg: #f2ffff;
  --im-tip-fg: #003e3e;
  --im-tip-bd: #00b8b8;
  --im-tip-shadow: 0 2px 12px rgba(0, 184, 184, 0.25);
  --im-tip-radius: 0.75em;
  --im-tip-pad: 0.9em 1.2em;
  --im-tip-font: 'Fira Mono', 'JetBrains Mono', monospace;
  --im-tip-font-size: 1em;
  --im-tip-line-height: 1.5;
  --im-tip-blur: 3px;
  --im-trans-mid: 0.25s;

  /* 预览 Hover */
  --im-tip-hover-bg: #fff0f0;
  --im-tip-hover-bd: #ff2a2a;
  --im-tip-hover-shadow: 0 2px 16px rgba(255, 42, 42, 0.25);
}

/* ========================================================================== */
/* REGION B — INLINE CORE（正文 + md-alert 行内公式）                          */
/* Scope: #write .md-inline-math（mjx-container/.MathJax）                     */
/* Function: 行内公式颜色/字号/字体/阴影/过渡                                   */
/* Adjustable Params: --im-fg / --im-font-* / --im-shadow-*                    */
/* ========================================================================== */
#write .md-inline-math mjx-container,
#write .md-inline-math .MathJax,
#write .md-alert .md-inline-math mjx-container,
#write .md-alert .md-inline-math .MathJax {
  display: inline;
  color: var(--im-fg);
  font-size: var(--im-font-size);
  font-family: var(--im-font-family);
  vertical-align: 0em;
  text-shadow: var(--im-shadow-a), var(--im-shadow-b);
  transition: color var(--im-trans-fast);
  max-width: 100%;
  box-sizing: border-box;
  line-height: var(--im-line-height);
}

/* ========================================================================== */
/* REGION C — SVG RENDER（SVG 渲染，排除 tooltip）                             */
/* Scope: #write .md-inline-math svg                                           */
/* Function: 设置 SVG 数学渲染的颜色/尺寸/对齐                                  */
/* Adjustable Params: --im-svg-fg / --im-trans-svg                             */
/* ========================================================================== */
#write .md-inline-math:not(.code-tooltip-content):not(#math-inline-preview-content) svg,
#write .md-alert .md-inline-math svg {
  display: inline-block;
  color: var(--im-svg-fg);
  max-width: 100%;
  height: auto;
  vertical-align: middle;
  box-sizing: border-box;
}

/* ========================================================================== */
/* REGION D — HOVER HIGHLIGHT（悬停高亮）                                      */
/* Scope: mjx-container / .MathJax / svg                                       */
/* Function: 悬停时统一高亮，文字色/填充/阴影                                   */
/* Adjustable Params: --im-hover-*                                             */
/* ========================================================================== */
#write .md-inline-math:hover mjx-container,
#write .md-inline-math:hover .MathJax,
#write .md-inline-math:hover svg,
#write .md-inline-math mjx-container:hover,
#write .md-inline-math .MathJax:hover,
#write .md-inline-math svg:hover,
#write .md-inline-math svg *:hover,
#write .md-alert .md-inline-math:hover mjx-container,
#write .md-alert .md-inline-math:hover .MathJax,
#write .md-alert .md-inline-math:hover svg,
#write .md-alert .md-inline-math svg *:hover {
  color: var(--im-hover-fg);
  fill: var(--im-hover-fg);
  text-shadow: var(--im-hover-shadow);
}

/* ========================================================================== */
/* REGION E — FIX PREVIEW VARIABLES（修复预览气泡变量作用域）                   */
/* Scope: #math-inline-preview-content（脱离 #write）                           */
/* Function: 播种变量，确保气泡也能取到 --im-*                                  */
/* Notes: 保持与 #write 下变量一致                                             */
/* ========================================================================== */
#math-inline-preview-content {
  --im-tip-bg: #f2ffff;
  --im-tip-fg: #003e3e;
  --im-tip-bd: #00b8b8;
  --im-tip-shadow: 0 2px 12px rgba(0,184,184,.25);
  --im-tip-radius: 0.75em;
  --im-tip-pad: 0.9em 1.2em;
  --im-tip-font: 'Fira Mono', 'JetBrains Mono', monospace;
  --im-tip-font-size: 1em;
  --im-tip-line-height: 1.5;
  --im-tip-blur: 3px;
  --im-tip-hover-bg: #fff0f0;
  --im-tip-hover-bd: #ff2a2a;
  --im-tip-hover-shadow: 0 2px 16px rgba(255,42,42,.25);
  --im-trans-mid: 0.25s;
  --im-hover-fg: #ff2a2a;
}

/* ========================================================================== */
/* REGION F— TOOLTIP / PREVIEW（悬浮预览气泡）                                */
/* Scope: .code-tooltip-content / #math-inline-preview-content                 */
/* Function: 气泡的背景/前景/描边/阴影/字体/模糊/过渡                           */
/* Adjustable Params: --im-tip-*                                               */
/* ========================================================================== */
#write .md-inline-math .code-tooltip-content,
#write .md-math-block .code-tooltip-content,
#math-inline-preview-content {
  position: absolute;
  z-index: 4;
  background: var(--im-tip-bg);
  color: var(--im-tip-fg);
  border: 2px solid var(--im-tip-bd);
  box-shadow: var(--im-tip-shadow);
  border-radius: var(--im-tip-radius);
  padding: var(--im-tip-pad);
  font-family: var(--im-tip-font);
  font-size: var(--im-tip-font-size);
  line-height: var(--im-tip-line-height);
  display: flex;
  align-items: center;
  justify-content: center;
  white-space: nowrap;
  max-width: none;
  overflow: visible;
  backdrop-filter: blur(var(--im-tip-blur));
  transition: all var(--im-trans-mid) ease-in-out;
}

/* 悬浮框 Hover */
#write .code-tooltip-content:hover,
#math-inline-preview-content:hover {
  background: var(--im-tip-hover-bg);
  border-color: var(--im-tip-hover-bd);
  box-shadow: var(--im-tip-hover-shadow);
}

/* 悬浮框内部 SVG */
#write .code-tooltip-content svg,
#math-inline-preview-content svg {
  width: auto;
  height: auto;
  vertical-align: middle;
  transition: color 0.2s ease, fill 0.2s ease;
}

/* 悬浮框 SVG hover */
#write .code-tooltip-content:hover svg *,
#math-inline-preview-content:hover svg * {
  color: var(--im-hover-fg);
  fill: var(--im-hover-fg);
}

/* 悬浮框 mjx-container 对齐 */
#write .code-tooltip-content mjx-container,
#math-inline-preview-content mjx-container {
  display: inline-block;
  vertical-align: middle;
  width: auto;
}
/* =============================== END OF PACKAGE ============================ */

/* =======================================================================================
   Rhapsody · Display Math Blocks（行间公式 · 正文/告警一体）
   设计理念 / Design Concept
   - 与正文与 md-alert 视觉统一：居中排版、合适留白与比例放大，MathJax/SVG 共用变量。
   - 悬停仅做轻量强调：柔和流动底色 + 霓虹描边 + 文字符号高亮，不喧宾夺主。
   - 全量变量化（--dm-*）：块容器、Hover、编辑区 Rawblock、预览、装饰卡片分层可控；不改 DOM。
   - 稳定与可访问：动画可降级、过渡时长受控，避免编辑态跳动与输入干扰。
   ======================================================================================= */

/* —— Region Root Vars —— */
#write{
  /* A 区：块容器与 SVG 基本 */
  --dm-block-margin-top: 2.2rem;
  --dm-block-margin-bottom: 2rem;
  --dm-block-pad-y: 0.4rem;
  --dm-block-pad-x: 0.2rem;
  --dm-block-z: 3;

  --dm-svg-size: 1.4em;                /* 行间公式整体放大比例 */
  --dm-font-math: 'LatinmodernmathRegular';
  --dm-svg-fg: #ed008e;                 /* 行间公式主色 */
  --dm-shadow-a: 0 0.7px 0.8px #fff;
  --dm-shadow-b: 0 1.2px 4px #23b3fc19;
  --dm-svg-trans-dur: 0.2s;
  --dm-svg-trans-ease: ease;

  /* B 区：Hover 动效（背景/描边/阴影/字体高亮） */
  --dm-hover-grad: linear-gradient(
    135deg,
    rgba(180, 255, 220, 0.12),
    rgba(100, 255, 180, 0.18),
    rgba(180, 255, 220, 0.12)
  );
  --dm-hover-bg-size: 200% 200%;
  --dm-hover-anim-dur: 8s;
  --dm-hover-anim-ease: ease-in-out;
  --dm-hover-bd: rgba(120, 255, 200, 0.28);
  --dm-hover-radius: 1.2em;
  --dm-hover-shadow: 0 0 8px rgba(100, 255, 200, 0.12),
                     0 0 18px rgba(100, 255, 200, 0.10),
                     inset 0 0 12px rgba(60, 255, 180, 0.08);
  --dm-hover-blur: 6px;
  --dm-hover-brightness: 1.03;
  --dm-hover-trans: 0.3s;
  --dm-hover-z: 5;

  --dm-hover-svg-fg: #2100fa;
  --dm-hover-svg-shadow: 0 1.2px 1.2px #fff,
                         0 1.6px 6px #ffd70022,
                         0 0 4px #f2080d88;
  --dm-hover-svg-trans-dur: 0.25s;
  --dm-hover-svg-trans-ease: ease;

  /* C 区：Rawblock 编辑区（古典棕） */
  --dm-raw-bg: rgba(210, 180, 140, 0.3);
  --dm-raw-trans: 0.25s;
  --dm-raw-hover-bg: rgba(160, 130, 100, 0.3);
  --dm-raw-hover-bd: rgba(218, 165, 32, 0.5);
  --dm-raw-hover-shadow: 0 0 6px rgba(160, 82, 45, 0.4),
                         0 0 12px rgba(255, 215, 0, 0.08);

  --dm-raw-aux-fg: #5b3a29;             /* before/after 文字色 */
  --dm-raw-aux-font: 'Georgia', serif;

  --dm-raw-cm-color: #2d1e12;
  --dm-raw-cm-font: 'Fira Code', monospace;

  --dm-raw-select-bg: rgba(139, 69, 19, 0.3);
  --dm-rawblock-bg: rgba(250, 235, 215, 0.15);
  --dm-rawblock-radius: 0.8em;

  /* D 区：预览黑红反转 */
  --dm-prev-bg: #1c1c1c;
  --dm-prev-fg: #e53935;
  --dm-prev-margin-y: 0.4em;
  --dm-prev-radius: 0.6em;
  --dm-prev-z: 3;
  --dm-prev-trans: 0.35s ease;

  --dm-prev-hover-bg: #e53935;
  --dm-prev-hover-shadow: 0 2px 12px rgba(229, 57, 53, 0.35),
                          0 0 4px rgba(255, 255, 255, 0.2),
                          inset 0 0 6px rgba(0, 0, 0, 0.1);
  --dm-prev-invert-fg: #1c1c1c;

  /* E 区：装饰卡片 */
  --dm-card-bg: rgba(255,255,255,0.15);
  --dm-card-bd-color: rgba(255,255,255,0.3);
  --dm-card-bd-width: 1.5px;
  --dm-card-radius: 1.2em;
  --dm-card-pad-y: 1.2em;
  --dm-card-pad-x: 1.8em;
  --dm-card-blur: 4px;
  --dm-card-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
}

/* ======================================================================================= */
/* REGION A — DISPLAY MATH BLOCKS（行间公式块 · 正文 + md-alert 通用）                     */
/* Scope: #write 内所有 mjx-container[display="true"]（包含 md-alert）                      */
/* 功能 / Function: 居中排版的行间公式，统一字体/颜色/阴影；Hover 时启用动态效果             */
/* 可调参数 / Adjustable Params: margin, color, font-family, text-shadow, hover effects     */
/* ======================================================================================= */

/* 外层容器：居中展示、上下留白 */
#write mjx-container.MathJax[display="true"] {
  display: block;
  text-align: center;
  margin: var(--dm-block-margin-top) auto var(--dm-block-margin-bottom) auto;
  padding: var(--dm-block-pad-y) var(--dm-block-pad-x);
  position: relative;
  z-index: var(--dm-block-z);
}

/* SVG 区域：自适应缩放、统一配色 */
#write mjx-container.MathJax[display="true"] svg {
  font-size: var(--dm-svg-size); /* ⬅️ 调整这里，整体放大行间公式 */
  display: inline-block;
  max-width: 100%;
  height: auto;
  vertical-align: middle;
  font-family: var(--dm-font-math);
  color: var(--dm-svg-fg);
  fill: none; /* ← 原地修改：默认不填充，避免 \boxed 的 <rect> 变实心 */
  box-sizing: border-box;
  transition: color var(--dm-svg-trans-dur) var(--dm-svg-trans-ease),
              fill  var(--dm-svg-trans-dur) var(--dm-svg-trans-ease);
  text-shadow: var(--dm-shadow-a), var(--dm-shadow-b);
}
/* 仅给字形路径上色；几何图形保持透明填充 */
#write mjx-container.MathJax[display="true"] svg path { 
  fill: currentColor;
}
#write mjx-container.MathJax[display="true"] svg rect,
#write mjx-container.MathJax[display="true"] svg line,
#write mjx-container.MathJax[display="true"] svg polyline,
#write mjx-container.MathJax[display="true"] svg polygon,
#write mjx-container.MathJax[display="true"] svg circle,
#write mjx-container.MathJax[display="true"] svg ellipse { 
  fill: none !important;
}
/* 让带 stroke 的元素（如 \boxed 的 <rect>）使用当前文字色描边 */
#write mjx-container.MathJax[display="true"] svg [stroke] {
  stroke: currentColor;
}


/* ======================================================================================= */
/* REGION B — DISPLAY MATH HOVER（行间公式 Hover 动效）                                    */
/* Scope: #write mjx-container[display="true"]:hover                                        */
/* 功能 / Function: 鼠标悬停时加底色流动背景、柔光边框、字体高亮                             */
/* ======================================================================================= */

/* 🚫 移除 Typora 默认 hover 蓝背景（编辑态） */
#write .md-rawblock:hover,
#write .md-rawblock:hover > .md-rawblock-container {
  background: transparent !important;
}

/* Hover 主容器：柔和流动绿光背景 */
#write mjx-container.MathJax[display="true"]:hover {
  background: var(--dm-hover-grad);
  background-size: var(--dm-hover-bg-size);
  animation: formula-hover-flow var(--dm-hover-anim-dur) var(--dm-hover-anim-ease) infinite;

  border: 1.5px solid var(--dm-hover-bd);
  border-radius: var(--dm-hover-radius);

  box-shadow: var(--dm-hover-shadow);

  backdrop-filter: blur(var(--dm-hover-blur)) brightness(var(--dm-hover-brightness));
  transition: all var(--dm-hover-trans) ease-in-out;
  z-index: var(--dm-hover-z);
}

/* Hover 时字体高亮 */
#write mjx-container.MathJax[display="true"]:hover svg {
  color: var(--dm-hover-svg-fg);
  /* ← 原地修改：移除 fill: currentColor; 仅提升文字色与阴影 */
  text-shadow: var(--dm-hover-svg-shadow);
  transition: color var(--dm-hover-svg-trans-dur) var(--dm-hover-svg-trans-ease),
              text-shadow var(--dm-hover-svg-trans-dur) var(--dm-hover-svg-trans-ease);
}

/* 路径颜色保持一致 */
#write mjx-container.MathJax[display="true"]:hover svg path {
  fill: var(--dm-hover-svg-fg);
}
#write mjx-container.MathJax[display="true"]:hover svg [stroke] {
  stroke: var(--dm-hover-svg-fg);
}

/* 动态背景动画（流动感） */
@keyframes formula-hover-flow {
  0%   { background-position: 0% 50%; }
  50%  { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}


/* ======================================================================================= */
/* REGION C — DISPLAY MATH RAWBLOCK（编辑区 · 古典棕色主题）                               */
/* Scope: #write .md-rawblock-control（公式编辑区）                                         */
/* 功能 / Function: 行间公式编辑区域的 CodeMirror 外壳与 hover 样式                          */
/* ======================================================================================= */

#write .md-rawblock-control {
  background: var(--dm-raw-bg);
  z-index: var(--dm-block-z);
  transition: all var(--dm-raw-trans) ease;
}

#write .md-rawblock-control:hover {
  background: var(--dm-raw-hover-bg);
  border-color: var(--dm-raw-hover-bd);
  box-shadow: var(--dm-raw-hover-shadow);
}

#write .md-rawblock-control .ty-input-before,
#write .md-rawblock-control .ty-input-after {
  background: transparent;
  color: var(--dm-raw-aux-fg);
  border: none;
  font-family: var(--dm-raw-aux-font);
  font-weight: bold;
}

#write .md-rawblock-control .CodeMirror {
  background: transparent;
  color: var(--dm-raw-cm-color);
  font-family: var(--dm-raw-cm-font);
}

#write .md-rawblock-control .cm-s-typora span.CodeMirror-selectedtext {
  background-color: var(--dm-raw-select-bg);
}

#write .md-rawblock {
  background: var(--dm-rawblock-bg);
  border-radius: var(--dm-rawblock-radius);
}


/* ======================================================================================= */
/* REGION D — DISPLAY MATH PREVIEW（黑红反转预览风格）                                     */
/* Scope: #write .md-mathjax-preview                                                       */
/* 功能 / Function: 编辑态预览的反转黑红风格，hover 时切换前景/背景                         */
/* ======================================================================================= */

#write .md-mathjax-preview {
  background: var(--dm-prev-bg);
  color: var(--dm-prev-fg);
  display: block;
  margin: var(--dm-prev-margin-y) 0;
  border-radius: var(--dm-prev-radius);
  position: relative;
  z-index: var(--dm-prev-z);
  cursor: pointer;
  transition: all var(--dm-prev-trans);
  box-sizing: border-box;
}

/* 原地替换：只给字形填充色，描边同色；不再对 * 统一填充 */
#write .md-mathjax-preview mjx-container svg path {
  fill: var(--dm-prev-fg);
}
#write .md-mathjax-preview mjx-container svg [stroke] {
  stroke: var(--dm-prev-fg);
}

#write .md-mathjax-preview:hover {
  background: var(--dm-prev-hover-bg);
  box-shadow: var(--dm-prev-hover-shadow);
}
#write .md-mathjax-preview:hover mjx-container svg path {
  fill: var(--dm-prev-invert-fg);
}
#write .md-mathjax-preview:hover mjx-container svg [stroke] {
  stroke: var(--dm-prev-invert-fg);
}


/* ======================================================================================= */
/* REGION E — DISPLAY MATH DECORATIVE CARD（背景卡片装饰）                                 */
/* Scope: #write .md-rawblock-control mjx-container                                         */
/* 功能 / Function: 为编辑区公式块添加毛玻璃+描边的卡片装饰                                 */
/* ======================================================================================= */

#write .md-rawblock-control mjx-container.MathJax[display="true"] {
  background: var(--dm-card-bg);
  border: var(--dm-card-bd-width) solid var(--dm-card-bd-color);
  border-radius: var(--dm-card-radius);
  padding: var(--dm-card-pad-y) var(--dm-card-pad-x);
  backdrop-filter: blur(var(--dm-card-blur));
  box-shadow: var(--dm-card-shadow);
}
/* =============================== END OF PACKAGE ============================ */

/* =======================================================================================
   Rhapsody · Task Lists & Checkboxes（任务列表与复选框 · 牛仔皮革 + 黄铜）
   设计理念 / Design Concept
   - 材质叙事：皮革底 + 斜向织纹 + 沙尘颗粒 + 顶部日晒褪色 + 内暗角；黄铜细节（缝线/铆钉/描边）。
   - 限域与兼容：仅 #write 内的任务列表与任务项；极小范围 :has 作为兜底，并用 @supports 守卫。
   - 轻交互：常态静止，Hover/Active 才有轻微反馈；尊重 prefers-reduced-motion。
   - 变量集中：A 区统一维护 --tk-* 变量，B/C/D 区只消费变量，便于主题横向换肤与调参。
   - 不改 DOM：完全遵循 Typora 限制，仅用选择器与伪元素实现装饰与交互。
   ======================================================================================= */


/* =======================================================================================
   REGION A — ROOT VARS（包内变量，仅 #write 生效）
   Scope: #write
   Function: 统一管理本包所有尺寸/配色/材质/阴影/交互参数
   ======================================================================================= */
#write{
  /* 复选框 */
  --tk-size: 0.95rem;
  --tk-radius: 0.22rem;
  --tk-brass: #c08a53;
  --tk-brass-hover: #d9a063;
  --tk-brass-checked: #8d6236;
  --tk-bg-leather: linear-gradient(135deg, #6b3e2e, #533026);
  --tk-bg-leather-checked: linear-gradient(135deg, #7a4a37, #5b362a);

  /* 面板（任务列表容器） */
  --tk-panel-radius: 10px;

  /* —— 背景层配方（从上到下：暗角 → 日晒 → 沙尘 → 织纹 → 皮革底） —— */
  --tk-panel-base: linear-gradient(180deg, rgba(55,40,28,.24), rgba(40,34,28,.18));
  --tk-panel-weave:
    repeating-linear-gradient(45deg,
      rgba(255,240,220,.045) 0 2px,
      rgba(0,0,0,.05)        2px 3.5px);
  --tk-panel-dust:
    radial-gradient(circle at 20% 30%, rgba(255,231,170,.06) 0 12%, #0000 13%),
    radial-gradient(circle at 70% 65%, rgba(255,231,170,.05) 0 10%, #0000 12%),
    radial-gradient(circle at 35% 80%, rgba(255,231,170,.04) 0 8%,  #0000 10%);
  --tk-panel-sun: linear-gradient(180deg, rgba(255,235,185,.10), rgba(255,235,185,0) 40%);
  --tk-panel-vignette: radial-gradient(120% 140% at 50% 0%, #0000 40%, rgba(0,0,0,.18) 95%);

  --tk-panel-stroke: 1px solid rgba(0,0,0,.15);
  --tk-panel-shadow: 0 8px 20px rgba(0,0,0,.18);
  --tk-item-gap: .35rem;
  --tk-inner-pad: .6rem .8rem .6rem .6rem;

  /* 牛仔工艺细节 */
  --tk-stitch-color: rgba(255,235,205,.6);   /* 奶油色缝线 */
  --tk-stitch-gap: 8px;                       /* 针脚间距 */
  --tk-rivet: radial-gradient(circle at 35% 35%, #f7e2b5 0 35%, #b07a3b 36% 60%, #3d2a1e 61% 100%);
  --tk-rivet-size: 8px;                       /* 角铆钉尺寸 */

  /* 文本与状态 */
  --tk-text-checked: rgb(255 159 0);          /* 完成项文字色（深背景上） */
  --tk-text-muted: rgba(255,255,255,.55);     /* 次级说明 */
  --tk-strike-color: rgba(255,255,255,.35);   /* 划线颜色 */
  --tk-focus-ring: 0 0 0 3px rgba(192,138,83,.35); /* 键盘焦点环（黄铜色） */
}


/* =======================================================================================
   REGION B — PANELS（容器面板、缝线、铆钉、嵌套轻配方）
   Scope: #write :is(ul.task-list, ol.task-list) 及兼容兜底
   Function:
     - 清空列表视觉，替换为牛仔皮革面板（多层背景）
     - 顶/底缝线与角铆钉装饰；嵌套列表使用更轻配方
     - :has 兜底逻辑加 @supports 守卫，旧内核回退为仅 .task-list 容器路径
   ======================================================================================= */

/* 基础：仅 .task-list 容器（兼容无 :has 的内核） */
#write :is(ul.task-list, ol.task-list){
  list-style: none;
  background: none;
  border: 0;
  box-shadow: none;
  padding-left: 0;
  margin: 1rem 0;

  /* 皮革面板（多层背景） */
  position: relative;
  background:
    var(--tk-panel-vignette),
    var(--tk-panel-sun),
    var(--tk-panel-dust),
    var(--tk-panel-weave),
    var(--tk-panel-base);
  background-repeat: no-repeat, no-repeat, no-repeat, repeat, no-repeat;
  background-size: 100% 100%, 100% 28px, 100% 100%, 22px 22px, 100% 100%;
  background-position: center, top left, center, center, center;

  border: var(--tk-panel-stroke);
  border-radius: var(--tk-panel-radius);
  box-shadow: var(--tk-panel-shadow);
  padding: var(--tk-inner-pad);
}

/* 兜底：容器无 .task-list，但直接子项是任务项 —— 用 supports 守卫 */
@supports selector(:has(*)) {
  #write :is(ul, ol):not(.task-list):has(> li.md-task-list-item){
    list-style: none;
    position: relative;
    background:
      var(--tk-panel-vignette),
      var(--tk-panel-sun),
      var(--tk-panel-dust),
      var(--tk-panel-weave),
      var(--tk-panel-base);
    background-repeat: no-repeat, no-repeat, no-repeat, repeat, no-repeat;
    background-size: 100% 100%, 100% 28px, 100% 100%, 22px 22px, 100% 100%;
    background-position: center, top left, center, center, center;

    border: var(--tk-panel-stroke);
    border-radius: var(--tk-panel-radius);
    box-shadow: var(--tk-panel-shadow);
    padding: var(--tk-inner-pad);
    margin: 1rem 0;
  }
}

/* 面板缝线：为伪元素定位预留可见溢出范围（基础路径） */
#write :is(ul.task-list, ol.task-list){
  overflow: visible; /* 为伪元素定位 */
}

/* 兜底路径仅在支持 :has 的内核里启用（不要与上面用逗号合并） */
@supports selector(:has(*)) {
  #write :is(ul, ol):not(.task-list):has(> li.md-task-list-item){
    overflow: visible; /* 为伪元素定位 */
  }
}

#write :is(ul.task-list, ol.task-list)::before{
  content: "";
  position: absolute;
  inset: 6px 10px auto 10px;               /* 顶部内侧缝线 */
  height: 0;
  border-top: 2px dashed var(--tk-stitch-color);
  mask: linear-gradient(90deg,#0000 0 6px,#000 6px calc(6px + var(--tk-stitch-gap)));
}
#write :is(ul.task-list, ol.task-list)::after{
  content: "";
  position: absolute;
  inset: auto 10px 6px 10px;               /* 底部内侧缝线 */
  height: 0;
  border-bottom: 2px dashed var(--tk-stitch-color);
  mask: linear-gradient(90deg,#0000 0 6px,#000 6px calc(6px + var(--tk-stitch-gap)));
}
@supports selector(:has(*)) {
  #write :is(ul, ol):not(.task-list):has(> li.md-task-list-item)::before{
    content: "";
    position: absolute;
    inset: 6px 10px auto 10px;
    height: 0;
    border-top: 2px dashed var(--tk-stitch-color);
    mask: linear-gradient(90deg,#0000 0 6px,#000 6px calc(6px + var(--tk-stitch-gap)));
  }
  #write :is(ul, ol):not(.task-list):has(> li.md-task-list-item)::after{
    content: "";
    position: absolute;
    inset: auto 10px 6px 10px;
    height: 0;
    border-bottom: 2px dashed var(--tk-stitch-color);
    mask: linear-gradient(90deg,#0000 0 6px,#000 6px calc(6px + var(--tk-stitch-gap)));
  }
}

/* 角铆钉（四角小圆钉） */
#write :is(ul.task-list, ol.task-list) > li:first-child::before,
#write :is(ul.task-list, ol.task-list) > li:first-child::after{
  content: "";
  position: absolute;
  width: var(--tk-rivet-size);
  height: var(--tk-rivet-size);
  background: var(--tk-rivet);
  border-radius: 50%;
  top: 6px;
}
#write :is(ul.task-list, ol.task-list) > li:first-child::before{ left: 8px; }
#write :is(ul.task-list, ol.task-list) > li:first-child::after{ right: 8px; }
@supports selector(:has(*)) {
  #write :is(ul, ol):not(.task-list):has(> li.md-task-list-item) > li:first-child::before,
  #write :is(ul, ol):not(.task-list):has(> li.md-task-list-item) > li:first-child::after{
    content: "";
    position: absolute;
    width: var(--tk-rivet-size);
    height: var(--tk-rivet-size);
    background: var(--tk-rivet);
    border-radius: 50%;
    top: 6px;
  }
  #write :is(ul, ol):not(.task-list):has(> li.md-task-list-item) > li:first-child::before{ left: 8px; }
  #write :is(ul, ol):not(.task-list):has(> li.md-task-list-item) > li:first-child::after{ right: 8px; }
}

/* 嵌套任务列表容器：层级更轻、缝线缩短 + 更浅配方 */
#write :is(ul.task-list, ol.task-list) :is(ul.task-list, ol.task-list){
  margin: .5rem 0 .2rem .9rem;
  padding: .45rem .6rem .45rem .55rem;
  background:
    radial-gradient(120% 140% at 50% 0%, #0000 50%, rgba(0,0,0,.12) 98%),
    linear-gradient(180deg, rgba(255,235,185,.06), rgba(255,235,185,0) 40%),
    linear-gradient(180deg, rgba(92,64,51,.12), rgba(40,32,25,.08)),
    repeating-linear-gradient(45deg, rgba(255,240,220,.035) 0 2px, rgba(0,0,0,.04) 2px 3.5px);
  background-repeat: no-repeat, no-repeat, no-repeat, repeat;
  background-size: 100% 100%, 100% 24px, 100% 100%, 18px 18px;
  border: var(--tk-panel-stroke);
  border-radius: calc(var(--tk-panel-radius) - 2px);
  box-shadow: 0 4px 12px rgba(0,0,0,.12);
}
#write :is(ul.task-list, ol.task-list) :is(ul.task-list, ol.task-list)::before,
#write :is(ul.task-list, ol.task-list) :is(ul.task-list, ol.task-list)::after{
  inset-inline: 14px; /* 缝线左右收紧 */
}


/* =======================================================================================
   REGION C — ITEMS & CHECKBOXES（任务项与复选框四态）
   Scope: #write .md-task-list-item 及其直系 input
   Function: 行模型/间距、清空 marker、复选框未选/悬停/按下/选中、完成项文本处理
   ======================================================================================= */

#write .md-task-list-item{
  display: flex;
  align-items: flex-start;
  gap: .5rem;
  list-style: none;
  background: transparent;
  border: 0;
  box-shadow: none;
  margin: 0;
  padding: .15rem .1rem;
}

/* 任务项之间的间距 */
#write .md-task-list-item + .md-task-list-item{ margin-top: var(--tk-item-gap); }

/* 清空任务项的 ::before 与 ::marker（避免与全局列表装饰冲突） */
#write .md-task-list-item::before{ content: ""; display: none; }
#write .md-task-list-item::marker{ content: ""; }

/* 复选框（直系 input） */
#write .md-task-list-item > input{
  margin-top: .16rem;
  margin-right: .1rem;
  cursor: pointer;
}

/* 键盘导航可访问态（focus-visible） */
#write .md-task-list-item > input:focus-visible{
  outline: none;
  box-shadow: var(--tk-focus-ring);
  border-radius: calc(var(--tk-radius) + 2px);
}

/* 未选中：皮革底 + 黄铜描边 */
#write .md-task-list-item > input:before{
  content: "";
  display: inline-block;
  width: var(--tk-size);
  height: var(--tk-size);
  vertical-align: middle;
  text-align: center;
  margin-top: -0.4rem;
  border-radius: var(--tk-radius);
  border: 1.5px solid var(--tk-brass);
  background:
    linear-gradient(145deg, rgba(255,255,255,0.12), rgba(0,0,0,0.12)),
    var(--tk-bg-leather);
  box-shadow:
    inset 0 1px 2px rgba(0,0,0,0.25),
    inset 0 -1px 1px rgba(255,255,255,0.07),
    0 0 0 1px rgba(0,0,0,0.05),
    0 1px 2px rgba(0,0,0,0.12);
  transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
}

/* 悬停：提亮黄铜并轻微上浮 */
#write .md-task-list-item > input:hover:before{
  border-color: var(--tk-brass-hover);
  box-shadow:
    inset 0 1px 2px rgba(0,0,0,0.25),
    0 0 4px rgba(217,160,99,0.4),
    0 2px 6px rgba(0,0,0,0.18);
  transform: translateY(-1px);
}

/* 按下：内凹压感 */
#write .md-task-list-item > input:active:before{
  transform: translateY(0);
  box-shadow:
    inset 0 2px 3px rgba(0,0,0,0.3),
    0 0 0 1px rgba(192,138,83,0.25);
}

/* 选中：深黄铜边 + 对勾；磨旧皮革背景 */
#write .md-task-list-item > input:checked:before,
#write .md-task-list-item > input[checked]:before{
  content: "✓";
  font-size: 0.65rem;
  line-height: var(--tk-size);
  color: #fff;
  background:
    linear-gradient(145deg, rgba(255,255,255,0.16), rgba(0,0,0,0.08)),
    var(--tk-bg-leather-checked);
  border-color: var(--tk-brass-checked);
  box-shadow:
    inset 0 1px 2px rgba(0,0,0,0.28),
    0 0 0 1px rgba(141,98,54,0.35),
    0 1px 3px rgba(0,0,0,0.15);
}

/* 文本：选中后轻度划线 + 褪色；未选中保持正文对比 */
#write .md-task-list-item > input:checked + *{
  color: var(--tk-text-checked);
  text-decoration: line-through;
  text-decoration-color: var(--tk-strike-color);
  text-decoration-thickness: .09em;
  text-underline-offset: .15em;
}

/* 次级描述（例如括号说明）的弱化，可按需注释掉 */
#write .md-task-list-item > input + * em,
#write .md-task-list-item > input + * small{
  color: var(--tk-text-muted);
}


/* =======================================================================================
   REGION D — ACCESSIBILITY & MOTION（可访问性与动效降级）
   Scope: focus/disabled/readonly，及 prefers-reduced-motion
   Function: 焦点环、禁用态、动效降级
   ======================================================================================= */

#write .md-task-list-item > input[disabled],
#write .md-task-list-item > input[readonly]{
  cursor: not-allowed;
  opacity: .7;
}
#write .md-task-list-item > input[disabled]:before,
#write .md-task-list-item > input[readonly]:before{
  filter: grayscale(.2) brightness(.95);
  border-color: #a07a50;
}

/* 降级：尊重减少动态偏好 */
@media (prefers-reduced-motion: reduce){
  #write .md-task-list-item > input:before{ transition: none; transform: none; }
  #write .md-task-list-item > input:hover:before{ transform: none; }
}

/* =================================== END OF PACKAGE =================================== */

/* =======================================================================================
   Rhapsody · TOC Package（目录区整体样式 · 大海/航行/远方）
   设计理念 / Design Concept
   - 主题：以「大海/航行/远方」为叙事母题，目录区采用深海背景 + 轻玻璃质感卡片。
   - 可读性优先：所有文字在背景图之上使用前景配色 + 细文本阴影，保证对比度。
   - 轻交互：常态静止，仅在 Hover/Focus 时提供“波光与远方金光”反馈；尊重减少动态设置。
   - 严格限域：作用域仅限 #write 内部的 .md-toc-* 节点，不影响侧栏/正文其他区域。
   - 性能友好：不使用 :has 与复杂关系选择器；仅必要过渡；避免昂贵的滤镜叠加。
   - 不改 HTML：完全遵循 Typora 编辑器限制，仅通过选择器与伪元素实现装饰。
   - 变量维护：本包所有可调参数集中在 REGION A（包内变量），方便统一调色与风格切换。
   Adjustable Params（集中入口，详见 REGION A）：
   - 背景与卡片：--toc-bg-img / --toc-fg / --toc-text-shadow / --toc-shadow / --toc-radius
   - 标题条：--toc-title-* / --toc-chip-* / --toc-btn-*
   - 列表项：--toc-item-* / --toc-item-hover-* / --toc-emoji-h*
   Compatibility：现代浏览器 / Typora(Electron)；无 :has 依赖，旧内核回退为静态风格。
   ======================================================================================= */


/* =======================================================================================
   REGION A — ROOT VARS（变量集中维护 · 仅本包使用 / Package-local）
   Scope: #write（仅正文写作区域生效，避免跨区污染）
   Function:
   - 统一管理 TOC 包的主题色、间距、阴影、交互与工具条参数；
   - 所有后续 REGION 仅消费这些变量，不直接写死数值，便于主题级切换。
   Maintenance:
   - 若需做“海面 → 星空 / 山林”等主题切换，仅替换 --toc-bg-img 与若干前景变量即可。
   ======================================================================================= */
#write{
  /* 容器与主题 */
  --toc-pad: 1.2rem 1rem;
  --toc-radius: 14px;
  --toc-z: 6;
  --toc-bg-img: url("file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Assets/TOC/%E6%89%AC%E5%B8%86%E8%B5%B7%E8%88%AA.png");
  --toc-fg: #fff;
  --toc-text-shadow: 0 1px 3px rgba(0,0,0,.65);
  --toc-shadow: 0 6px 20px rgba(0,0,0,.25);

  /* 标题（::before） */
  --toc-title-fs: 1.9rem;
  --toc-title-lh: 1.6;
  --toc-title-border: 1px solid rgba(255,255,255,.45);
  --toc-title-mb: .5rem;

  /* 目录项 */
  --toc-item-gap: .4rem;
  --toc-item-pad: 0.45rem 0.8rem;
  --toc-item-radius: 8px;
  --toc-item-ff: 'GuDuYanHei','AliPuHuiTi',sans-serif;
  --toc-item-fw: 500;
  --toc-item-fg: #f0f8ff;
  --toc-item-bg: rgba(7,47,72,.38);
  --toc-trans: all .25s ease;

  /* 悬停态（目录项） */
  --toc-item-hover-fg: #fffbe8;
  --toc-item-hover-bg: rgba(14,95,136,.55);
  --toc-item-hover-shadow: 0 0 12px rgba(255,212,122,.55);
  --toc-item-hover-translate: translateY(-1px);

  /* Emoji 层级色（可按需统一调整） */
  --toc-emoji-h2: #bfe6ff;
  --toc-emoji-h3: #aee8ff;
  --toc-emoji-h4: #ffd36e;
  --toc-emoji-h5: #cfe3ff;
  --toc-emoji-h6: #f2e6c8;

  /* 工具条（标题分隔线与按钮） */
  --toc-toolbar-inset-x: 12px;
  --toc-toolbar-pad-y: 2px;
  --toc-toolbar-fg: #ffffff;
  --toc-toolbar-text-shadow: 0 1px 2px rgba(0,0,0,.42);
  --toc-divider-alpha: .55;

  /* 工具条：标题胶囊 */
  --toc-chip-bg: rgba(7,47,72,.64);
  --toc-chip-bd: 1px solid rgba(255,255,255,.28);
  --toc-chip-shadow: 0 2px 8px rgba(0,0,0,.25);
  --toc-chip-fs: .92rem;

  /* 工具条：删除按钮 */
  --toc-btn-bg: rgba(255,255,255,.08);
  --toc-btn-bd: 1px solid rgba(255,255,255,.25);
  --toc-btn-fg: #fbb500;
  --toc-btn-bg-hover: linear-gradient(180deg, rgba(255,212,122,.22), rgba(255,255,255,.10));
  --toc-btn-ring-hover: 0 0 0 1px rgba(255,212,122,.35), 0 6px 14px rgba(0,0,0,.25);
  --toc-btn-fg-hover: #fffdf2;
}

/* ======================================================================================= 
   REGION B — OCEAN BACKGROUND（目录背景 · 大海/航行/远方）
   Scope: 仅 #write 内部的 .md-toc-content（不影响侧栏/正文其它区域）
   Function:
   - 整体背景图为海面航行主题（--toc-bg-img）
   - 目录项前景保持清晰可读（--toc-fg + --toc-text-shadow）
   - Hover 提供波光/远方高亮效果（--toc-item-hover-*）
   Adjustable Params: --toc-bg-img / --toc-fg / --toc-text-shadow / --toc-shadow / --toc-radius
   ======================================================================================= */

#write .md-toc-content {
  position: relative;
  padding: var(--toc-pad);
  border-radius: var(--toc-radius);
  overflow: hidden;
  z-index: var(--toc-z);

  /* 背景图 */
  background: var(--toc-bg-img) center/cover no-repeat;

  /* 前景可读性 */
  color: var(--toc-fg);
  text-shadow: var(--toc-text-shadow);
  box-shadow: var(--toc-shadow);
}

/* 目录项：卡片感 */
#write .md-toc-content .md-toc-item {
  display: block;
  margin: var(--toc-item-gap) 0;
}

#write .md-toc-content .md-toc-inner {
  display: block;
  padding: var(--toc-item-pad);
  border-radius: var(--toc-item-radius);
  font-family: var(--toc-item-ff); /* 引用 prerequisite.css 中的字体 */
  font-weight: var(--toc-item-fw);
  color: var(--toc-item-fg);
  background: var(--toc-item-bg); /* 半透明深海蓝衬底 */
  transition: var(--toc-trans);
}

/* Hover / Focus：波光 + 远方金光 */
#write .md-toc-content .md-toc-inner:hover,
#write .md-toc-content .md-toc-inner:focus-visible {
  color: var(--toc-item-hover-fg);
  background: var(--toc-item-hover-bg);
  box-shadow: var(--toc-item-hover-shadow);
  transform: var(--toc-item-hover-translate);
}

/* H1 船只象征 */
#write .md-toc-content .md-toc-h1 > .md-toc-inner::before {
  content: "⛵ ";
  margin-right: 0.3em;
}

/* H2 波浪象征 */
#write .md-toc-content .md-toc-h2 > .md-toc-inner::before {
  content: "≈ ";
  margin-right: 0.3em;
  color: var(--toc-emoji-h2);
}

/* H3 海浪 */
#write .md-toc-content .md-toc-h3 > .md-toc-inner::before {
  content: "🌊 ";
  margin-right: 0.3em;
  color: var(--toc-emoji-h3);
}
/* H4 罗盘 */
#write .md-toc-content .md-toc-h4 > .md-toc-inner::before {
  content: "🧭 ";
  margin-right: 0.3em;
  color: var(--toc-emoji-h4);
}
/* H5 锚 */
#write .md-toc-content .md-toc-h5 > .md-toc-inner::before {
  content: "⚓ ";
  margin-right: 0.3em;
  color: var(--toc-emoji-h5);
}
/* H6 远方地图 */
#write .md-toc-content .md-toc-h6 > .md-toc-inner::before {
  content: "🗺️ ";
  margin-right: 0.3em;
  color: var(--toc-emoji-h6);
}

/* 减少动态偏好：只保留静态高亮 */
@media (prefers-reduced-motion: reduce) {
  #write .md-toc-content .md-toc-inner {
    transition: none;
  }
}

/* =======================================================================================
   REGION C-TOOLBAR — TITLE BAR（目录工具条 · 标题分隔线）
   Scope: 仅 #write 内部的 .md-toc-tooltip（不影响其它 tooltip）
   Function:
   - 在 TOC 顶部绘制一条横向分隔线（--toc-divider-alpha）；居中放置文字（沿用 HTML <span>）
   - 右侧保留删除按钮；工具条整体透明玻璃感（--toc-chip-* / --toc-btn-*）
   - 不改 DOM；当 Typora 显示该节点时样式自动生效
   ======================================================================================= */

#write .md-toc-tooltip{
  position: absolute;
  /* 固定在 TOC 卡片内的顶部；左右各留 --toc-toolbar-inset-x */
  top: 0;
  left: var(--toc-toolbar-inset-x);
  right: var(--toc-toolbar-inset-x);
  z-index: 3;

  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;

  padding: var(--toc-toolbar-pad-y) 0;
  background: transparent;
  border: none;
  pointer-events: none;            /* 仅按钮可点，其他透穿 */
  font-family: 'AliPuHuiTi','GuDuYanHei',sans-serif;
  color: var(--toc-toolbar-fg);
  text-shadow: var(--toc-toolbar-text-shadow);
}

/* 横向分隔线：用伪元素画一条从左到右的渐变线 */
#write .md-toc-tooltip::before{
  content:"";
  position: absolute; left: 0; right: 0; top: 50%;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,var(--toc-divider-alpha)), transparent);
  transform: translateY(-50%);
  pointer-events: none;
}

/* 中间标题胶囊：使用原 <span> 文本（如“Table of Contents”/“目录”） */
#write .md-toc-tooltip > span{
  position: relative;
  margin-left: 0.2rem;
  padding: 0.1rem 0.6rem;
  border-radius: 6px;
  background: var(--toc-chip-bg);     /* 深海蓝玻璃片 */
  border: var(--toc-chip-bd);
  box-shadow: var(--toc-chip-shadow);
  font-weight: 600;
  font-size: var(--toc-chip-fs);
  letter-spacing: .02em;
  line-height: 1.2;
  pointer-events: auto;               /* 允许选中文本 */
}

/* 删除按钮：右侧小圆角按钮（只给按钮开启交互） */
#write .md-toc-tooltip .btn.md-delete-toc{
  pointer-events: auto;
  display: inline-flex; align-items: center; justify-content: center;
  min-width: 26px; min-height: 26px; padding: 4px 6px;
  border-radius: 8px;
  background: var(--toc-btn-bg);
  border: var(--toc-btn-bd);
  color: var(--toc-btn-fg);           /* 远方金光色系 */
  cursor: pointer;
  transition: background .18s ease, box-shadow .18s ease, transform .12s ease;
}
#write .md-toc-tooltip .btn.md-delete-toc:hover{
  background: var(--toc-btn-bg-hover);
  box-shadow: var(--toc-btn-ring-hover);
  color: var(--toc-btn-fg-hover);
  transform: translateY(-1px);
}
#write .md-toc-tooltip .btn.md-delete-toc:active{ transform: none; }

/* 减少动态：关闭过渡 */
@media (prefers-reduced-motion: reduce){
  #write .md-toc-tooltip .btn.md-delete-toc{ transition: none; }
}

/* 标题行（仅伪元素居中） */
#write .md-toc-content::before {
  content: "📑 目录（content）";
  display: block;
  font-family: 'GuDuYanHei','AliPuHuiTi',sans-serif;
  font-weight: 800;
  font-size: var(--toc-title-fs);
  color: var(--toc-fg);
  text-shadow: 0 1px 2px rgba(0,0,0,.45);

  border-bottom: var(--toc-title-border);
  line-height: var(--toc-title-lh);
  margin: 0 auto var(--toc-title-mb) auto;   /* 居中 */
  width: fit-content;                         /* 宽度随内容 */
}
/* =============================== END OF PACKAGE ============================ */
/* =======================================================================================
   Rhapsody · Mermaid Diagram Preview  （春意盎然 · Markdown 图表美化）
   设计理念 / Design Concept
   - 专属 Mermaid 预览容器（.md-diagram-panel），与代码块（霓虹风格）区隔，避免视觉冲突。
   - 采用静态配色 + 渐变背景 + 平铺纹理，突出“春意盎然”的轻盈氛围。
   - SVG 内部节点/连线统一变量化，保证 flowchart / sequence / gantt / classDiagram 等一致。
   - 性能优先：常态静止，Hover 仅调整阴影；无动画/滤镜，避免 GPU 常驻负载。
   - 打印与高对比模式提供兜底样式，确保跨平台与长文档场景下的可读性。
   ======================================================================================= */

/* ======================================================================================= */
/* REGION A — MERMAID · 春意盎然（仅预览容器 | 不影响霓虹代码块）                     */
/* Scope: #write 内，仅对 mermaid 的预览面板生效（.md-diagram-panel.md-fences-adv-panel）   */
/* 兼容：子节点结构（pre > panel）与兄弟结构（pre + panel）                                */
/* Function:                                                                               */
/* - 清空 mermaid 代码块外层 pre 的“霓虹壳”，把视觉放到预览容器                           */
/* - 统一卡片底/圆角/阴影/背景纹理；细化节点/连线/网格等                                   */
/* ======================================================================================= */

/* ── Vars（仅本区使用 / Region-local vars） ── */
#write {
  --spring-bg:       #f6fbf4;  /* 卡片底色 / Card background */
  --spring-fg:       #2e3b2f;  /* 前景文字 / Foreground text */
  --spring-accent:   #55b36b;  /* 描边/连线强调 / Accent stroke */
  --spring-border:   1px solid rgba(46,59,47,.16);
  --spring-radius:   14px;
  --spring-shadow:   0 10px 28px rgba(34,63,42,.12);
  --spring-padding:  1.0rem 1.1rem;
  --spring-gap:      0.65rem;
  --spring-maxw:     100%;
  --spring-grad:     radial-gradient(120% 80% at 10% 0%, #fcfcfc 0%, #f6fbf4 40%, #ffffff 100%);
  --spring-bg-img:   url("file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Assets/Mermaid/%E6%AC%A3%E6%AC%A3%E5%90%91%E8%8D%A3.png"); /* 平铺纹理 / Tiling texture */
}

/* ① 外层 pre 清空霓虹壳（仅 mermaid，不动其它语言） */
#write pre.md-fences.md-diagram[lang="mermaid"] {
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  text-shadow: none !important;
  padding: 0 !important;  /* 留白交给预览容器 */
  margin: var(--spring-gap) 0 !important;
}

/* ② 预览容器壳（子节点 & 兄弟结构） */
#write pre.md-fences.md-diagram.md-fences-advanced[lang="mermaid"] > .md-diagram-panel.md-fences-adv-panel,
#write pre.md-fences.md-diagram.md-fences-advanced[lang="mermaid"] + .md-diagram-panel.md-fences-adv-panel {
  background: var(--spring-grad), var(--spring-bg-img);
  background-size: cover, 420px;
  background-repeat: no-repeat, repeat;
  color: var(--spring-fg);
  border: var(--spring-border);
  border-radius: var(--spring-radius);
  box-shadow: var(--spring-shadow);
  padding: var(--spring-padding);
  margin: var(--spring-gap) 0;
  position: relative;
  z-index: 7; /* 低于霓虹代码块 z=6 */
  overflow: auto;
}

/* ====== A) 整体背景增强（容器 + 预览层） ====== */
#write pre[lang="mermaid"] .md-diagram-panel-preview {
  background: var(--spring-grad), var(--spring-bg-img);
  background-size: cover, 420px;
  background-repeat: no-repeat, repeat;
  background-position: center, 0 0;
  background-blend-mode: soft-light, normal;
  border-radius: var(--spring-radius);
}

/* ③ 内部绘图区外壳 */
#write pre[lang="mermaid"] .md-diagram-panel {
  background: transparent;
  border: 0;
  padding: 0;
  margin: 0;
}

/* ④ SVG 自适应（不溢出，保持矢量清晰） */
#write pre[lang="mermaid"] .mermaid-svg {
  max-width: var(--spring-maxw);
  height: auto !important;
}

/* ⑤ 文本/颜色（优先 currentColor，减少冲突） */
#write pre[lang="mermaid"] .mermaid-svg * {
  color: var(--spring-fg);
  fill: currentColor;
}

/* ⑥ 节点（矩形/菱形/路径等） */
#write pre[lang="mermaid"] .mermaid-svg .node rect,
#write pre[lang="mermaid"] .mermaid-svg .node polygon,
#write pre[lang="mermaid"] .mermaid-svg .node path {
  fill: rgba(255,255,255,.88);
  stroke: var(--spring-accent);
  stroke-width: 1.2px;
  rx: 8; ry: 8;
}

/* ⑦ 连线与箭头 */
#write pre[lang="mermaid"] .mermaid-svg .edgePath .path,
#write pre[lang="mermaid"] .mermaid-svg .flowchart-link {
  stroke: var(--spring-accent) !important;
  stroke-width: 1.25px;
}
#write pre[lang="mermaid"] .mermaid-svg .arrowheadPath,
#write pre[lang="mermaid"] .mermaid-svg .marker {
  fill: var(--spring-accent) !important;
  stroke: var(--spring-accent) !important;
}

/* ⑧ 边标签底 */
#write pre[lang="mermaid"] .mermaid-svg .edgeLabel rect {
  fill: rgba(232,232,232,.72);
  opacity: .9;
}

/* ⑨ cluster 分组 */
#write pre[lang="mermaid"] .mermaid-svg .cluster rect {
  fill: rgba(134,214,163,.10);
  stroke: rgba(85,179,107,.65);
  stroke-width: 1.2px;
  rx: 12; ry: 12;
}

/* ⑩ 时序图消息线 */
#write pre[lang="mermaid"] .mermaid-svg .messageLine0,
#write pre[lang="mermaid"] .mermaid-svg .messageLine1 {
  stroke: var(--spring-accent);
}

/* ⑪ 甘特图任务条与网格 */
#write pre[lang="mermaid"] .mermaid-svg .task {
  fill: rgba(85,179,107,.88);
  stroke: rgba(46,59,47,.25);
}
#write pre[lang="mermaid"] .mermaid-svg .grid .tick line {
  stroke: rgba(46,59,47,.18);
}

/* ⑫ Hover 提亮（预览壳） */
#write pre[lang="mermaid"] > .md-diagram-panel.md-fences-adv-panel:hover,
#write pre[lang="mermaid"] + .md-diagram-panel.md-fences-adv-panel:hover {
  box-shadow: 0 12px 32px rgba(34,63,42,.16);
}

/* ⑬ 打印（去阴影与纹理，保留边框） */
@media print {
  #write pre[lang="mermaid"] > .md-diagram-panel.md-fences-adv-panel,
  #write pre[lang="mermaid"] + .md-diagram-panel.md-fences-adv-panel {
    box-shadow: none !important;
    background-image: none !important;
    border: 1px solid rgba(0,0,0,.35);
  }
}

/* ⑭ flowchart-v2 菱形强调 */
#write pre[lang="mermaid"][mermaid-type="flowchart-v2"] .mermaid-svg .node polygon {
  stroke-width: 1.6px;
}

/* ⑮ 标题文字 */
#write pre[lang="mermaid"] .mermaid-svg .flowchartTitleText,
#write pre[lang="mermaid"] .mermaid-svg .title,
#write pre[lang="mermaid"] .mermaid-svg .cluster-label text,
#write pre[lang="mermaid"] .mermaid-svg .cluster-label span {
  fill: var(--spring-fg) !important;
  color: var(--spring-fg) !important;
  font-weight: 600;
}

/* ⑯ 起点/终点 */
#write pre[lang="mermaid"] .mermaid-svg .start-state,
#write pre[lang="mermaid"] .mermaid-svg .end-state,
#write pre[lang="mermaid"] .mermaid-svg .stateStart,
#write pre[lang="mermaid"] .mermaid-svg .stateEnd,
#write pre[lang="mermaid"] .mermaid-svg .node circle {
  fill: #fff !important;
  stroke: var(--spring-accent) !important;
  stroke-width: 1.4px !important;
}

/* ⑰ 注释框（notes） */
#write pre[lang="mermaid"] .mermaid-svg .note,
#write pre[lang="mermaid"] .mermaid-svg .note rect {
  fill: rgba(255,255,255,.9) !important;
  stroke: rgba(85,179,107,.55) !important;
  stroke-width: 1.1px !important;
  rx: 10; ry: 10;
}

/* ⑱ Tooltip */
#write pre[lang="mermaid"] .mermaidTooltip {
  background: #f8fff9 !important;
  border: 1px solid rgba(85,179,107,.55) !important;
  color: var(--spring-fg) !important;
  border-radius: 8px !important;
  box-shadow: 0 6px 18px rgba(34,63,42,.15) !important;
}

/* ⑲ 时序图（sequenceDiagram） */
#write pre[lang="mermaid"] .mermaid-svg .actor,
#write pre[lang="mermaid"] .mermaid-svg .actor rect {
  fill: rgba(255,255,255,.92) !important;
  stroke: var(--spring-accent) !important;
  stroke-width: 1.2px !important;
  rx: 8; ry: 8;
}
#write pre[lang="mermaid"] .mermaid-svg .lifeline,
#write pre[lang="mermaid"] .mermaid-svg .messageLine0,
#write pre[lang="mermaid"] .mermaid-svg .messageLine1 {
  stroke: var(--spring-accent) !important;
  stroke-width: 1.2px !important;
}
#write pre[lang="mermaid"] .mermaid-svg .activation0,
#write pre[lang="mermaid"] .mermaid-svg .activation1,
#write pre[lang="mermaid"] .mermaid-svg .activation2 {
  fill: rgba(85,179,107,.18) !important;
  stroke: var(--spring-accent) !important;
}
#write pre[lang="mermaid"] .mermaid-svg .labelBox,
#write pre[lang="mermaid"] .mermaid-svg .loopLine,
#write pre[lang="mermaid"] .mermaid-svg .loopText {
  stroke: rgba(85,179,107,.55) !important;
  fill: rgba(134,214,163,.10) !important;
}
#write pre[lang="mermaid"] .mermaid-svg .loopText,
#write pre[lang="mermaid"] .mermaid-svg .labelText {
  fill: var(--spring-fg) !important;
}

/* ⑳ 甘特图（gantt） */
#write pre[lang="mermaid"] .mermaid-svg .axis path,
#write pre[lang="mermaid"] .mermaid-svg .axis line {
  stroke: rgba(46,59,47,.28) !important;
}
#write pre[lang="mermaid"] .mermaid-svg .axis text,
#write pre[lang="mermaid"] .mermaid-svg .tick text {
  fill: var(--spring-fg) !important;
}
#write pre[lang="mermaid"] .mermaid-svg .today {
  stroke: #ff6a00 !important;
  stroke-width: 2px !important;
  opacity: .8;
}
#write pre[lang="mermaid"] .mermaid-svg .sectionTitle,
#write pre[lang="mermaid"] .mermaid-svg .sectionTitle text {
  fill: var(--spring-fg) !important;
  font-weight: 600;
}

/* ㉑ 类图（classDiagram） */
#write pre[lang="mermaid"] .mermaid-svg .classGroup rect,
#write pre[lang="mermaid"] .mermaid-svg .classGroup polygon {
  fill: rgba(255,255,255,.9) !important;
  stroke: var(--spring-accent) !important;
  stroke-width: 1.2px !important;
  rx: 10; ry: 10;
}
#write pre[lang="mermaid"] .mermaid-svg .classTitle {
  fill: var(--spring-fg) !important;
  font-weight: 700 !important;
}

/* ㉒ ER 图（erDiagram） */
#write pre[lang="mermaid"] .mermaid-svg .er entity rect,
#write pre[lang="mermaid"] .mermaid-svg .er .entityBox,
#write pre[lang="mermaid"] .mermaid-svg .er .label rect {
  fill: rgba(255,255,255,.9) !important;
  stroke: var(--spring-accent) !important;
}
#write pre[lang="mermaid"] .mermaid-svg .er .relationshipLabel text {
  fill: var(--spring-fg) !important;
}

/* ㉓ 用户旅程（journey） */
#write pre[lang="mermaid"] .mermaid-svg .journey-section,
#write pre[lang="mermaid"] .mermaid-svg .section {
  fill: rgba(134,214,163,.12) !important;
  stroke: rgba(85,179,107,.55) !important;
}
#write pre[lang="mermaid"] .mermaid-svg .actorTitle,
#write pre[lang="mermaid"] .mermaid-svg .taskText {
  fill: var(--spring-fg) !important;
}

/* ㉔ 辅助功能：线端圆润 + 高对比模式/打印 */
#write pre[lang="mermaid"] .mermaid-svg .edgePath .path {
  stroke-linecap: round !important;
  stroke-linejoin: round !important;
}
@media print {
  #write pre[lang="mermaid"] .mermaid-svg .edgeLabel rect { fill:#eee !important; }
}
@media (prefers-contrast: more) {
  #write pre[lang="mermaid"] .mermaid-svg .edgeLabel rect { fill:#eaeaea !important; }
}

/* =============================== END OF PACKAGE ============================ */

/* =======================================================================================
   Rhapsody · Front-Matter Package（文首信息块 · Transparent Edition）
   设计理念 / Design Concept
   - 仅作用于文档开头的 YAML Front-Matter / Meta Block，不影响正文与 fenced code。
   - 保留纯文字呈现：去掉底色、边框、阴影和圆角，使其与正文自然衔接。
   - 参数化 padding / margin / line-height，方便根据版心或导出需求微调。
   - 打印与导出 PDF 时保持透明显示，避免强制底色，确保一致性。
   - 不改动 HTML 结构，避免使用 !important，兼容 Typora/Electron 渲染逻辑。
   ======================================================================================= */

/* =======================================================================================
   REGION A — TRANSPARENT FRONT-MATTER（仅文首 meta 块，纯文字透明）
   Scope: 仅 #write 顶层、位于文档开头的 .md-front-matter / .md-meta-block
   Function: 去掉一切底色/边框/阴影/圆角，仅保留文本（导出 PDF 同样生效）
   Notes: 不影响 YAML fenced code block；不修改 HTML 结构；尽量避免 !important
   Adjustable: --yml-fm-padding / --yml-fm-margin / --yml-fm-line-height
   ======================================================================================= */

/* 局部参数（可按需改） */
#write{
  --yml-fm-padding: .25rem 0;
  --yml-fm-margin:  .2rem  0;
  --yml-fm-line-height: 1.6;
}

/* 仅文首 Front-Matter：透明、纯文字 */
#write > :is(.md-front-matter, .md-meta-block){
  background: transparent;
  border: none;
  box-shadow: none;
  border-radius: 0;
  padding: var(--yml-fm-padding);
  margin:  var(--yml-fm-margin);
  color: inherit;
  font:  inherit;            /* 跟正文一致 */
  line-height: var(--yml-fm-line-height);
}

/* 清空铺底伪元素（若上游有加背景，确保不显示） */
#write > :is(.md-front-matter, .md-meta-block)::before,
#write > :is(.md-front-matter, .md-meta-block)::after{
  content: none;
  background: none;
}

/* 首块顶部更紧凑（可选） */
#write > :is(.md-front-matter, .md-meta-block):first-child{
  margin-top: .1rem;
}

/* 导出/打印时保持一致（文本透明显示，无强制底色） */
@media print{
  #write > :is(.md-front-matter, .md-meta-block){
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
}

/* 若极端情况下仍被外部样式着色，可解除注释启用强覆盖 */
/* #write > :is(.md-front-matter, .md-meta-block){
//   background: transparent !important;
//   border: none !important;
//   box-shadow: none !important;
// }
/* =============================== END OF PACKAGE ============================ */
/* =======================================================================================
   Rhapsody · Mark Highlight （正文 mark：静态彩虹底 + 动态彩虹文字）
   设计理念 / Design Concept
   - mark 背景使用硬切分的静态彩虹色带，保证跨行连续性与视觉稳定。
   - mark 内文字叠加平滑渐变，并通过背景裁剪实现动态流动效果。
   - 减少动态偏好时尊重用户设置：动画关闭，仅保留静态渐变。
   - 不改动 DOM 结构；范围严格限制在 #write mark；数学公式与 tooltip 不受影响。
   - 通过 box-shadow 与 text-shadow 增强可读性，确保不同彩虹底色上文字清晰。
   ======================================================================================= */

/* ========================================================================== */
/* REGION A — MARK HIGHLIGHT（正文 mark：静态彩虹底 + 动态彩虹文字）          */
/* Scope: #write mark（不改 DOM，不做数学/tooltip 排除）                        */
/* Function: 背景为静态彩虹色带；文字使用渐变并带流动动画；尊重减少动态设置    */
/* Adjustable: 色带顺序、动画时长、圆角、光影                                  */
/* ========================================================================== */

/* —— Region Root Vars —— */
#write {
  /* 视觉细节 */
  --mk-radius: 0.12em;
  --mk-inner-light: rgba(255,255,255,0.15);
  --mk-outer-glow: rgba(255,255,255,0.08);
  --mk-text-sharp: rgba(0,0,0,0.25);
  --mk-hover-inner-light: rgba(255,255,255,0.25);
  --mk-hover-outer-glow: rgba(255,255,255,0.15);

  /* 动态文字渐变速度（越小越快） */
  --mk-text-anim-duration: 6s;

  /* 静态彩虹条（硬切色带，不平滑过渡） */
  --mk-rainbow-static: linear-gradient(
    90deg,
    #ff0000 0% 14.2857%,
    #ff7f00 14.2857% 28.5714%,
    #ffff00 28.5714% 42.8571%,
    #00ff00 42.8571% 57.1428%,
    #0000ff 57.1428% 71.4285%,
    #4b0082 71.4285% 85.7142%,
    #8b00ff 85.7142% 100%
  );

  /* 文字用的平滑彩虹（可改为与你喜好的三色） */
  --mk-text-gradient: linear-gradient(90deg,
    #ff4d4f, #ffd700, #23b3fc, #8b00ff, #ff4d4f
  );
}

/* —— 基础态：静态彩虹底 + 动态彩虹文字 —— */
#write mark{
  position: relative;
  display: inline;
  font-weight: 600;
  padding: 0 0.05em;
  margin: 0;
  line-height: inherit;
  border-radius: var(--mk-radius);

  /* 跨行连续性 */
  -webkit-box-decoration-break: clone;
  box-decoration-break: clone;

  /* 两层背景：第1层=盒子静态彩虹；第2层=文字渐变（会动） */
  background-image:
    var(--mk-rainbow-static),
    var(--mk-text-gradient);
  background-size:
    100% 100%,           /* 盒子层：不缩放 */
    300% 100%;           /* 文字层：放大用来流动 */
  background-position:
    0 0,                 /* 盒子层：固定 */
    0% 50%;              /* 文字层：从左到右 */
  background-repeat: no-repeat;

  /* 将第二层裁剪到文字里，实现“渐变字色”；第一层只在盒子范围内 */
  -webkit-background-clip: padding-box, text;
  background-clip: padding-box, text;
  color: transparent; /* 让文字显示为第二层渐变 */

  /* 贴字发光 + 描边兜底（提高任意彩虹底上的可读性） */
  box-shadow:
    inset 0 -0.1em 0.3em var(--mk-inner-light),
    0 0 0.3em var(--mk-outer-glow);
  text-shadow:
    0   0.5px 0 #000,    /* 黑色近描边：亮底更清晰 */
    0  -0.5px 0 #fff,    /* 白色近描边：暗底更清晰 */
    0.5px 0   0 #fff,
   -0.5px 0   0 #fff,
    0   0     3px rgba(0,0,0,.6); /* 远阴影：整体分离度 */

  /* 仅让“文字那层”动：通过改变第二层的 background-position */
  animation: mkTextFlow var(--mk-text-anim-duration) linear infinite;
  transition: box-shadow .3s ease, text-shadow .3s ease, filter .3s ease;
}

/* —— 键盘可访问性 —— */
#write mark:focus-visible{
  outline: 2px solid rgba(0,0,0,0.22);
  outline-offset: 2px;
  border-radius: calc(var(--mk-radius) + 0.02em);
}

/* —— mark 内链接颜色继承 —— */
#write mark a{
  color: inherit;
  text-decoration-color: currentColor;
}

/* —— 仅驱动“第二层=文字渐变”的流动 —— */
@keyframes mkTextFlow{
  0%   { background-position: 0 0,   0% 50%; }
  50%  { background-position: 0 0, 100% 50%; }
  100% { background-position: 0 0,   0% 50%; }
}

/* —— 减少动态偏好：静止文字渐变 —— */
@media (prefers-reduced-motion: reduce){
  #write mark{
    animation: none !important;
    background-position: 0 0, 50% 50%;
  }
}
/* =============================== END OF PACKAGE ============================ */
/* =======================================================================================
   Rhapsody · Selection Highlight（正文选区高亮 · 玫瑰粉）
   设计理念 / Design Concept
   - 为正文提供统一的文字选中反馈，提升交互一致性与可感知性。
   - 采用玫瑰粉半透明底色，配合米白文字，保证在深浅背景下均有良好对比度。
   - 双层文字阴影（金黄 / 蓝色）制造柔和立体感，避免选区视觉呆板。
   - 样式严格限定在 #write 内部，避免干扰 Typora UI 其它区域。
   - 可通过变量灵活调整配色与透明度，便于快速主题适配。
   ======================================================================================= */
/* ========================================================================== */
/* REGION A — SELECTION HIGHLIGHT（正文选区高亮 · 玫瑰粉）                     */
/* Scope: #write 内的文字选中 (::selection / ::-moz-selection)                 */
/* 作用 / Purpose:
   - 提供统一的选中高亮色，强化交互反馈
   - 玫瑰粉底色，辅以金黄/蓝色的文字阴影，保证对比与美感
   Adjustable Params:
   - --sel-bg: 背景色（含透明度）
   - --sel-fg: 前景文字色
   - --sel-shadow-a/b: 双层文字阴影色
   ========================================================================== */

#write {
  /* Vars（仅本区使用，不外溢） */
  --sel-bg: rgba(233, 64, 87, 0.85);     /* 背景色 · 玫瑰粉 */
  --sel-fg: #f5f3e7;                     /* 前景色 · 米白 */
  --sel-shadow-a: rgba(255, 215, 0, 0.45); /* 金黄微光 */
  --sel-shadow-b: rgba(77, 168, 218, 0.6); /* 蓝色柔光 */
}

/* Chromium / WebKit */
#write ::selection {
  background-color: var(--sel-bg) !important;
  color: var(--sel-fg) !important;
  text-shadow:
    0 0.5px 1px var(--sel-shadow-a),
    0 0 4px var(--sel-shadow-b) !important;
}

/* Firefox */
#write ::-moz-selection {
  background-color: var(--sel-bg) !important;
  color: var(--sel-fg) !important;
  text-shadow:
    0 0.5px 1px var(--sel-shadow-a),
    0 0 4px var(--sel-shadow-b) !important;
}
/* =============================== END OF PACKAGE ============================ */

/* =======================================================================================
   Rhapsody · Context Menus（右键菜单与子菜单 · 四季/时刻主题组）
   设计理念 / Design Concept
   - 仅针对 Typora 的菜单 DOM（ul.dropdown-menu.context-menu…），不改动任何 HTML 结构；
     统一使用 fixed 定位与局部变量，确保样式作用域收敛、互不污染。
   - 视觉基调以「季节/时刻」叙事：不同区块承担不同菜单语义，颜色与纹理轻度表达情绪；
     常态静止、Hover 才触发低饱和渐变；尊重 prefers-reduced-motion。
   - 性能策略：小面积、短时出现、仅背景渐变与阴影；伪元素 ::before/::after 作为轻量背景层，
     默认极低透明度；允许二级菜单溢出；必要处 isolation:isolate；可按需加入 contain: paint。
   - 资产约定：背景图为菜单专用轻量版（WebP/AVIF，长边 800–1200px，≤200KB），避免首次解码峰值。

   —— 分区主题 / Core Themes ——
   • REGION A — 春 · 黄发垂髫（右键主菜单 / #context-menu）
     关键词：清新 · 青绿色感底 · 柳叶绿 × 樱花粉柔光 · 轻流动渐变 · 子菜单箭头轻呼吸
     语义：全局右键入口，气质明朗、干净、友好，强调“开始/探索”的轻盈感。

   • REGION B — 夏 · 荷叶红花（编辑子菜单 / #edit-menu.ext-context-menu）
     关键词：繁茂 · 叶绿 × 花红主图 · 柔光点缀 · 亮度略高 · 操作性强
     语义：编辑相关操作较频繁，用更直接的色彩对比提升“可点性”与节奏感。

   • REGION C — 秋 · 鸿雁南飞（块级样式菜单 / #block-style-menu）
     关键词：收束 · 草金 × 赭橙 × 远山青 · 雁阵纹理 · 稳重而层次分明
     语义：结构/层级选择（H1–H6/Paragraph），以“雁阵”隐喻层级秩序与排版节律。

   • REGION D — 冬 · 独钓寒江（插入菜单 / #insert-menu）
     关键词：静谧 · 雾白 × 霜蓝 · 细雪粒子（可关） · 冰蓝渐变
     语义：插入对象（图片/脚注等）多为“外物”，用冷静克制的视觉降低干扰，强调专注。

   • REGION E — 晨 · 一日之计（图片缩放菜单 / #zoom-img-menu）
     关键词：启程 · 淡青蓝 × 晨光金 · 柔和晨景 · 轻盈渐变
     语义：图片操控强调“清晰与明快”，象征一天的开始，操作反馈干净利落。

   • REGION F — 昏 · 万籁俱寂（切换图像语法菜单 / #switch-img-syntax-menu）
     关键词：宁静 · 夜幕深蓝 × 月光银 · 冷色渐变 · 克制光晕
     语义：语法切换偏“技术向”，在低调冷静的氛围下凸显信息与逻辑。

   Adjustable Params（全局约定）
   - 颜色：--XX-bg / --XX-fg / --XX-border / 渐变三色 --XX-grad-1/2/3 / 光晕 --XX-glow-a/b
   - 形状：--XX-radius（圆角）、阴影 --XX-shadow、菜单项高度/内边距
   - 动画：关键帧周期、background-size 位移幅度；可增设主开关 --menu-anim=0 以一键静止
   - 资产：--XX-bg-img 为可选主图（极低透明度/soft-light），未配置时不影响布局

   Compatibility / Notes
   - 现代浏览器 & Typora(Electron)；旧内核下渐变/混合回退为静态底色。
   - 仅限菜单节点生效；不在正文/侧栏/工具条中扩散；二级菜单允许溢出并覆盖。
   ======================================================================================= */

/* =======================================================================================
   REGION A — CONTEXT MENU · 春·黄发垂髫（右键菜单 / Context Menu · Spring Palette）
   Scope: 仅作用于 Typora 右键菜单 #context-menu.dropdown-menu.context-menu
   Function: 青绿色感底 + 柳叶绿/樱花粉柔光；Hover 启动低饱和流动渐变；子菜单箭头轻呼吸
   Notes:
   - 不依赖外部主题变量，全部硬编码；允许子菜单溢出；定位强制 fixed（不改 HTML 结构）
   - 尊重 prefers-reduced-motion：在系统减少动态时关闭渐变动画
   - 可选：极低不透明度铺一层“春”背景图以呼应整体（见最下方开关）
   ======================================================================================= */

#context-menu.dropdown-menu.context-menu{
  /* —— Region-local Vars（仅本区使用 / Season Switch by tuning these） —— */
  /* Paper & text */
  --ctx-bg: #caf9e5;                          /* 青绿色感底 | parchment */
  --ctx-fg: #642c1b;                           /* 棕红色文字 | readable dark */
  --ctx-border: rgba(152, 136, 110, .28);      /* 温和棕灰描边 */
  --ctx-radius: 10px;
  --ctx-shadow: 0 12px 28px rgba(0,0,0,.32);

  /* Spring glow triad（低饱和度柳绿 / 樱粉 / 高光白） */
  --ctx-grad-1: #a8d5a2;  /* willow green */
  --ctx-grad-2: #ffd4e1;  /* sakura pink */
  --ctx-grad-3: #ffffff;  /* soft white */

  /* Soft glows */
  --ctx-glow-green: rgba(168,213,162,.35);
  --ctx-glow-pink:  rgba(255,212,225,.35);

  /* Optional image tint（极低透明度防干扰） */
  --ctx-bg-img:url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Assets/UI/%E6%98%A5-%E9%BB%84%E5%8F%91%E5%9E%82%E9%AB%AB.png'); ; /* 如需启用：url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Assets/Seasons/spring_bg.jpg') 或你的相对路径 */

  /* —— Root —— */
  background:
    var(--ctx-bg);
  color: var(--ctx-fg);
  border: 1px solid var(--ctx-border);
  border-radius: var(--ctx-radius);
  box-shadow: var(--ctx-shadow);
  overflow: visible;                   /* 允许二级菜单溢出 */
  padding: 6px 0;
  z-index: 2147483647;

  position: fixed !important;          /* 以视口为参照 */
  top: auto; left: auto; margin: 0 !important;

  isolation: isolate;                  /* 独立层叠环境 */
  font-family: 'AliPuHuiTi','Microsoft YaHei',sans-serif; /* 依赖 prerequisite.css 的字体映射 */
}

/* 背景层：水彩光斑（柳绿/樱粉）+ 可选纸纹/背景图极低透明度 */
#context-menu.dropdown-menu.context-menu::before{
  content:"";
  position:absolute; inset:0;
  border-radius: var(--ctx-radius);
  z-index: 0;
  background:
    radial-gradient(130% 140% at 20% 18%, rgba(168,213,162,.18), transparent 62%),
    radial-gradient(120% 130% at 82% 85%, rgba(255,212,225,.16), transparent 60%),
    var(--ctx-bg-img);
  background-size: cover, cover, cover;
  background-position: center;
  background-blend-mode: normal, normal, soft-light;
  opacity: .99;                         /* 总体很轻，避免干扰可读性 */
  pointer-events: none;
}

/* 内容层基线 */
#context-menu.dropdown-menu.context-menu > li,
#context-menu.dropdown-menu.context-menu > li > a,
#context-menu.dropdown-menu.context-menu > li .menu-item-container{
  position: relative; z-index: 1;
}

/* 通用菜单项 */
#context-menu.dropdown-menu.context-menu > li:not(.divider) > a,
#context-menu.dropdown-menu.context-menu > li.has-btn-submenu > .menu-item-container{
  display:flex; align-items:center; gap:6px;
  height: 32px; padding: 0 12px;
  color: var(--ctx-fg);
  text-decoration: none; white-space: nowrap;
  transition: background .26s ease, color .18s ease, box-shadow .26s ease;
}

/* Hover / Active：低饱和流动渐变 + 柔光 */
#context-menu.dropdown-menu.context-menu > li:not(.divider) > a:hover,
#context-menu.dropdown-menu.context-menu > li.has-btn-submenu:hover > .menu-item-container,
#context-menu.dropdown-menu.context-menu > li.has-extra-menu > a:hover{
  background: linear-gradient(135deg, var(--ctx-grad-1), var(--ctx-grad-2), var(--ctx-grad-3));
  background-size: 300% 300%;
  color: #2a332a; /* 渐变偏亮时仍用深色字，保持春日清爽 */
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.12),
    0 0 10px var(--ctx-glow-green),
    0 0 16px var(--ctx-glow-pink);
  animation: ctxSpringFlow 6s ease infinite;
}

/* 子菜单箭头：轻呼吸 */
#context-menu.dropdown-menu.context-menu > li.has-extra-menu > a .fa.fa-caret-right{
  margin-left:auto; color:#7e8a7e;
  transition: color .18s ease, transform .18s ease;
}
#context-menu.dropdown-menu.context-menu > li.has-extra-menu > a:hover .fa.fa-caret-right{
  color:#5c8f5e; transform: translateX(2px);
}

/* 快捷键文本 */
#context-menu .ty-menu-shortcut{
  margin-left:auto; color:#808a7a; font-size:.92em;
}

/* 分隔线：细白映射到纸面 */
#context-menu.dropdown-menu.context-menu > li.divider{
  height:1px; margin:6px 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.28), transparent);
}

/* 图标统一继承 */
#context-menu.dropdown-menu.context-menu i,
#context-menu.dropdown-menu.context-menu .ty-icon{
  color: currentColor; text-shadow:none; font-style:normal; line-height:1;
}

/* 顶部按钮组（如有） */
#context-menu .menu-style-btn{
  display:inline-flex; align-items:center; justify-content:center;
  min-width:32px; height:28px; border-radius:6px;
  color: var(--ctx-fg);
  background: rgba(255,255,255,.06);
  border: 1px solid var(--ctx-border);
  transition: background .2s ease, color .2s ease, box-shadow .25s ease, transform .08s ease;
}
#context-menu .menu-style-btn:hover{
  background: linear-gradient(135deg, var(--ctx-grad-1), var(--ctx-grad-2));
  color:#2b332b;
  box-shadow: 0 0 8px var(--ctx-glow-green), 0 0 12px var(--ctx-glow-pink);
}
#context-menu .menu-style-btn:active{ transform: translateY(1px) }
#context-menu .menu-style-btn-2width{ min-width:44px }

/* 动画关键帧（轻微位移） */
@keyframes ctxSpringFlow{
  0%{ background-position: 0% 50%; }
  50%{ background-position: 100% 50%; }
  100%{ background-position: 0% 50%; }
}

/* 减少动态偏好：禁用动画 */
@media (prefers-reduced-motion: reduce){
  #context-menu.dropdown-menu.context-menu > li:not(.divider) > a:hover,
  #context-menu.dropdown-menu.context-menu > li.has-btn-submenu:hover > .menu-item-container,
  #context-menu.dropdown-menu.context-menu > li.has-extra-menu > a:hover{
    animation:none !important; background-position:50% 50%;
  }
}

/* —— 可选开关：将春季背景图压到超低透明度以更贴合整套主题 —— */
/* 使用时把 var(--ctx-bg-img) 设置为 url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Auxiliary/%E4%BD%A0%E7%9A%84%E6%98%A5%E5%9B%BE%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84') 即可 */

/* =======================================================================================
   REGION B — CONTEXT MENU · 夏·荷叶红花（子区 B：编辑子菜单 / ext-context-menu）
   Scope: <ul id="edit-menu" class="dropdown-menu context-menu ext-context-menu>
   Function: 以荷叶红花背景图为底，辅以低透明度光斑点缀；Hover 时柔光渐变
   Notes:
   - 背景图路径请自行替换
   - 保持 DOM 结构不动；尊重 prefers-reduced-motion
   ======================================================================================= */

ul#edit-menu.dropdown-menu.context-menu.ext-context-menu {
  --em-bg: #9effff;                        /* 背景底色 fallback */
  --em-fg: #203620;                        /* 荷叶墨绿文字 */
  --em-border: rgba(33, 66, 33, .22);
  --em-radius: 10px;
  --em-shadow: 0 12px 24px rgba(0,0,0,.28);

  /* Hover 渐变色（荷叶绿+荷花粉+高光白） */
  --em-grad-1: #66bb6a;
  --em-grad-2: #ff8a80;
  --em-grad-3: #ffffff;

  --em-glow-g: rgba(102,187,106,.35);
  --em-glow-r: rgba(255,138,128,.35);

  background: var(--em-bg);
  color: var(--em-fg);
  border: 1px solid var(--em-border);
  border-radius: var(--em-radius);
  box-shadow: var(--em-shadow);
  overflow: visible;
  padding: 6px 0;
  z-index: 2147483647;
  isolation: isolate;
  font-family: 'AliPuHuiTi','Microsoft YaHei',sans-serif;
}

/* 背景图层：荷叶红花主图 + 光斑点缀 */
ul#edit-menu.dropdown-menu.context-menu.ext-context-menu::before {
  content:"";
  position:absolute; inset:0;
  border-radius: var(--em-radius);
  z-index:0;
  background:
    radial-gradient(120% 130% at 18% 20%, rgba(102,187,106,.18), transparent 60%),
    radial-gradient(120% 130% at 82% 85%, rgba(255,138,128,.16), transparent 60%),
    url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Assets/UI/%E5%A4%8F-%E8%8D%B7%E5%8F%B6%E7%BA%A2%E8%8A%B1.png');   /* ← 这里替换成你的背景图路径 */
  background-size: cover, cover, cover;
  background-position: center;
  background-blend-mode: normal, normal, soft-light;
  opacity: .99;  /* 主图清晰，点缀轻度 */
  pointer-events:none;
}

/* 菜单项 */
ul#edit-menu.dropdown-menu.context-menu.ext-context-menu > li:not(.divider) > a,
ul#edit-menu.dropdown-menu.context-menu.ext-context-menu > li.has-btn-submenu > .menu-item-container {
  display:flex; align-items:center; gap:6px;
  height:32px; padding:0 12px;
  color: var(--em-fg);
  text-decoration:none; white-space:nowrap;
  transition: background .26s ease, color .18s ease, box-shadow .26s ease;
}

/* Hover：渐变光效 */
ul#edit-menu.dropdown-menu.context-menu.ext-context-menu > li:not(.divider) > a:hover,
ul#edit-menu.dropdown-menu.context-menu.ext-context-menu > li.has-btn-submenu:hover > .menu-item-container {
  background: linear-gradient(135deg, var(--em-grad-1), var(--em-grad-2), var(--em-grad-3));
  background-size: 300% 300%;
  color: #1b2b1b;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.12),
    0 0 10px var(--em-glow-g),
    0 0 14px var(--em-glow-r);
  animation: editMenuSummerFlow 6s ease infinite;
}

/* 禁用/隐藏/分隔线 */
ul#edit-menu.dropdown-menu.context-menu.ext-context-menu > li.disabled > a {
  color: #0900e6; opacity:.65; cursor:not-allowed;
  background:transparent !important; box-shadow:none !important;
}
ul#edit-menu.dropdown-menu.context-menu.ext-context-menu > li.hide { display:none; }
ul#edit-menu.dropdown-menu.context-menu.ext-context-menu > li.divider {
  height:1px; margin:6px 0;
  background: linear-gradient(90deg, transparent, rgba(0,0,0,.08), transparent);
}

/* 快捷键文本 */
ul#edit-menu .ty-menu-shortcut {
  margin-left:auto; color:#4f6f4f; font-size:.92em;
}

/* 图标 */
ul#edit-menu i, ul#edit-menu .ty-icon { color:currentColor; text-shadow:none; line-height:1; }

/* 动画关键帧 */
@keyframes editMenuSummerFlow {
  0%{ background-position:0% 50%; }
  50%{ background-position:100% 50%; }
  100%{ background-position:0% 50%; }
}

@media (prefers-reduced-motion: reduce) {
  ul#edit-menu.dropdown-menu.context-menu.ext-context-menu > li:not(.divider) > a:hover {
    animation:none !important;
    background-position:50% 50%;
  }
}

/* =======================================================================================
   REGION C — CONTEXT MENU · 秋·鸿雁南飞（区 C：块级样式菜单 / #block-style-menu）
   Scope: <ul id="block-style-menu" class="dropdown-menu context-menu ext-context-menu">
   Design: 浅米纸底 + 金黄/赭橙/远山青；雁阵高光纹理；Hover 柔和流动渐变
   Notes : 不改 DOM；固定定位但不覆盖 top/left；尊重 reduced-motion
   ======================================================================================= */

ul#block-style-menu.dropdown-menu.context-menu.ext-context-menu{
  /* —— 局部变量（仅本区使用）—— */
  --bs-bg: #F6EFDF;               /* 纸感浅米底 */
  --bs-fg: #2f302a;               /* 深灰墨色文字 */
  --bs-border: rgba(120, 96, 64, .26);
  --bs-radius: 10px;
  --bs-shadow: 0 12px 26px rgba(0,0,0,.28);

  /* 秋季三色（草金/赭橙/远山青）→ Hover 渐变 */
  --bs-grad-1: #E7B85A;           /* 草金 */
  --bs-grad-2: #D77F3F;           /* 赭橙 */
  --bs-grad-3: #8DA4B3;           /* 远山青（冷调平衡） */

  /* 柔光 */
  --bs-glow-a: rgba(231,184,90,.32);
  --bs-glow-b: rgba(215,127,63,.28);

  /* 背景主图（可替换为你的路径） */
  --bs-bg-img: url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Assets/UI/%E7%A7%8B-%E9%B8%BF%E9%9B%81%E5%8D%97%E9%A3%9E.png');

  /* —— 容器基线 —— */
  position: fixed;                /* 让 top/left 由内联样式控制 */
  z-index: 2147483647;
  isolation: isolate;
  overflow: visible;
  padding: 6px 0;

  background: var(--bs-bg);
  color: var(--bs-fg);
  border: 1px solid var(--bs-border);
  border-radius: var(--bs-radius);
  box-shadow: var(--bs-shadow);
  font-family: 'AliPuHuiTi','Microsoft YaHei',sans-serif;
}

/* 背景图层：暖金光斑 + 雁阵主图（极轻软光） */
ul#block-style-menu.dropdown-menu.context-menu.ext-context-menu::before{
  content:"";
  position:absolute; inset:0;
  border-radius: var(--bs-radius);
  z-index:0;
  background:
    radial-gradient(120% 130% at 18% 22%, rgba(231,184,90,.18), transparent 62%),
    radial-gradient(120% 130% at 86% 82%, rgba(215,127,63,.14), transparent 60%),
    var(--bs-bg-img);
  background-size: cover, cover, cover;
  background-position: center;
  background-blend-mode: normal, normal, soft-light;
  opacity: .99;
  pointer-events: none;
}

/* 内容层（盖在背景上） */
ul#block-style-menu > li,
ul#block-style-menu > li > a{
  position: relative; z-index:1;
}

/* 菜单项（Heading 1~6 / Paragraph） */
ul#block-style-menu > li:not(.divider) > a{
  display:flex; align-items:center; gap:8px;
  height: 32px;
  padding: 0 12px;
  color: var(--bs-fg);
  text-decoration:none; white-space:nowrap;
  transition: background .26s ease, color .18s ease, box-shadow .26s ease, transform .06s ease;
}

/* Hover：秋色流动渐变 + 柔光外晕 */
ul#block-style-menu > li:not(.divider) > a:hover{
  background: linear-gradient(135deg, var(--bs-grad-1), var(--bs-grad-2), var(--bs-grad-3));
  background-size: 320% 320%;
  color: #262721;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.12),
    0 0 10px var(--bs-glow-a),
    0 0 14px var(--bs-glow-b);
  animation: bsAutumnFlow 7s ease infinite;
}

/* 当前激活项（.state-on）：左侧金线 + 轻抬起 */
ul#block-style-menu > li > a.state-on{
  background: linear-gradient(135deg, #F7E5C4, #f4d7b3);
  box-shadow: inset 3px 0 0 0 #E7B85A;
  font-weight: 700;
  transform: translateX(1px);
}

/* 快捷键文本（靠右对齐） */
ul#block-style-menu .ty-menu-shortcut{
  margin-left:auto; font-size:.92em; color:#6b6c63;
}

/* 分隔线 */
ul#block-style-menu > li.divider{
  height:1px; margin:6px 0;
  background: linear-gradient(90deg, transparent, rgba(0,0,0,.08), transparent);
}

/* 禁用态（如果有） */
ul#block-style-menu > li.disabled > a{
  color:#8a867b; opacity:.55; cursor:not-allowed;
  background:transparent !important; box-shadow:none !important;
}

/* 轻动效（雁阵风的感觉） */
@keyframes bsAutumnFlow{
  0%{   background-position: 0% 50%; }
  50%{  background-position: 100% 50%; }
  100%{ background-position: 0% 50%; }
}

/* 低动态偏好：停掉动画 */
@media (prefers-reduced-motion: reduce){
  ul#block-style-menu > li:not(.divider) > a:hover{
    animation: none !important; background-position: 50% 50%;
  }
}

/* —— 细节：标题层级的微型前缀（可选）——
   用纯 CSS 的小圆点/横条表达层级深浅；不改 DOM，可随时删掉 */
ul#block-style-menu a[data-block^="header"]::before{
  content:"";
  width:.5em; height:.5em; border-radius:999px; margin-right:4px;
  background: currentColor; opacity:.25;
}
ul#block-style-menu a[data-block="header1"]::before{ opacity:.55; }
ul#block-style-menu a[data-block="header2"]::before{ opacity:.48; }
ul#block-style-menu a[data-block="header3"]::before{ opacity:.42; }
ul#block-style-menu a[data-block="header4"]::before{ opacity:.36; }
ul#block-style-menu a[data-block="header5"]::before{ opacity:.30; }
ul#block-style-menu a[data-block="header6"]::before{ opacity:.24; }

/* Paragraph 行给一个书页小横线（不想要可删除） */
ul#block-style-menu a[data-block="paragraph"]::before{
  content:""; width:.7em; height:.14em; border-radius:2px; background: currentColor; opacity:.28;
}

/* =======================================================================================
   REGION D — CONTEXT MENU · 冬·独钓寒江雪（区 D：插入菜单 / #insert-menu）
   Scope : <ul id="insert-menu" class="dropdown-menu context-menu ext-context-menu>
   Design: 米白雾感底 + 冷灰蓝；雪粒纹理；Hover 冰蓝渐变；尊重 reduced-motion
   Notes : 不覆盖 top/left；不改 DOM；允许二级菜单溢出
   ======================================================================================= */

ul#insert-menu.dropdown-menu.context-menu.ext-context-menu{
  /* —— 局部变量 —— */
  --im-bg: #F4F4F1;                 /* 冬日雾白底 */
  --im-fg: #2a2f34;                 /* 深冷灰文字 */
  --im-border: rgba(80, 92, 104, .22);
  --im-radius: 10px;
  --im-shadow: 0 12px 26px rgba(0,0,0,.28);

  /* 冰蓝三色（Hover 渐变） */
  --im-grad-1: #D7E2EA;             /* 雾蓝 */
  --im-grad-2: #BFCEDA;             /* 霜蓝 */
  --im-grad-3: #FFFFFF;             /* 高光白 */

  --im-glow-a: rgba(183,202,215,.28);
  --im-glow-b: rgba(191,206,218,.22);

  /* 背景主图（按你的实际路径替换） */
  --im-bg-img: url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Assets/UI/%E5%86%AC-%E7%8B%AC%E9%92%93%E5%AF%92%E6%B1%9F.png');

  position: fixed;                   /* 交由内联 top/left 定位 */
  z-index: 2147483647;
  isolation: isolate;
  overflow: visible;
  padding: 6px 0;

  background: var(--im-bg);
  color: var(--im-fg);
  border: 1px solid var(--im-border);
  border-radius: var(--im-radius);
  box-shadow: var(--im-shadow);
  font-family: 'AliPuHuiTi','Microsoft YaHei',sans-serif;
}

/* 背景层：冷蓝光斑 + 冬景主图（软光） */
ul#insert-menu.dropdown-menu.context-menu.ext-context-menu::before{
  content:"";
  position:absolute; inset:0;
  border-radius: var(--im-radius);
  z-index:0;
  background:
    radial-gradient(120% 130% at 16% 22%, rgba(215,226,234,.18), transparent 62%),
    radial-gradient(120% 130% at 86% 82%, rgba(191,206,218,.14), transparent 60%),
    var(--im-bg-img);
  background-size: cover, cover, cover;
  background-position: center;
  background-blend-mode: normal, normal, soft-light;
  opacity: .99;
  pointer-events: none;
}

/* 细雪层（轻度粒子；可关） */
ul#insert-menu.dropdown-menu.context-menu.ext-context-menu::after{
  content:"";
  position:absolute; inset:0;
  border-radius: var(--im-radius);
  z-index:0;
  background:
    radial-gradient(2px 2px at 20% 10%, rgba(255,255,255,.45) 60%, transparent 61%) repeat,
    radial-gradient(2px 2px at 70% 30%, rgba(255,255,255,.40) 60%, transparent 61%) repeat,
    radial-gradient(2px 2px at 40% 70%, rgba(255,255,255,.38) 60%, transparent 61%) repeat;
  background-size: 220px 220px, 260px 260px, 300px 300px;
  background-position: 0 0, 20px -10px, -15px 25px;
  opacity: .35;
  pointer-events:none;
  animation: imSnowDrift 22s linear infinite;
}

/* 内容层 */
ul#insert-menu > li,
ul#insert-menu > li > a{
  position: relative; z-index:1;
}

/* 菜单项（Image / Footnotes / …） */
ul#insert-menu > li:not(.divider) > a{
  display:flex; align-items:center; gap:8px;
  height: 32px;
  padding: 0 12px;
  color: var(--im-fg);
  text-decoration:none; white-space:nowrap;
  transition: background .26s ease, color .18s ease, box-shadow .26s ease, transform .06s ease;
}

/* Hover：冰蓝渐变 + 霜光 */
ul#insert-menu > li:not(.divider) > a:hover{
  background: linear-gradient(135deg, var(--im-grad-1), var(--im-grad-2), var(--im-grad-3));
  background-size: 320% 320%;
  color: #22272b;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.12),
    0 0 10px var(--im-glow-a),
    0 0 14px var(--im-glow-b);
  animation: imWinterFlow 8s ease infinite;
}

/* 当前激活项（若有 .state-on） */
ul#insert-menu > li > a.state-on{
  background: linear-gradient(135deg, #EEF3F6, #E6EDF2);
  box-shadow: inset 3px 0 0 0 #C7D6E2;
  font-weight: 700;
  transform: translateX(1px);
}

/* 快捷键文本 */
ul#insert-menu .ty-menu-shortcut{
  margin-left:auto; font-size:.92em; color:#6c7780;
}

/* 分隔线 */
ul#insert-menu > li.divider{
  height:1px; margin:6px 0;
  background: linear-gradient(90deg, transparent, rgba(0,0,0,.08), transparent);
}

/* 禁用态（若出现） */
ul#insert-menu > li.disabled > a{
  color:#8a9096; opacity:.55; cursor:not-allowed;
  background:transparent !important; box-shadow:none !important;
}

/* —— 动画 —— */
@keyframes imWinterFlow{
  0%{   background-position: 0% 50%; }
  50%{  background-position: 100% 50%; }
  100%{ background-position: 0% 50%; }
}
@keyframes imSnowDrift{
  0%{   background-position: 0 0, 20px -10px, -15px 25px; }
  100%{ background-position: 0 300px, 20px 290px, -15px 325px; }
}

/* 减少动态偏好：停掉动画/粒子 */
@media (prefers-reduced-motion: reduce){
  ul#insert-menu > li:not(.divider) > a:hover{ animation:none !important; background-position:50% 50%; }
  ul#insert-menu.dropdown-menu.context-menu.ext-context-menu::after{ animation:none !important; opacity:.25; }
}

/* =======================================================================================
   REGION E — CONTEXT MENU · 清晨·一日之计（区 E：图片缩放菜单 / #zoom-img-menu）
   Scope : <ul id="zoom-img-menu" class="dropdown-menu context-menu ext-context-menu>
   Design: 淡青蓝雾底 + 晨光金辉；Hover 渐变流动如晨曦
   Notes : 不改 DOM；尊重 prefers-reduced-motion；允许子菜单溢出
   ======================================================================================= */

ul#zoom-img-menu.dropdown-menu.context-menu.ext-context-menu {
  /* —— 局部变量 —— */
  --zm-bg: #F7F9F6;                   /* 雾感浅底 */
  --zm-fg: #2b322f;                   /* 深灰文字 */
  --zm-border: rgba(90,100,110,.22);
  --zm-radius: 10px;
  --zm-shadow: 0 12px 24px rgba(0,0,0,.28);

  /* 晨曦三色（Hover 渐变） */
  --zm-grad-1: #b3d3e6;               /* 淡青蓝 */
  --zm-grad-2: #f9e6b3;               /* 晨光金 */
  --zm-grad-3: #ffffff;               /* 高光白 */

  --zm-glow-a: rgba(179,211,230,.32);
  --zm-glow-b: rgba(249,230,179,.28);

  /* 背景主图（晨景） */
  --zm-bg-img: url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Assets/UI/%E6%99%A8-%E4%B8%80%E6%97%A5%E4%B9%8B%E8%AE%A1.png');

  position: fixed;                   /* top/left 交给内联定位 */
  z-index: 2147483647;
  isolation: isolate;
  overflow: visible;
  padding: 6px 0;

  background: var(--zm-bg);
  color: var(--zm-fg);
  border: 1px solid var(--zm-border);
  border-radius: var(--zm-radius);
  box-shadow: var(--zm-shadow);
  font-family: 'AliPuHuiTi','Microsoft YaHei',sans-serif;
}

/* 背景层：淡蓝/金光斑 + 晨景主图（柔和覆盖） */
ul#zoom-img-menu.dropdown-menu.context-menu.ext-context-menu::before {
  content:"";
  position:absolute; inset:0;
  border-radius: var(--zm-radius);
  z-index:0;
  background:
    radial-gradient(120% 130% at 18% 22%, rgba(179,211,230,.16), transparent 62%),
    radial-gradient(120% 130% at 84% 80%, rgba(249,230,179,.14), transparent 60%),
    var(--zm-bg-img);
  background-size: cover, cover, cover;
  background-position: center;
  background-blend-mode: normal, normal, soft-light;
  opacity: .99;
  pointer-events: none;
}

/* 内容层 */
ul#zoom-img-menu > li,
ul#zoom-img-menu > li > a{
  position: relative; z-index:1;
}

/* 菜单项 */
ul#zoom-img-menu > li:not(.divider) > a{
  display:flex; align-items:center; gap:8px;
  height: 32px;
  padding: 0 12px;
  color: var(--zm-fg);
  text-decoration:none; white-space:nowrap;
  transition: background .26s ease, color .18s ease, box-shadow .26s ease, transform .06s ease;
}

/* Hover：晨光渐变 */
ul#zoom-img-menu > li:not(.divider) > a:hover{
  background: linear-gradient(135deg, var(--zm-grad-1), var(--zm-grad-2), var(--zm-grad-3));
  background-size: 320% 320%;
  color: #232827;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.12),
    0 0 10px var(--zm-glow-a),
    0 0 14px var(--zm-glow-b);
  animation: zoomMenuMorningFlow 7s ease infinite;
}

/* Divider */
ul#zoom-img-menu > li.divider{
  height:1px; margin:6px 0;
  background: linear-gradient(90deg, transparent, rgba(0,0,0,.08), transparent);
}

/* 动画关键帧 */
@keyframes zoomMenuMorningFlow {
  0%{   background-position: 0% 50%; }
  50%{  background-position: 100% 50%; }
  100%{ background-position: 0% 50%; }
}

/* 减少动态偏好：停掉动画 */
@media (prefers-reduced-motion: reduce){
  ul#zoom-img-menu > li:not(.divider) > a:hover{
    animation:none !important; background-position:50% 50%;
  }
}

/* =======================================================================================
   REGION F — CONTEXT MENU · 昏·万籁俱寂（区 F：切换图像语法菜单 / #switch-img-syntax-menu）
   Scope : <ul id="switch-img-syntax-menu" class="dropdown-menu context-menu ext-context-menu>
   Design: 深蓝夜幕底 + 银白月光；Hover 时冷色渐变，氛围静谧安宁
   Notes : 不改 DOM；尊重 prefers-reduced-motion；允许子菜单溢出
   ======================================================================================= */

ul#switch-img-syntax-menu.dropdown-menu.context-menu.ext-context-menu {
  /* —— 局部变量 —— */
  --sm-bg: #101820;                  /* 夜幕深底 */
  --sm-fg: #e6ebf2;                  /* 冷银白文字 */
  --sm-border: rgba(200,200,220,.22);
  --sm-radius: 10px;
  --sm-shadow: 0 12px 26px rgba(0,0,0,.38);

  /* 夜色三色（Hover 渐变） */
  --sm-grad-1: #1d2a44;              /* 深蓝 */
  --sm-grad-2: #2e3d66;              /* 靛青 */
  --sm-grad-3: #4c5c7a;              /* 月光灰蓝 */

  --sm-glow-a: rgba(77,102,133,.32);
  --sm-glow-b: rgba(180,200,220,.25);

  /* 背景主图（夜景） */
  --sm-bg-img: url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Assets/UI/%E6%98%8F-%E4%B8%87%E7%B1%81%E4%BF%B1%E5%AF%82.png');

  position: fixed;                   /* top/left 交由内联控制 */
  z-index: 2147483647;
  isolation: isolate;
  overflow: visible;
  padding: 6px 0;

  background: var(--sm-bg);
  color: var(--sm-fg);
  border: 1px solid var(--sm-border);
  border-radius: var(--sm-radius);
  box-shadow: var(--sm-shadow);
  font-family: 'AliPuHuiTi','Microsoft YaHei',sans-serif;
}

/* 背景层：夜幕冷蓝 + 主图（月光夜景） */
ul#switch-img-syntax-menu.dropdown-menu.context-menu.ext-context-menu::before {
  content:"";
  position:absolute; inset:0;
  border-radius: var(--sm-radius);
  z-index:0;
  background:
    radial-gradient(120% 130% at 18% 20%, rgba(77,102,133,.18), transparent 60%),
    radial-gradient(120% 130% at 82% 85%, rgba(180,200,220,.14), transparent 60%),
    var(--sm-bg-img);
  background-size: cover, cover, cover;
  background-position: center;
  background-blend-mode: normal, normal, soft-light;
  opacity: .99;
  pointer-events: none;
}

/* 内容层 */
ul#switch-img-syntax-menu > li,
ul#switch-img-syntax-menu > li > a{
  position: relative; z-index:1;
}

/* 菜单项 */
ul#switch-img-syntax-menu > li:not(.divider) > a{
  display:flex; align-items:center; gap:8px;
  height: 34px;
  padding: 0 14px;
  color: var(--sm-fg);
  text-decoration:none; white-space:nowrap;
  transition: background .26s ease, color .18s ease, box-shadow .26s ease, transform .06s ease;
  font-size: .95em;
}

/* Hover：冷蓝渐变 + 月光柔光 */
ul#switch-img-syntax-menu > li:not(.divider) > a:hover{
  background: linear-gradient(135deg, var(--sm-grad-1), var(--sm-grad-2), var(--sm-grad-3));
  background-size: 320% 320%;
  color: #f5f8fc;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.12),
    0 0 10px var(--sm-glow-a),
    0 0 14px var(--sm-glow-b);
  animation: switchMenuNightFlow 9s ease infinite;
}

/* Divider */
ul#switch-img-syntax-menu > li.divider{
  height:1px; margin:6px 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.12), transparent);
}

/* 动画关键帧 */
@keyframes switchMenuNightFlow {
  0%{   background-position: 0% 50%; }
  50%{  background-position: 100% 50%; }
  100%{ background-position: 0% 50%; }
}

/* 减少动态偏好：停掉动画 */
@media (prefers-reduced-motion: reduce){
  ul#switch-img-syntax-menu > li:not(.divider) > a:hover{
    animation:none !important; background-position:50% 50%;
  }
}
/* =============================== END OF PACKAGE ============================ */
/* =======================================================================================
   Rhapsody · SPELL CHECK PANEL · 橘猫吃鸡（暖橙·木质）
   Scope : <ul id="spell-check-panel" class="dropdown-menu">（Typora 内置拼写语言面板）
   Design Concept
   - 主题取自“胖橘 + 烤鸡 + 木质餐桌”：深木色作底，暖橙与蜂蜜金为主色，局部金色高光提示交互。
   - 背景图只作氛围层：极低不透明度 + 软光混合 + 轻微暗角（vignette），始终不干扰文字与焦点。
   - 常态静止、性能优先；hover 仅做微亮与金色描边增益；尊重 prefers-reduced-motion。
   - 不改 DOM、严格限域于本面板；允许列表滚动；导出时可按需关闭或降低背景层可见度。
   ======================================================================================= */

 /* ========================================================================== */
/* REGION A — PANEL ROOT（面板根样式）                                         */
/* Scope: ul#spell-check-panel.dropdown-menu                                  */
/* Function: Typora 拼写语言面板的皮肤与布局：固定定位、三层背景（暗角/遮罩/主图）*/
/*           与内容层分离；常态静止；hover 仅微亮与金色描边；不改 DOM；可滚动。  */
/* Adjustable Params:                                                          */
/*   颜色：--sp-bg, --sp-fg, --sp-muted, --sp-border                           */
/*   渐变：--sp-g1, --sp-g2, --sp-g3                                           */
/*   点缀：--sp-gold, --sp-gold-soft                                           */
/*   形态：--sp-radius, --sp-shadow                                            */
/*   背景：--sp-bg-img, --sp-img-opacity, --sp-scrim, --sp-vignette            */
/* Compatibility: 现代浏览器 / Typora(Electron)；尊重 prefers-reduced-motion；  */
/*                导出场景可下调 --sp-img-opacity 以减渲染与压缩伪影。          */
/* ========================================================================== */

ul#spell-check-panel.dropdown-menu{
  /* —— 局部变量（可调）—— */
  /* 基础底色与文字 */
  --sp-bg: #1d1713;                       /* 深木色底（降低对比刺眼度） */
  --sp-fg: #F6F1E9;                       /* 乳白前景（接近桌面高光） */
  --sp-muted: #C9C0B6;                    /* 次级说明（淡麻色） */
  --sp-border: rgba(247, 214, 160, .28);  /* 蜂蜜金描边（低强度） */
  --sp-radius: 12px;
  --sp-shadow: 0 18px 36px rgba(0,0,0,.42);

  /* 暖橙梯度（Hover 用） */
  --sp-g1: #7b3f17;   /* 焦糖棕 */
  --sp-g2: #c56a1f;   /* 橘焦糖 */
  --sp-g3: #f1a43c;   /* 蜂蜜橙 */

  /* 金色点缀 */
  --sp-gold: #E8BB55;                     /* 蜂蜜金高光 */
  --sp-gold-soft: rgba(232,187,85,.30);

  /* 背景主图（替换为你的相对路径） */
  --sp-bg-img: url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Assets/UI/%E8%B6%85%E7%BA%A7%E5%A4%A7%E8%82%A5%E6%A9%98.png');

  /* 背景遮罩/暗角（可按需微调） */
  --sp-img-opacity: .99;                  /* 背景图整体透明度 */
  --sp-scrim: rgba(0,0,0,.28);            /* 全局轻遮罩：提可读性 */
  --sp-vignette: radial-gradient(120% 140% at 50% 35%,
                     rgba(0,0,0,.00) 0%,
                     rgba(0,0,0,.10) 55%,
                     rgba(0,0,0,.22) 100%);

  position: fixed;                         /* 交给内联 top/left 定位 */
  z-index: 2147483647;
  isolation: isolate;
  padding: 8px 0 6px;
  min-width: 300px;
  max-width: 520px;
  max-height: calc(68vh);
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;

  color: var(--sp-fg);
  background: var(--sp-bg);
  border: 1px solid var(--sp-border);
  border-radius: var(--sp-radius);
  box-shadow: var(--sp-shadow);
  font-family: 'AliPuHuiTi','Microsoft YaHei',sans-serif;
}

/* —— 背景层：橘猫主图 + 暗角 + 软光混合（低干扰） —— */
ul#spell-check-panel.dropdown-menu::before{
  content:"";
  position:absolute; inset:0; z-index:0; border-radius: var(--sp-radius);
  background:
    var(--sp-vignette),
    linear-gradient(var(--sp-scrim), var(--sp-scrim)),
    var(--sp-bg-img);
  background-size: cover, cover, cover;
  background-position: center 40%, center, center; /* 适度上提，突出猫脸 */
  background-blend-mode: normal, multiply, soft-light;
  opacity: var(--sp-img-opacity);
  filter: saturate(1) contrast(1.02);     /* 轻微增强但不晃眼 */
  pointer-events:none;
}

/* —— 内容层基线 —— */
ul#spell-check-panel > *{ position:relative; z-index:1; }

/* 顶部控制区（搜索/全局设置所在块） */
ul#spell-check-panel .ty-lang-control{
  display:block; padding: 0 12px;
}

/* 搜索输入框（木桌+蜂蜜金视觉） */
ul#spell-check-panel #ty-spell-check-panel-item-label{
  width: 100%;
  height: 34px;
  padding: 6px 10px;
  border-radius: 8px;
  border: 1px solid rgba(232,187,85,.35);
  background: linear-gradient(180deg, rgba(28,22,18,.92), rgba(35,28,23,.94));
  color: var(--sp-fg);
  outline: none;
  transition: border .18s ease, box-shadow .18s ease, background .18s ease, filter .18s ease;
}
ul#spell-check-panel #ty-spell-check-panel-item-label::placeholder{
  color: var(--sp-muted);
}
ul#spell-check-panel #ty-spell-check-panel-item-label:focus{
  border-color: var(--sp-gold);
  box-shadow: 0 0 0 2px var(--sp-gold-soft), inset 0 0 0 1px rgba(255,255,255,.06);
  filter: brightness(1.04);
}

/* 语言列表容器 */
ul#spell-check-panel .ty-lang-list{
  display:block; padding: 4px 0;
}

/* 分隔线（淡金渐变） */
ul#spell-check-panel .divider{
  height: 1px; margin: 8px 0;
  background: linear-gradient(90deg, transparent, rgba(232,187,85,.40), transparent);
}

/* 语言项（li.ty-spell-check-panel-item） */
ul#spell-check-panel .ty-spell-check-panel-item{
  display:flex; align-items:center; gap:8px;
  height: 34px; padding: 0 12px;
  color: var(--sp-fg); white-space: nowrap; text-decoration: none;
  transition: background .26s ease, color .18s ease, box-shadow .26s ease, transform .06s ease, filter .18s ease;
  border-left: 2px solid transparent;     /* 供激活/选中显示金线 */
}

/* Hover：暖橙流动渐变 + 蜂蜜金微光 */
ul#spell-check-panel .ty-spell-check-panel-item:hover{
  background: linear-gradient(135deg, var(--sp-g1), var(--sp-g2), var(--sp-g3));
  background-size: 320% 320%;
  color: #FFF7EA;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.06),
    0 0 10px rgba(197,106,31,.28),
    0 0 16px rgba(241,164,60,.20);
  animation: spWarmFlow 8s ease infinite;
  filter: saturate(1.06);
}

/* 当前选中（.ty-checked）：金线 + 蜂蜜金徽点 + 半高亮底 */
ul#spell-check-panel .ty-spell-check-panel-item.ty-checked{
  border-left-color: var(--sp-gold);
  background: linear-gradient(135deg, rgba(123,63,23,.55), rgba(197,106,31,.38));
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
  font-weight: 700;
}
ul#spell-check-panel .ty-spell-check-panel-item.ty-checked .ty-spell-check-panel-item-status{
  position: relative;
}
ul#spell-check-panel .ty-spell-check-panel-item-status::before{
  content:""; display:inline-block;
  width:.6em; height:.6em; border-radius:999px;
  box-shadow: 0 0 0 1px rgba(0,0,0,.35), 0 0 8px var(--sp-gold-soft);
  background: radial-gradient(circle at 40% 35%, #FFE8B8 0%, #E8BB55 55%, #A7772D 100%);
  opacity: .90;
}

/* 标签/代码（右对齐的语言 code） */
ul#spell-check-panel .ty-spell-check-panel-item-label{
  color: var(--sp-fg);
}
ul#spell-check-panel .ty-spell-check-panel-item-code{
  margin-left: auto;
  padding: 2px 8px; border-radius: 6px;
  font-size: .88em; color: #FFF0DA;
  background: linear-gradient(180deg, rgba(92,52,26,.55), rgba(71,41,22,.55));
  border: 1px solid rgba(232,187,85,.26);
}

/* 顶部“Auto/Disable/Global Setting”也作为通用项处理 */
ul#spell-check-panel #ty-spell-check-global-setting.ty-spell-check-panel-item{
  border-left: 2px solid transparent;
}
ul#spell-check-panel #ty-spell-check-global-setting.ty-spell-check-panel-item:hover{
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.06), 0 0 12px var(--sp-gold-soft);
}

/* 禁用/不可用（如有） */
ul#spell-check-panel .ty-spell-check-panel-item.disabled{
  opacity:.55; cursor:not-allowed;
  background: transparent !important; box-shadow: none !important;
}

/* 列表滚动条（细、暖棕） */
ul#spell-check-panel::-webkit-scrollbar{ width: 10px; }
ul#spell-check-panel::-webkit-scrollbar-thumb{
  background: linear-gradient(180deg, #6b4a2e, #3e2a1e);
  border: 2px solid transparent;
  background-clip: padding-box;
  border-radius: 999px;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.05);
}
ul#spell-check-panel::-webkit-scrollbar-track{
  background: transparent;
}

/* 动画关键帧（暖橙流动） */
@keyframes spWarmFlow{
  0%{   background-position: 0% 50%; }
  50%{  background-position: 100% 50%; }
  100%{ background-position: 0% 50%; }
}

/* 减少动态偏好：停用动画/过渡 */
@media (prefers-reduced-motion: reduce){
  ul#spell-check-panel *{ animation: none !important; transition: none !important; }
}
/* =============================== END OF PACKAGE ============================ */

/* =======================================================================================
   Rhapsody · FOOTER WORD COUNT PANEL（底栏词数统计面板 · 极光夜空）
   设计理念 / Design Concept
   - 主题意象：星蓝纸感为底，青蓝—月白的极光渐变作为交互强化，夜紫作高光点缀。
   - 背景策略：主图仅作氛围层（soft-light + scrim + vignette），常态静止、低干扰。
   - 可读性优先：数值列以“冷光小卡片”凸显，单位列降饱和处理以弱化干扰。
   - 性能与限域：fixed 浮层 + isolation + contain: paint，严格限域渲染；尊重减少动态设置。
   ======================================================================================= */

/* ========================================================================== */
/* REGION A — FOOTER WORD COUNT ROOT                                          */
/* Scope: <ul id="footer-word-count-info" class="dropdown-menu">              */
/* Function: 定义底栏词数统计面板的整体容器、局部变量、背景与字体等核心样式        */
/* Adjustable Params: 背景色/描边/圆角、极光渐变色、背景图位置与透明度、阴影层级 */
/* Compatibility: 现代浏览器 / Typora(Electron)；旧内核忽略 isolation/contain   */
/* ========================================================================== */
ul#footer-word-count-info.dropdown-menu{
  /* —— 局部变量 —— */
  --wc-bg: #0E1724;                       /* 星蓝底（冷·低对比纸感） */
  --wc-fg: #EAF2FF;                       /* 乳白前景（微冷） */
  --wc-muted: #f3bac2;                    /* 次级说明（冷灰蓝） */
  --wc-border: rgba(134,175,220,.28);     /* 冷蓝描边 */
  --wc-radius: 12px;
  --wc-shadow: 0 16px 32px rgba(0,0,0,.30);

  /* 极光渐变（Hover）— 绿 → 青蓝 → 夜紫高光 */
  --wc-g1:#3CCB8A;    /* 极光绿 */
  --wc-g2:#31A6DE;    /* 青蓝 */
  --wc-g3:#D6D9FF;    /* 月白高光 */

  /* 点缀（选中/分隔） */
  --wc-aurora-violet:#7C7BFF;             /* 夜紫高光 */
  --wc-aurora-soft: rgba(49,166,222,.26); /* 青蓝柔光 */

  /* 背景主图（极光夜空） */
  --wc-bg-img: url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Assets/UI/%E6%A2%A6%E5%B9%BB%E6%A3%AE%E6%9E%97.jpg');

  /* 背景层控制（建议范围：0.12–0.26） */
  --wc-img-pos-y: 42%;
  --wc-img-opacity: .99;
  --wc-scrim: rgba(0,0,0,.22);
  --wc-vignette: radial-gradient(120% 130% at 50% 40%,
                     rgba(0,0,0,0) 0%,
                     rgba(0,0,0,.10) 55%,
                     rgba(0,0,0,.20) 100%);

  position: fixed;
  z-index: 2147483647;
  isolation: isolate;
  contain: paint;                          /* 限域重绘 */
  padding: 8px 0 10px;
  min-width: 280px;
  max-width: 520px;
  max-height: 56vh;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;

  color: var(--wc-fg);
  background: var(--wc-bg);
  border: 1px solid var(--wc-border);
  border-radius: var(--wc-radius);
  box-shadow: var(--wc-shadow);
  font-family: 'AliPuHuiTi','Microsoft YaHei',sans-serif;
}

/* 背景：极光光斑 + 主图（soft-light，低干扰） */
ul#footer-word-count-info.dropdown-menu::before{
  content:""; position:absolute; inset:0; z-index:0; border-radius:var(--wc-radius);
  background:
    radial-gradient(120% 130% at 20% 18%, rgba(60,203,138,.18), transparent 62%),
    radial-gradient(120% 130% at 84% 86%, rgba(49,166,222,.16), transparent 60%),
    var(--wc-vignette),
    linear-gradient(var(--wc-scrim), var(--wc-scrim)),
    var(--wc-bg-img);
  background-size: cover, cover, cover, cover, cover;
  background-position:
    20% 18%,
    84% 86%,
    center,
    center,
    center var(--wc-img-pos-y);
  background-blend-mode: normal, normal, normal, multiply, soft-light;
  opacity: var(--wc-img-opacity);
  pointer-events:none;
}

/* 内容层 */
ul#footer-word-count-info > *{ position:relative; z-index:1; }

/* 顶部文字行 */
ul#footer-word-count-info .footer-word-count-info-line{
  display:flex; gap:10px; align-items:center;
  padding: 0 14px 6px;
  color: var(--wc-muted);
}
ul#footer-word-count-info .footer-word-count-selection.footer-word-count-info-line{
  color: var(--wc-fg);
}

/* 分隔线（细·冰蓝） */
ul#footer-word-count-info .divider{
  height:1px; margin:8px 0;
  background: linear-gradient(90deg, transparent, rgba(214,217,255,.55), transparent);
}

/* 表格 */
ul#footer-word-count-info table{
  width:100%; border-collapse: collapse; margin: 2px 0;
  color: var(--wc-fg);
}
ul#footer-word-count-info table tr{ transition: background .26s ease, color .18s ease; }
ul#footer-word-count-info table tr:nth-child(odd){ background: rgba(49,166,222,.06); }
ul#footer-word-count-info table tr:nth-child(even){ background: rgba(60,203,138,.06); }
ul#footer-word-count-info table td{
  padding: 6px 14px;
  border-bottom: 1px dashed rgba(134,175,220,.22);
  vertical-align: middle;
  white-space: nowrap;
}

/* 左侧数值列（小卡片视觉，冷光微亮） */
ul#footer-word-count-info #footer-read-time-count-td,
ul#footer-word-count-info #footer-line-count-td,
ul#footer-word-count-info #footer-word-count-td,
ul#footer-word-count-info #footer-char-count-td,
ul#footer-word-count-info #footer-word-count-td-sel,
ul#footer-word-count-info #footer-char-count-td-sel{
  min-width: 4.5em;
  font-weight: 800;
  letter-spacing: .02em;
  color: #21d2be;
  background: linear-gradient(180deg, rgba(255,255,255,.55), rgba(214,217,255,.18));
  border: 1px solid rgba(134,175,220,.34);
  border-radius: 8px;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.10);
  text-align: right;
}

/* 单位列 */
ul#footer-word-count-info td + td{ color: var(--wc-muted); }

/* Hover 行：极光渐变 + 轻霜光 */
ul#footer-word-count-info tr:hover{
  background: linear-gradient(135deg, var(--wc-g1), var(--wc-g2), var(--wc-g3));
  background-size: 280% 280%;
  color: #0f1522;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.08), 0 0 10px var(--wc-aurora-soft);
  animation: wcAuroraFlow 7s ease infinite;
}

/* 滚动条（细、极光绿→青蓝） */
ul#footer-word-count-info::-webkit-scrollbar{ width: 10px; }
ul#footer-word-count-info::-webkit-scrollbar-thumb{
  background: linear-gradient(180deg, #3CCB8A, #31A6DE);
  border: 2px solid transparent; background-clip: padding-box;
  border-radius: 999px; box-shadow: inset 0 0 0 1px rgba(255,255,255,.08);
}
ul#footer-word-count-info::-webkit-scrollbar-track{ background: transparent; }

/* 动画关键帧 */
@keyframes wcAuroraFlow{
  0%{   background-position: 0% 50%; }
  50%{  background-position: 100% 50%; }
  100%{ background-position: 0% 50%; }
}

/* 减少动态偏好 */
@media (prefers-reduced-motion: reduce){
  ul#footer-word-count-info *{ animation:none !important; transition:none !important; }
}
/* =============================== END OF PACKAGE ============================ */

/* =======================================================================================
   Rhapsody · SIDEBAR FILES MENU · 一口吃掉（高饱和红 · 青蓝 · 冰蓝）
   设计理念 / Design Concept
   - 视觉源自“红苹果一口”：主红梯度做动效，青蓝/冰蓝点缀突出层级。
   - 背景图仅作氛围层：低透明度 + 遮罩 + 暗角，不干扰文字聚焦。
   - 常态静止，hover 微亮与描边增强；尊重 prefers-reduced-motion。
   - 不改 DOM；仅限侧边栏文件菜单；允许滚动，导出时可降低背景层。
   ======================================================================================= */

/* ========================================================================== */
/* REGION A — SIDEBAR FILES MENU · 一口吃掉（高饱和红 · 青蓝 · 冰蓝）            */
/* Scope: ul#sidebar-files-menu.dropdown-menu                                 */
/* Function: 固定定位的侧边栏文件菜单皮肤；不改 DOM。提供三层背景（暗角/遮罩/主图）*/
/*           与内容层分离，常态静止；hover 仅做微亮与描边增强，允许滚动。        */
/* Adjustable Params:                                                          */
/*   颜色：--ap-bg, --ap-fg, --ap-muted, --ap-border                           */
/*   渐变：--ap-g1, --ap-g2, --ap-g3                                           */
/*   点缀：--ap-leaf, --ap-leaf-soft, --ap-ice                                 */
/*   形态：--ap-radius, --ap-shadow                                            */
/*   背景：--ap-bg-img, --ap-img-pos-y, --ap-img-opacity, --ap-scrim, --ap-vignette */
/* Compatibility: 现代浏览器 / Typora(Electron)；尊重 prefers-reduced-motion；  */
/*                导出场景可下调 --ap-img-opacity 以降低渲染/压缩伪影。          */
/* ========================================================================== */

ul#sidebar-files-menu.dropdown-menu{
  /* —— 局部变量 —— */
  --ap-bg: #0E1318;                         /* 深冷底（衬托高饱和红） */
  --ap-fg: #F6F7F9;                         /* 乳白前景 */
  --ap-muted: #BFC7D1;                      /* 次级说明（冷灰） */
  --ap-border: rgba(226, 40, 40, .28);      /* 主红相关描边（低强度） */
  --ap-radius: 12px;
  --ap-shadow: 0 16px 32px rgba(0,0,0,.38);

  /* Hover 渐变（深红 → 亮红 → 奶白高光） */
  --ap-g1:#8D0F0F;     /* 深红 */
  --ap-g2:#D21F1F;     /* 标志红 */
  --ap-g3:#FFF4E0;     /* 奶白高光 */

  /* 点缀（选中/小图标） */
  --ap-leaf:#00ffed;                         /* 青蓝 */
  --ap-leaf-soft: rgba(43,168,74,.28);
  --ap-ice: #DFF3FF;                         /* 冰蓝微光 */

  /* 背景主图（替换为你的相对路径） */
  --ap-bg-img: url('file:///C://Users//cgmmg//AppData//Roaming//Typora/themes/Rhapsody/Assets/UI/%E4%B8%80%E5%8F%A3%E5%90%83%E6%8E%89.png');

  /* 主图垂直位置（百分比越大越往下） */
  --ap-img-pos-y: 42%;

  /* 背景层控制 */
  --ap-img-opacity: .99;                     /* 建议 0.12–0.26 */
  --ap-scrim: rgba(0,0,0,.22);               /* 轻遮罩，提可读性 */
  --ap-vignette: radial-gradient(120% 130% at 50% 40%,
                     rgba(0,0,0,.00) 0%,
                     rgba(0,0,0,.10) 55%,
                     rgba(0,0,0,.20) 100%);

  position: fixed; z-index:2147483647; isolation:isolate;
  min-width: 280px; max-width: 520px; max-height: 62vh;
  overflow-y: auto; -webkit-overflow-scrolling: touch;
  padding: 8px 0;

  color: var(--ap-fg);
  background: var(--ap-bg);
  border: 1px solid var(--ap-border);
  border-radius: var(--ap-radius);
  box-shadow: var(--ap-shadow);
  font-family: 'AliPuHuiTi','Microsoft YaHei',sans-serif;
}

/* 背景层：暗角 + 轻遮罩 + 红苹果主图（soft-light，低干扰） */
ul#sidebar-files-menu.dropdown-menu::before{
  content:""; position:absolute; inset:0; z-index:0; border-radius:var(--ap-radius);
  background:
    var(--ap-vignette),
    linear-gradient(var(--ap-scrim), var(--ap-scrim)),
    var(--ap-bg-img);
  background-size: cover, cover, cover;
  background-position:
    center,
    center,
    center var(--ap-img-pos-y);
  background-blend-mode: normal, multiply, soft-light;
  opacity: var(--ap-img-opacity);
  pointer-events:none;
}

/* 内容层 */
ul#sidebar-files-menu > *{ position:relative; z-index:1; }

/* —— 分组标题 —— */
ul#sidebar-files-menu .menuitem-group-label{
  padding: 4px 14px 6px;
  font-weight: 700;
  color: var(--ap-fg);
  text-shadow: 0 1px 0 rgba(0,0,0,.25);
  display:flex; align-items:center; justify-content:space-between;
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.06));
  border-top: 1px solid rgba(255,255,255,.06);
  border-bottom: 1px solid rgba(255,255,255,.06);
}
ul#sidebar-files-menu .menuitem-group-label span[data-lg]{
  color: var(--ap-leaf);
}

/* 关闭按钮图标（右侧 X） */
ul#sidebar-files-menu #close-sidebar-menu-btn{
  color: var(--ap-muted);
  transition: color .18s ease, transform .08s ease;
}
ul#sidebar-files-menu #close-sidebar-menu-btn:hover{
  color: var(--ap-fg); transform: scale(1.06);
}

/* —— 菜单项 —— */
ul#sidebar-files-menu .file-action-item > a{
  display:flex; align-items:center; gap:8px;
  height: 34px; padding: 0 14px;
  color: var(--ap-fg); text-decoration:none; white-space:nowrap;
  transition: background .26s ease, color .18s ease, box-shadow .26s ease, transform .06s ease;
  border-left: 2px solid transparent;
}

/* Hover：红苹果流动渐变 + 冰蓝霜光 */
ul#sidebar-files-menu .file-action-item > a:hover{
  background: linear-gradient(135deg, var(--ap-g1), var(--ap-g2), var(--ap-g3));
  background-size: 300% 300%;
  color:#FFFFFF;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.10),
    0 0 10px rgba(210,31,31,.30),
    0 0 14px rgba(223,243,255,.22);
  animation: apRedFlow 7s ease infinite;
}

/* —— 排序按钮组（小图标按钮） —— */
ul#sidebar-files-menu .sort-button-area .ty-side-sort-btn{
  margin-left: 4px;
  color: var(--ap-muted);
  border-radius: 6px;
  padding: 2px;
  transition: background .2s ease, color .18s ease, box-shadow .2s ease, transform .06s ease;
}
ul#sidebar-files-menu .sort-button-area .ty-side-sort-btn:hover{
  color: var(--ap-fg);
  background: linear-gradient(135deg, rgba(210,31,31,.16), rgba(255,244,224,.12));
  box-shadow: 0 0 8px rgba(210,31,31,.25), inset 0 0 0 1px rgba(255,255,255,.06);
}
ul#sidebar-files-menu .sort-button-area .ty-side-sort-btn.active{
  color: var(--ap-leaf);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.08), 0 0 10px var(--ap-leaf-soft);
}

/* —— 最近位置条目 —— */
ul#sidebar-files-menu .folder-menu-item > a{
  display:flex; align-items:center; gap:10px;
  height: 34px; padding: 0 14px;
  color: var(--ap-fg); text-decoration:none; white-space:nowrap;
  transition: background .26s ease, color .18s ease, box-shadow .26s ease;
  border-left: 2px solid transparent;
}
ul#sidebar-files-menu .folder-menu-item > a i.fa{ color: currentColor; }

/* 选中文件夹（.selected-folder-menu-item） */
ul#sidebar-files-menu .folder-menu-item.selected-folder-menu-item > a{
  border-left-color: var(--ap-leaf);
  background: linear-gradient(135deg, rgba(210,31,31,.42), rgba(255,244,224,.22));
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.08);
  font-weight: 700;
}

/* 右侧小图标（Pin/Remove） */
ul#sidebar-files-menu .sidebar-folder-right-icon{
  margin-left: 10px; color: var(--ap-muted);
  transition: color .18s ease, transform .06s ease;
}
ul#sidebar-files-menu .sidebar-folder-right-icon:hover{
  color: var(--ap-leaf); transform: translateY(-1px);
}

/* 分隔线（细·冰蓝） */
ul#sidebar-files-menu .menuitem-group-label + .file-action-item:not(.show)::before,
ul#sidebar-files-menu .divider,
ul#sidebar-files-menu .folder-menu-groupm + .empty-menu-group{
  content:""; display:block; height:1px; margin:6px 0;
  background: linear-gradient(90deg, transparent, rgba(223,243,255,.55), transparent);
}

/* 滚动条（细、红→冰蓝） */
ul#sidebar-files-menu::-webkit-scrollbar{ width: 10px; }
ul#sidebar-files-menu::-webkit-scrollbar-thumb{
  background: linear-gradient(180deg, #D21F1F, #DFF3FF);
  border: 2px solid transparent; background-clip: padding-box;
  border-radius: 999px; box-shadow: inset 0 0 0 1px rgba(255,255,255,.08);
}
ul#sidebar-files-menu::-webkit-scrollbar-track{ background: transparent; }

/* 动画关键帧 */
@keyframes apRedFlow{
  0%{   background-position: 0% 50%; }
  50%{  background-position: 100% 50%; }
  100%{ background-position: 0% 50%; }
}

/* 减少动态偏好 */
@media (prefers-reduced-motion: reduce){
  ul#sidebar-files-menu *{ animation:none !important; transition:none !important; }
}
/* =============================== END OF PACKAGE ============================ */
/* =======================================================================================
   Rhapsody · Print Export Patch  (PDF/Print Cleanup · Scoped A/B/C/D)
   设计理念 / Design Concept
   - 尊重 Typora 限制：不改 HTML 结构，仅用选择器与 @media print 精准收敛；
   - 分区治理：
     · A — 屏幕态 & 全局打印清理（统一底色、去蓝条、去阴影/白边）
     · B — 表格专用补丁（仅命中 #write 内表格与其后代，不影响 TOC/正文）
     · C — 数学公式（MathJax SVG）行内/行间分治与不拆页护栏
     · D — 预留：容器分页兜底/跨页控制（按需启用）
   - 导出一致性：使用 print-color-adjust、table header/footer 组保证跨页稳定；
   - 性能优先：避免重滤镜/重动画；仅在打印上下文最小改动，减少重排与覆盖面。
   ======================================================================================= */
   
/* ========================================================================== */
/* REGION A — SCREEN & GLOBAL PRINT CLEANUP                                   */
/* Scope: 屏幕态（正常主题逻辑）+ 打印导出全局底色/蓝条清理                   */
/* Function: 提供打印 PDF 时的全局兜底背景，去掉外围蓝条与阴影，收敛白边       */
/* Adjustable Params: 全局背景色、阴影开关、外边距                            */
/* Compatibility: Typora 导出 / Electron 打印 / 现代浏览器                   */
/* ========================================================================== */
 /* 屏幕态：正常主题逻辑 */
@media print {
  /* 1) 彻底移除 html 层底色，杜绝与卡片层叠色 */
  html {
    background: none !important;
    -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
  }

  /* 2) 把全局底色下放到 body / typora-export（仅在外围可见） */
  body,
  .typora-export {
    background: #d5eafd !important;      /* 你的全局底色，仅在 #write 外可见 */
    box-shadow: none !important;
    margin: 0 !important;                 /* 防默认白边 */
  }

  /* 3) 明确声明 #write 为不透明卡片底（阻断下层底色“透色”） */
  #write {
    background: var(--card-bg, #fff8fa) !important;  /* 你的卡片底色 */
    box-shadow: none !important;          /* 如需：打印时去投影，避免黑边/糊影 */
    isolation: isolate;                   /* 独立绘制层，避免混合意外 */
    mix-blend-mode: normal !important;
  }

  /* 4) 可选：打印时收紧或关闭外扩光带，避免覆盖到外围底色的“交界脏边” */
#write::before {
  content: "";
  position: absolute;
  left: 0 !important; right: 0 !important;
  top: 0 !important;  bottom: 0 !important;
  border-radius: inherit !important;
  border: 1.2pt solid rgba(0, 0, 0, 1);        /* ✅ 黑线 */
  box-shadow:
    0 0 1.2pt rgba(0,0,0,0.3) inset,             /* ✅ 内阴影：轻浮起 */
    0 0 2pt rgba(255,255,255,0.5);               /* ✅ 外高光：柔和边缘 */
  mix-blend-mode: normal !important;
  pointer-events: none;
}


  /* 5) 角标层保持，但避免重滤镜以免打印糊（可选） */
  #write::after {
    filter: none !important;
    mix-blend-mode: normal !important;
  }
}


/* ========================================================================== */
/* REGION B — PRINT PATCH: TABLES ONLY                                        */
/* Scope: #write 内的表格及其子元素                                            */
/* Function: 打印导出时仅限定表格样式，避免影响 TOC/正文                       */
/* Adjustable Params: 表格圆角、边框色、表头色、斑马纹色、链接色                */
/* Compatibility: Typora 导出 PDF / Electron 打印 / 现代浏览器                 */
/* ========================================================================== */
@media print {

  /* —— 0. 颜色/背景精确到表格 —— */
  #write :is(.markdown-rendered table, .md-table, table) {
    -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
  }
  /* 如仍需全局文本缩放：保持这一行（可留可去） */
  html, body { -webkit-text-size-adjust: 100% !important; }

  /* —— 1. 变量兜底（可保留，也可删） —— */
  body{
    --tbl-body-radius: 1.4em;
    --tbl-body-shadow: 0 0 0 1px rgba(0,0,0,.12);
    --tbl-head-color:  #a35a1f;
    --tbl-td-color:    #3b2e1e;
    --tbl-link:        #168fcf;
    --tbl-link-hover:  #ff2a2a;
    --tbl-print-row:   #fff9e6;
    --tbl-print-head:  #fff3cc;
    --tbl-print-bd:    #e3d7b3;
  }

  /* —— 2. 仅隐藏“表格编辑工具条” —— */
  #write .ty-table-edit,
  #write .md-table-edit {
    display: none !important;
  }

  /* —— 基础命中集合：只锁定表格自身 —— */
  #write .markdown-rendered table,
  #write .md-table,
  #write table {
    width: 100% !important;
    border-collapse: separate !important;
    border-spacing: 0 !important;
    border: 1px solid var(--tbl-print-bd) !important;
    border-radius: var(--tbl-body-radius) !important;
    background: #fff !important;
    box-shadow: none !important;
    overflow: hidden !important;
    position: relative !important;
    z-index: 6 !important;
    /* 新增：打印稳态与避免被裁/被遮 */
    table-layout: fixed !important;
    page-break-inside: avoid;
    break-inside: avoid;
    mix-blend-mode: normal !important;
    background-clip: padding-box !important;
  }

  /* —— 取消仅限“表格”的伪元素/hover —— */
  #write .markdown-rendered table::before,
  #write .markdown-rendered table::after,
  #write .md-table::before,
  #write .md-table::after,
  #write table::before,
  #write table::after {
    content: none !important;
  }
  #write .markdown-rendered table tr:hover td,
  #write .markdown-rendered table tr:hover th,
  #write .md-table tr:hover td,
  #write .md-table tr:hover th,
  #write table tr:hover td,
  #write table tr:hover th {
    background: transparent !important;
    box-shadow: none !important;
  }

  /* —— 表头/表尾跨页复用 —— */
  #write :is(.markdown-rendered table, .md-table, table) thead {
    display: table-header-group !important;
  }
  #write :is(.markdown-rendered table, .md-table, table) tfoot {
    display: table-footer-group !important;
  }

  /* —— 表头（仅限表格内 th） —— */
  #write .markdown-rendered table th,
  #write .md-table th,
  #write table th {
    color: var(--tbl-head-color) !important;
    background: var(--tbl-print-head) !important;
    border-bottom: 1px solid var(--tbl-print-bd) !important;
    padding: 10pt 12pt !important;
    font-weight: 700 !important;
    text-shadow: none !important;
  }

  /* —— 单元格（仅限表格内 td） —— */
  #write .markdown-rendered table td,
  #write .md-table td,
  #write table td {
    color: var(--tbl-td-color) !important;
    background: #fff !important;
    border-top: 1px solid var(--tbl-print-bd) !important;
    border-right: 1px solid var(--tbl-print-bd) !important;
    padding: 9pt 12pt !important;
  }

  /* —— 文本换行策略（与正文语义一致，打印更稳） —— */
  #write :is(.markdown-rendered th, .md-table th,
             .markdown-rendered td, .md-table td,
             th .td-span, td .td-span){
    white-space: pre-wrap !important;     /* 保留手动换行，允许自动折行 */
    overflow-wrap: anywhere !important;   /* 现代优选：任何点都可断开 */
    word-break: break-word !important;    /* 兼容旧内核 */
    hyphens: auto !important;             /* 拉丁文自动断字（如设置 lang） */
    line-break: loose !important;         /* CJK 更宽松 */
  }

  /* —— 收口边框与圆角（仅限表格内首末单元格） —— */
  #write .markdown-rendered table tr > :first-child,
  #write .md-table tr > :first-child,
  #write table tr > :first-child {
    border-left: 1px solid var(--tbl-print-bd) !important;
  }
  #write .markdown-rendered table tr:first-child th:first-child,
  #write .md-table tr:first-child th:first-child,
  #write table tr:first-child th:first-child {
    border-top-left-radius: 10pt !important;
  }
  #write .markdown-rendered table tr:first-child th:last-child,
  #write .md-table tr:first-child th:last-child,
  #write table tr:first-child th:last-child {
    border-top-right-radius: 10pt !important;
  }
  #write .markdown-rendered table tr:last-child td:first-child,
  #write .md-table tr:last-child td:first-child,
  #write table tr:last-child td:first-child {
    border-bottom-left-radius: 10pt !important;
  }
  #write .markdown-rendered table tr:last-child td:last-child,
  #write .md-table tr:last-child td:last-child,
  #write table tr:last-child td:last-child {
    border-bottom-right-radius: 10pt !important;
  }

  /* —— 斑马纹（仅限表格内 tbody 行） —— */
  #write .markdown-rendered table tbody tr:nth-child(even) td,
  #write .md-table tbody tr:nth-child(even) td,
  #write table tbody tr:nth-child(even) td {
    background: var(--tbl-print-row) !important;
  }

  /* —— 链接（仅限表格内链接） —— */
  #write .markdown-rendered table a,
  #write .md-table a,
  #write table a {
    color: var(--tbl-link) !important;
    text-decoration: underline !important;
    border-bottom: none !important;
  }

  /* —— 行分页控制（尽量不把一行拆页） —— */
  #write :is(.markdown-rendered table, .md-table, table) tr {
    page-break-inside: avoid;
    break-inside: avoid;
  }
}

/* ========================================================================== */
/* REGION C — PRINT: INLINE & BLOCK MATHJAX-SVG                               */
/* Scope: #write 下的 MathJax SVG 容器（行内/行间分别收敛）                    */
/* Function: 打印导出时修正行内公式基线/高度，行间公式独立占行与不拆页          */
/* Adjustable Params: 主题色（#9916cf）、基线微调 translateY(0.03em)           */
/* Compatibility: MathJax v3（SVG 引擎）/ Typora 导出 / 现代浏览器             */
/* ========================================================================== */

@media print {

  /* 统一容器取色 */
  #write mjx-container[jax="SVG"] {
    color: #9916cf !important;
    break-inside: avoid !important;      /* 行间公式不被拆页 */
    page-break-inside: avoid !important;
  }

  /* 关键：SVG 不被裁剪 */
  #write mjx-container[jax="SVG"] > svg {
    overflow: visible !important;
  }

  /* 只给字形路径上色（字符大多是 <path>） */
  #write mjx-container[jax="SVG"] svg path {
    fill: currentColor !important;
  }

  /* 有描边的元素沿用容器色；保留原有描边宽度 */
  #write mjx-container[jax="SVG"] svg [stroke] {
    stroke: currentColor !important;
    stroke-width: inherit !important;    /* ← 不要清零 */
  }

  /* 几何元素保持透明填充：\boxed 的 <rect> 只走描边 */
  #write mjx-container[jax="SVG"] svg rect,
  #write mjx-container[jax="SVG"] svg line,
  #write mjx-container[jax="SVG"] svg polyline,
  #write mjx-container[jax="SVG"] svg polygon,
  #write mjx-container[jax="SVG"] svg circle,
  #write mjx-container[jax="SVG"] svg ellipse {
    fill: none !important;
  }
}

/* =======================================================================================
   Rhapsody · Focus Mode — Immersive & Stage Spotlight（专注模式 · 沉浸/舞台）
   设计理念 / Design Concept
   - 不改 DOM：仅依赖 Typora 的 body.focusmode 状态 + 可选类（.fm-immersive / .fm-stage）。
   - 三档风格：默认辅助（轻降噪）/ 沉浸（强降噪+轻模糊）/ 舞台（暗场+聚光灯）。
   - 作用域收敛：仅屏幕态 @media screen 与 #write 内部；打印完全互斥（不影响你的 print 区）。
   - 性能优先：默认少滤镜，尊重 prefers-reduced-motion；舞台模式使用一层暗场叠层+焦点光晕。
   ======================================================================================= */


/* ========================================================================== */
/* REGION FM-A — ROOT VARS（变量与开关）                                       */
/* ========================================================================== */

:root{
  /* 总开关：0=关闭，1=开启（仅在 body.focusmode 时生效） */
  --fm-enable:            1;

  /* 默认“辅助式”强度 */
  --fm-dim-opacity:       .45;     /* 非焦点透明度 */
  --fm-dim-saturate:      .90;     /* 轻去饱和 */
  --fm-dim-blur:          0px;     /* 模糊默认 0，性能友好 */

  /* 焦点块视觉（沉浸/辅助通用） */
  --fm-focus-bg:          color-mix(in srgb, #fff 88%, #dde6ff);
  --fm-focus-bd:          #4777ff;
  --fm-focus-bd-w:        1.5px;
  --fm-focus-radius:      10px;
  --fm-focus-shadow:      0 6px 20px rgba(0,0,0,.08);

  /* 行内/列表微调 */
  --fm-code-bg:           color-mix(in srgb, #fff 92%, #e8f3ff);
  --fm-list-dot:          color-mix(in srgb, #4777ff 70%, #000 0%);

  /* 舞台模式参数（暗场与聚光灯） */
  --fm-stage-vignette:    rgba(0,0,0,.38);  /* 全局暗场不透明度 */
  --fm-stage-glow:        rgba(255,255,255,.85); /* 聚光灯核心亮度 */
  --fm-stage-glow-soft:   rgba(255,255,255,.28); /* 聚光灯外圈 */
  --fm-stage-glow-spread: 22px;  /* 焦点块外扩光晕 spread */
  --fm-stage-glow-blur:   48px;  /* 光晕模糊半径 */

  /* 过渡 */
  --fm-tran:              140ms ease;
}

/* 沉浸式：更强降噪 + 轻度模糊 */
body.fm-immersive{
  --fm-dim-opacity:   .78;
  --fm-dim-saturate:  .75;
  --fm-dim-blur:      1px;
  --fm-focus-bg:      color-mix(in srgb, #fff 84%, #dfe8ff);
  --fm-focus-shadow:  0 8px 28px rgba(0,0,0,.10);
}

/* 舞台模式：暗场 + 聚光灯（非焦点更深、焦点更亮） */
body.fm-stage{
  --fm-dim-opacity:   .82;
  --fm-dim-saturate:  .70;
  --fm-dim-blur:      0.5px;
}


/* ========================================================================== */
/* REGION FM-B — BASE SCOPE（作用域与降噪基线）                                */
/* ========================================================================== */

@media screen {
  body:not(.focusmode){ --_fm-on: 0; }
  body.focusmode{ --_fm-on: var(--fm-enable); }

  /* 仅直系写作内容做过渡，避免影响侧栏等 UI */
  #write > *{
    transition: opacity var(--fm-tran), filter var(--fm-tran), transform var(--fm-tran);
  }

  /* 非焦点兄弟降噪（变量控制强度） */
  body.focusmode #write > *:not(.md-focus):not(:focus-within){
    opacity: calc(1 - var(--_fm-on) * var(--fm-dim-opacity));
    filter:
      saturate(var(--fm-dim-saturate))
      blur(var(--fm-dim-blur));
  }

  /* 兼容 CodeMirror 当前行 */
  body.focusmode #write .CodeMirror-activeline{
    opacity: 1 !important;
    filter: none !important;
  }

  @media (prefers-reduced-motion: reduce){
    #write > *{ transition: none !important; }
  }
}


/* ========================================================================== */
/* REGION FM-C — FOCUS HIGHLIGHT（焦点块高亮框）                               */
/* ========================================================================== */

@media screen {
  body.focusmode #write .md-focus,
  body.focusmode #write :focus-within{
    background: var(--fm-focus-bg);
    box-shadow: var(--fm-focus-shadow);
    border-radius: var(--fm-focus-radius);
    position: relative;
  }
  /* 内描边（不改变布局） */
  body.focusmode #write .md-focus::after,
  body.focusmode #write :focus-within::after{
    content: "";
    position: absolute; inset: 0;
    border-radius: inherit;
    box-shadow: inset 0 0 0 var(--fm-focus-bd-w) var(--fm-focus-bd);
    pointer-events: none;
  }

  /* 列表/行内代码轻提亮 */
  body.focusmode #write .md-focus li::marker,
  body.focusmode #write :focus-within li::marker{
    color: var(--fm-list-dot);
  }
  body.focusmode #write .md-focus code,
  body.focusmode #write :focus-within code{
    background: var(--fm-code-bg);
    border-radius: 6px;
    transition: background var(--fm-tran);
  }
}


/* ========================================================================== */
/* REGION FM-S — STAGE SPOTLIGHT（舞台模式：暗场 + 聚光灯）                     */
/* 说明：仅在 body.fm-stage + body.focusmode 触发；不改 DOM                     */
/* ========================================================================== */

@media screen {
  /* 1) 全局暗场：覆盖 #write 区域，舞台氛围 */
  body.focusmode.fm-stage #write{
    position: relative; /* 承载暗场层 */
  }
  body.focusmode.fm-stage #write::before{
    content: "";
    position: absolute; inset: -2px;   /* 略放大避免边缘漏光 */
    background:
      radial-gradient(120% 120% at 50% 40%, rgba(0,0,0,0) 0%, rgba(0,0,0,.08) 50%, rgba(0,0,0,.18) 70%, var(--fm-stage-vignette) 100%);
    pointer-events: none;
    z-index: 1;
    border-radius: 12px;               /* 若你的写作卡片是圆角，可适配 */
    /* 暗场只在舞台模式显示 */
    opacity: 1;
    transition: opacity var(--fm-tran);
  }

  /* 2) 焦点块“聚光灯”光晕：挂在焦点块本身，提亮中心、柔和外圈 */
  body.focusmode.fm-stage #write .md-focus,
  body.focusmode.fm-stage #write :focus-within{
    z-index: 2;  /* 盖在暗场之上 */
  }
  body.focusmode.fm-stage #write .md-focus::before,
  body.focusmode.fm-stage #write :focus-within::before{
    content: "";
    position: absolute; inset: -6%;
    border-radius: calc(var(--fm-focus-radius) + 12px);
    pointer-events: none;
    /* 核心：大号内发光 + 外圈软光，模拟舞台聚光灯洒落 */
    box-shadow:
      0 0 0 var(--fm-stage-glow-spread) var(--fm-stage-glow),
      0 0 var(--fm-stage-glow-blur) var(--fm-stage-glow-blur) var(--fm-stage-glow-soft);
    mix-blend-mode: screen;   /* 与暗场叠加提亮 */
  }
}


/* ========================================================================== */
/* REGION FM-D — SPECIAL CASES（常见块微调：标题/表格/图片/代码块）             */
/* ========================================================================== */

@media screen {
  body.focusmode #write :is(h1,h2,h3,h4,h5,h6).md-focus,
  body.focusmode #write :is(h1,h2,h3,h4,h5,h6):focus-within{
    filter: contrast(1.06) saturate(1.02);
  }
  body.focusmode #write .md-focus :is(table thead th),
  body.focusmode #write :focus-within :is(table thead th){
    background: color-mix(in srgb, var(--fm-focus-bg) 65%, #fff);
  }
  body.focusmode #write .md-focus img,
  body.focusmode #write :focus-within img{
    opacity: 1 !important;
    filter: none !important;
    border-radius: 8px;
  }
  body.focusmode #write .md-focus pre,
  body.focusmode #write :focus-within pre{
    box-shadow: 0 8px 24px rgba(0,0,0,.06);
    border-radius: 10px;
  }
}


/* ========================================================================== */
/* REGION FM-E — SAFETY & EXCLUSIONS（安全排除与打印互斥）                      */
/* ========================================================================== */

@media screen {
  .megamenu-opened #write > *{
    opacity: 1 !important;
    filter: none !important;
  }
}
/* 打印互斥：你的 print 分区负责导出，这里完全让位 */
@media print{
  body.focusmode #write *{ opacity: 1 !important; filter: none !important; }
}











@import "";

@import "";
@import "";
@import "";
@import "";
@import "";

@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
@import "";


@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
@import "";


@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
@import "";
</style>
<style type='text/css'  id="style-lp">ol, ul {padding-left: 40px}</style>

<title>Math                                     ∫01x2dx=13</title>
</head>
<body class='typora-export os-windows'><div class='typora-export-content'>
<div id='write'  class=' first-line-indent'><!-- ===================================================== -->
<!-- 🍎 Rhapsody · Global Navigation（全局导航栏 · 首页用） -->
<!-- ===================================================== --><div class="nav-bar" style="
  display:flex;
  justify-content:center;
  align-items:center;
  gap:1.4rem;
  padding:0.8rem 1.2rem;
  background:linear-gradient(90deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
  border-radius:18px;
  box-shadow:0 0 18px rgba(255,255,255,0.08);
  backdrop-filter:blur(10px);
  position:sticky;
  top:0;
  z-index:99;
  font-weight:600;
  font-size:1.05rem;
"><p><span>  </span><a href="index.html" style="text-decoration:none; color:#ff4081;"><span>🏠 Home</span></a>
<span>  </span><a href="about.html" style="text-decoration:none; color:#ffca28;"><span>👤 About</span></a>
<span>  </span><a href="research.html" style="text-decoration:none; color:#00bcd4;"><span>🔭 Research</span></a>
<span>  </span><a href="projects.html" style="text-decoration:none; color:#4caf50;"><span>💡 Projects</span></a>
<span>  </span><a href="works.html" style="text-decoration:none; color:#9c27b0;"><span>🧩 Works</span></a>
<span>  </span><a href="contact.html" style="text-decoration:none; color:#03a9f4;"><span>📬 Contact</span></a>
</div></p><hr /><h1 id='🍎-rhapsody--the-dashing-princes-apple-world'><span>🍎 Rhapsody · The Dashing Prince’s Apple World  </span></h1><blockquote><p><span>“Mathematics is not just a tool, but a language about existence and cognition.”</span></p></blockquote><p><span>🎓 </span><strong><span>University of Science and Technology of China (USTC)</span></strong><span></span><br/><strong><span>Graduate Student in Statistics &amp; Financial Systems</span></strong></p><hr /><h2 id='👑-about-me'><span>👑 About Me</span></h2><p><span>I am a researcher who walks the line between </span><strong><span>mathematics, cognition, and control systems</span></strong><span>.</span><br/><span>From philosophy to numerical algorithms, my passion lies in unifying </span><strong><span>reasoning and reality</span></strong><span>.  </span></p><p><span>🪶 </span><em><span>“To see through chaos is to find order — and in that order, meaning.”</span></em></p><hr /><h2 id='🔭-research--reflections'><span>🔭 Research &amp; Reflections</span></h2><p><span>Exploring the mathematical structures behind intelligence and rationality:</span></p><ul><li><p><span>ZFC axioms and categorical structures  </span></p></li><li><p><span>Measure theory and probabilistic operators  </span></p></li><li><p><span>Optimization, ADMM, and control theory  </span></p></li><li><p><span>Neural adaptation and philosophical foundations  </span></p></li></ul><blockquote><p><span>My current focus: </span><em><span>Bridging theoretical mathematics with applied control.</span></em></p></blockquote><hr /><h2 id='💡-projects'><span>💡 Projects</span></h2><ul><li><p><span>🚤 </span><strong><span>AN-MPC Control System (MATLAB)</span></strong><span> — Adaptive Nonlinear MPC for USV  </span></p></li><li><p><span>🧭 </span><strong><span>MD-A</span><span>*</span><span> Path Planning</span></strong><span> — Modified Dynamic A</span><span>*</span><span> algorithm under water disturbances  </span></p></li><li><p><span>🎨 </span><strong><span>Catalyst Typora Theme</span></strong><span> — Custom writing interface with animated Appleron style  </span></p></li><li><p><span>🧩 </span><strong><span>堆界异梦 · Dream of the Heap</span></strong><span> — Concept design for a voxel fantasy strategy game  </span></p></li></ul><hr /><h2 id='🧩-works--gallery'><span>🧩 Works &amp; Gallery</span></h2><p><span>A collection of my works and experiments:</span></p><ul><li><p><span>Simulation trajectories and control convergence plots  </span></p></li><li><p><span>Typora theme screenshots  </span></p></li><li><p><span>Mathematical diagrams (ZFC, Category, Operator spaces)  </span></p></li><li><p><span>Concept artworks from my personal projects  </span></p></li></ul><p><em><span>(Full gallery coming soon.)</span></em></p><hr /><h2 id='📬-contact'><span>📬 Contact</span></h2><p><span>📧 Email: </span><a href='mailto:yourname@ustc.edu.cn' target='_blank' class='url'>yourname@ustc.edu.cn</a><span></span><br/><span>🌐 GitHub: </span><a href='https://github.com/yourname'><span>https://github.com/yourname</span></a><span></span><br/><span>📖 Research Group: </span><em><span>Rhapsody — 数理哲学与智能工程</span></em></p><hr /><footer style="text-align:center; font-size:0.9rem; opacity:0.75; margin-top:2rem;">
© 2025 The Dashing Prince · Powered by Typora & Catalyst Theme
</footer></div></div>
</body>
</html>